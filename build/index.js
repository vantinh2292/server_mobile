!function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=72)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports={IO:void 0,COMMUNICATION_PLC_OMRON:void 0,ValueCommunicationPLC:[],ListUserPass:[],WritePosCobot:[],resultImage:[],refreshDataBitDisplayImageLibrary:!1,refreshDataMapImageLibrary:!1,resultBitDisplayImageLibrary:[],resultMapImageLibrary:[],refreshDataElementImageLibrary:!1,resultElementImageLibrary:[],refreshDataElement:!1,refreshDataBitAdjust:!1,refreshDataBitDisplay:!1,refreshDataMap:!1,refreshDataWordAdjust:!1,refreshDataWordDisplay:!1,refreshDataDWordAdjust:!1,refreshDataDWordDisplay:!1,refreshDataImage:!1,refreshDataLabel:!1,refreshDataString:!1,refreshDataLine:!1,refreshDataPoint:!1,refreshDataPointPickPlace:!1,refreshDataPanel:!1,refreshDataTextField:!1,refreshDataTextFieldInput:!1,refreshDataGroupControl:!1,haveChangeElement:!1,haveChangeBitAdjust:!1,haveChangeBitDisplay:!1,haveChangeMap:!1,haveChangeWordAdjust:!1,haveChangeWordDisplay:!1,haveChangeDWordAdjust:!1,haveChangeDWordDisplay:!1,haveChangeTextField:!1,haveChangeTextFieldInput:!1,refreshDataPercent:!1,resultPercent:[],Percent:[],OldPercent:[],haveChangePercent:!1,Element:[],OldElement:[],ElementOmron:[],WordStartElementOmron:0,LengthOfElementOmron:100,Map:[],BitDisplay:[],BitAdjust:[],WordDisplay:[],WordAdjust:[],DWordDisplay:[],DWordAdjust:[],OldBitDisplay:[],OldBitAdjust:[],OldWordDisplay:[],OldWordAdjust:[],OldDWordDisplay:[],OldDWordAdjust:[],TextField:[],OldTextField:[],TextFieldInput:[],OldTextFieldInput:[],WordBitAdjust:[],IndexSocketInputSignal:2,IndexSocketBitAdjust:4,IndexSocketBitDisplay:3,IndexSocketWordDisplay:5,IndexSocketWordAdjust:6,IndexSocketDWordDisplay:7,IndexSocketDWordAdjust:8,CheckBitDisplay:"",CheckBitAdjust:"",CheckWordDisplay:"",CheckWordAdjust:"",CheckDWordDisplay:"",CheckDWordAdjust:"",resultlabel:[],resultline:[],resultElement:[],resultBitDisplay:[],resultBitAdjust:[],resultWordDisplay:[],resultWordAdjust:[],resultDWordDisplay:[],resultDWordAdjust:[],resultPanel:[],resultTextField:[],resultTextFieldInput:[],resultcustomeroperator:void 0,refreshdata:void 0,CustomerOperator:void 0,BitDisplayOMRON:[],WordStartBitDisplayOMRON:300,LengthOfWordBitDisplayOMRON:10,BitAdjustOMRON:[],WordStartBitAdjustOMRON:310,LengthOfWordBitAdjustOMRON:10,WordDisplayOMRON:[],WordStartWordDisplayOMRON:320,LengthOfWordWordDisplayOMRON:200,WordAdjustOMRON:[],WordStartWordAdjustOMRON:520,LengthOfWordWordAdjustOMRON:200,DWordDisplayOMRON:[],WordStartDWordDisplayOMRON:720,LengthOfWordDWordDisplayOMRON:25,DWordAdjustOMRON:[],WordStartDWordAdjustOMRON:770,LengthOfWordDWordAdjustOMRON:25,ElementMitsubishi:[],BitDisplayMitsubishi:[],BitAdjustMitsubishi:[],WordDisplayMitsubishi:[],WordAdjustMitsubishi:[],DWordDisplayMitsubishi:[],DWordAdjustMitsubishi:[],refreshDataPosCobot:!1,resultPosCobot:[],resultGroupControl:[],ListString:[],OldListString:[],haveChangeString:!1,ResultString:[],refreshDataProduct:!1,resultProduct:[],refreshDataUser:!1,resultUser:[],LoadProductsToPLC:!1,refreshDataGoal:!1,resultGoal:[],refreshDataSampleRoute:!1,resultSampleRoute:[],refreshDataFormularProject:!1,resultFormularProject:[],resultFormularProjectConvertType:[],xlData:void 0,xlData2:void 0,refreshDataScaleProject:!1,resultScaleProject:[],refreshDataSearchBox:!1,resultSearchBox:[],refreshDataSearchBoxList:!1,resultSearchBoxList:[],refreshDataReportScaleProject:!1,resultReportScaleProject:[],refreshDataProjectNanoenvi:!1,resultProjectNanoenvi:[]}},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("stampit")},function(e,t){e.exports=require("config")},function(e,t,r){const{values:o}=r(47),a=r(13),i=r(117);e.exports={ReadWordOfPlcToByte:function(e,t,r){for(var o=[],a=e;a<e+t;a++){var i=255&r[a];o[2*(a-e)]=i,r[a]=(r[a]-i)/256,o[2*(a-e)+1]=r[a]}return o},StringToAscii:function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);var o=[],a=0,i=0;for(r=0;r<t.length;r++)r%2==0&&(i=t[r],r+1===t.length&&(o[a]=i)),r%2==1&&(i+=256*t[r],o[a]=i,a+=1);return o},ReadBitOfPLC:function(e,t,r){for(var o=[],a=e;a<e+t;a++)for(var i=Number(r[a]),s=0;s<16;s++)o[16*(a-e)+s]=1&i,i>>=1;return o},ReadBitOfPLCSiemens:function(e,t,r){for(var o=[],a=e;a<e+t;a++)for(var i=Number(r[a]),s=0;s<16;s++)s<8&&(o[16*(a-e)+s+8]=1&i,i>>=1),s>=8&&(o[16*(a-e)+s-8]=1&i,i>>=1);return o},ReadWordOfPLC:function(e,t,r){for(var o=[],a=e;a<e+t;a++)o[a-e]=r[a];return o},ReadDWordOfPLCSiemens:function(e,t,r){for(var o=[],a=e;a<e+2*t;a++)a%2==1&&(r[a]<0&&(r[a]=r[a]+65536),r[a-1]<0&&(r[a-1]=r[a-1]+65536),o[(a-e-1)/2]=r[a]+65536*r[a-1],o[(a-e-1)/2]<0&&(o[(a-e-1)/2]=o[(a-e-1)/2]+65536));return o},ReadDWordOfPLC:function(e,t,r){for(var o=[],a=e;a<e+2*t;a++)a%2==1&&(o[(a-e-1)/2]=65536*r[a]+r[a-1],o[(a-e-1)/2]<0&&(o[(a-e-1)/2]=o[(a-e-1)/2]+65536));return o},ConvertArray2Text:function(e){for(var t="",r=0;r<e.length;r++)t=t+"|"+e[r];return t},CheckChangeValue:function(e,t){var r,o=!1;if(!(void 0===(r=e)||null==r||r.length<=0))for(var a=0;a<e.length;a++)e[a]!=t[a]&&(o=!0);return o},CheckNegativeNumber:function(e){return e<0?e+65536:e>32767?e-65536:e},getRandomInt:function(e){return Math.floor(Math.random()*Math.floor(e))},saveJsonFile:function(e,t){try{a.existsSync(e)||a.writeFile(e,JSON.stringify(t),"utf8",(function(e){if(e)return console.log("An error occured while writing JSON Object to File."),console.log(e);console.log("JSON file has been saved.")}))}catch(e){console.error(e)}},getJsonFile:function(e,t){try{a.existsSync(e)?a.readFile(e,"utf8",(function(e,r){e&&console.log(e),obj=JSON.parse(r),t(obj)})):t("update")}catch(e){console.error(e),t([])}},saveFeedbackFile:function(e,t){try{a.writeFile(e,t,"utf8",(function(e){if(e)return console.log("An error occured while writing JSON Object to File."),console.log(e);console.log("JSON file has been saved.")}))}catch(e){console.error(e)}},convertPosCobot:function(e,t){var r=[];return r[0]=parseInt(t%256),r[1]=parseInt(t/256),r[2]=parseInt(e%256),r[3]=parseInt(e/256),Buffer.from([r[3],r[2],r[1],r[0]]).readFloatBE(0)},getIndexCobotWriteMB:function(e,t){return t%10<=e?t/10:t/10+1},ReadStringOfPLC:function(e,t){for(var r=[],o=0;o<t.length/e;o++){let i=[];for(var a=0;a<e;a++)i.push(255&t[o*e+a]),i.push(parseInt(t[o*e+a]/256));r[o]=String.fromCharCode(...i).toString().replace(/[^ -~]+/g,""),0===r[o].length&&(r[o]="_")}return r},getDateTime:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1;r=(r<10?"0":"")+r;var o=e.getUTCDate();o=(o<10?"0":"")+o;var a=e.getHours();a=(a<10?"0":"")+a;var i=e.getMinutes();i=(i<10?"0":"")+i;var s=e.getSeconds();return t+"/"+r+"/"+o+" "+a+":"+i+":"+(s=(s<10?"0":"")+s)},saveLog:function(e,t){var r="log/"+e+".log",o="["+this.getDateTime()+"] "+t.replace(/[^ -~]+/g,"")+"\r\n";try{a.existsSync(r)||(console.log(r),a.writeFile(r,"Data:\r\n",(function(e){e&&console.log("An error occured while writing JSON Object to File.")}))),a.appendFile(r,o,(function(e){if(e)return console.log(e);console.log('successfully appended "'+o+'"')}))}catch(e){console.error(e)}},saveExcel:function(e,t){var r="log/"+e+".csv",o="["+this.getDateTime()+"] ";let a=t.split("||");const s=[{Field0:o,Field1:a[0],Field2:a[2],Field3:a[3],Field4:a[4]}];(async()=>{console.log("export-----------------------");const e=new i(s);await e.toDisk(r,{append:!0}),console.log(await e.toString())})()}}},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("util")},function(e,t,r){var o=r(0),a=new(0,o.Schema)({id:{type:String,required:!0,unique:!0},name:{type:String,required:!0,unique:!0},password:{type:String,required:!0}});e.exports=o.model("users",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({ScaleNumber:{type:Number,required:!0},ProductName:{type:String,unique:!0,required:!0},ProductCapacity:{type:Number,required:!0},ProductTonKho:{type:Number,required:!0},ProductHeSo:{type:Number,required:!0}});e.exports=o.model("scale_project",a)},function(e,t,r){var o=r(12),a=(r(0),r(1)),i=r(45);e.exports={calibrationScale:function(e,t,r,o,a,i,s,n){var d="";if(e||(t=!1,a=0,d="---",r=!1),r||(o=!1),e){switch(t=!0,a){case 1:d="- Bắt đầu calib \n- Đưa cân về 0 sau đó nhấn xác nhận!!!",r&&!o&&(o=!0,a+=1,r=!1);break;case 2:d="- Đặt vật lên cân\n- Nhập số lượng đang có trên cân vào ô số lượng",r&&!o&&(o=!0,a+=1,r=!1);break;case 3:0===parseInt(s)&&(d="- Lỗi ô số lượng đang bằng 0"),0!==parseInt(s)&&(d="- Giá trị calib hệ số: "+(n=i/s)+"\n- Đợi khối lượng ổn định\n Nhấn xác nhận",r&&!o&&(o=!0,a+=1,r=!1));break;case 4:d="- Nhấn xác nhận để cập nhật hệ số calib cho sản phẩm\n"+n,r&&!o&&(o=!0,a+=1,r=!1);break;case 6:d="- Calib thành công";break;case 7:d="- Calib thất bại";break;case 8:d="- ID không đúng";break;default:d="..."}0===a&&(a=1,r=!1)}return{returnTextField:d,step:a,oldEnableCalib:t,confirm:r,oldConfirm:o,heso:n}},measureScale:function(e,t,r,s,n,d,l,u,c,p,f,h,y,g,b,m){let I="PROCESSING",v=0,C=0,D=0,w=0,B=0;if("---"===p&&(I="Nhập tên khách hàng",C=1,D=0,w=0,B=0),(isNaN(u)||0==parseInt(u))&&(I="Nhập số lượng yêu cầu",C=0,D=0,w=1,B=0),isNaN(l)&&(I="Hệ số không đúng"),n.length<5&&(I="Chưa chọn sản phẩm",C=0,D=1,w=0,B=0),1==t&&(I="Đang tiến hành calib hệ số"),!isNaN(l)&&n.length>5&&"PROCESSING"===I&&(v=parseInt(d/l+.5)),"PROCESSING"===I){if(C=0,D=0,w=0,B=1,v<u&&(I="THIẾU "+(u-v)),v>u&&(I="THỪA "+(v-u)),v==u&&(I="ĐỦ SỐ LƯỢNG YÊU CẦU"),r&&!s){s=!0;new o({ScaleNumber:parseInt(e),NameProduct:c,NameCustomer:p,NameOperator:f,AmoutProduct:h,AmoutProductReal:y}).save(t=>{t?(console.log("Error is: "+t),console.log("insert db error",t)):(console.log("insert success"),a.refreshDataReportScaleProject=!0,1==e&&(i.saveFinish1=!0),2==e&&(i.saveFinish2=!0))})}g&&(r=!1,h=0,g=!1)}r||(s=!1);let S=0;return S=0==parseInt(b)?0:parseInt(100*parseInt(m)/parseInt(b)),{returnTextField:I,soluong:v,finish:r,oldfinish:s,NameProduct:c,NameCustomer:p,NameOperator:f,AmoutProduct:h,saveFinish:g,valuePercent:S,tenKH:C,tenSP:D,tenSL:w,statusOK:B}},GetSearchDataList:function(){let e=[],t=[];for(let r=0;r<a.resultSearchBoxList.length;r++)1==parseInt(a.resultSearchBoxList[r].SearchBoxListNumber)&&e.push(a.resultSearchBoxList[r]),2==parseInt(a.resultSearchBoxList[r].SearchBoxListNumber)&&t.push(a.resultSearchBoxList[r]);let r=[],o=[];for(let e=0;e<a.resultScaleProject.length;e++)1==parseInt(a.resultScaleProject[e].ScaleNumber)&&r.push(a.resultScaleProject[e]),2==parseInt(a.resultScaleProject[e].ScaleNumber)&&o.push(a.resultScaleProject[e]);return[{SearchBoxID:"Customer1",Data:e},{SearchBoxID:"Customer2",Data:t},{SearchBoxID:"Product1",Data:r},{SearchBoxID:"Product2",Data:o}]}}},function(e,t,r){var o=r(0),a=new(0,o.Schema)({ScaleNumber:{type:Number,required:!0},NameProduct:{type:String,required:!0},NameCustomer:{type:String,required:!0},NameOperator:{type:String,required:!0},AmoutProduct:{type:Number,default:0},AmoutProductReal:{type:Number,required:!0},date:{type:Date,default:Date.now,timestamps:!0}});e.exports=o.model("report_scale_project",a)},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("stampit-log")},function(e,t,r){var o={"./ReadCoils":51,"./ReadCoils.js":51,"./ReadDiscreteInputs":52,"./ReadDiscreteInputs.js":52,"./ReadHoldingRegisters":53,"./ReadHoldingRegisters.js":53,"./ReadInputRegisters":54,"./ReadInputRegisters.js":54,"./WriteMultipleCoils":55,"./WriteMultipleCoils.js":55,"./WriteMultipleRegisters":56,"./WriteMultipleRegisters.js":56,"./WriteSingleCoil":57,"./WriteSingleCoil.js":57,"./WriteSingleRegister":58,"./WriteSingleRegister.js":58};function a(e){var t=i(e);return r(t)}function i(e){if(!r.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=15},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("path")},function(e,t,r){var o=r(0),a=new(0,o.Schema)({type:{type:Number,required:!0},number:{type:Number,required:!0},offsetInX:{type:Number,required:!0},offsetInY:{type:Number,required:!0},offsetInZ:{type:Number,required:!0},offsetInR:{type:Number,required:!0},offsetInAddX:{type:Number,required:!0},offsetInAddY:{type:Number,required:!0},PlaceX:{type:Number,required:!0},PlaceY:{type:Number,required:!0}});e.exports=o.model("points",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({IdCode:{type:String,default:""},NameCode:{type:String,default:""},Warehouse1:{type:Number,default:0},Warehouse2:{type:Number,default:0},Warehouse3:{type:Number,default:0},Weigh:{type:Number,required:!0}});e.exports=o.model("products",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({NameGoal:{type:String,default:""},Warehouse1:{type:Number,default:0},Warehouse2:{type:Number,default:0},Warehouse3:{type:Number,default:0}});e.exports=o.model("goals",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},tag:{type:String,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},nameElement:{type:String,default:""},src:{type:String,required:!0},state_m:{type:Number,default:0},state_cm:{type:Number,default:0},state_F0:{type:Number,default:0},state_F1:{type:Number,default:0},state_Fault:{type:Number,default:0},state_Interlock:{type:Number,default:0}});e.exports=o.model("elements",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},color:{type:String,default:"black"},fontSize:{type:Number,default:14}});e.exports=o.model("labels",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},length:{type:Number,required:!0},type:{type:String,required:!0},idRun:{type:String,default:""}});e.exports=o.model("lines",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0},noBorder:{type:Number,default:0},unit:{type:String,default:""}});e.exports=o.model("wordDisplays",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0},unit:{type:String,default:""}});e.exports=o.model("wordAdjusts",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0},unit:{type:String,default:""}});e.exports=o.model("dwordDisplays",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0}});e.exports=o.model("dwordAdjusts",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},status:{type:Number,default:!1},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text0:{type:String,default:""},text1:{type:String,default:""},color0:{type:String,default:""},color1:{type:String,default:""},nameImage0:{type:String,default:""},nameImage1:{type:String,default:""},tag:{type:String,required:!0},type:{type:Number,required:!0},blink0:{type:Number,default:0},blink1:{type:Number,default:0},fontSize:{type:Number,default:14,required:!1}});e.exports=o.model("bitDisplays",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},sellectPoint:{type:Number,required:!0},image1X:{type:Number,required:!0},image1Y:{type:Number,required:!0},image2X:{type:Number,required:!0},image2Y:{type:Number,required:!0},map1X:{type:Number,required:!0},map1Y:{type:Number,required:!0},map2X:{type:Number,required:!0},map2Y:{type:Number,required:!0},nameImage:{type:String,default:""}});e.exports=o.model("maps",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},status:{type:Boolean,default:!1},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},text:{type:String,default:""},tag:{type:String,required:!0},type:{type:Number,required:!0},borderRadius:{type:Number,required:!0},colorText:{type:String,required:!0},colorOn:{type:String,required:!0},colorOff:{type:String,required:!0},myKeyPress:{type:String,default:""},fontSize:{type:Number,default:14}});e.exports=o.model("bitAdjusts",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},backgroundColor:{type:String,default:"#4c7549"},borderRadius:{type:Number,default:5},boxShadow1:{type:Number,default:10},boxShadow2:{type:Number,default:10},boxShadow3:{type:Number,default:20},boxShadowColor:{type:String,default:"#100"},zIndex:{type:Number,default:0},margin:{type:Number,default:10},padding:{type:Number,default:10}});e.exports=o.model("panels",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},tag:{type:String,required:!0},label:{type:String,required:!0},value:{type:String,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},color:{type:String,required:!0},fontSize:{type:Number,required:!0},rows:{type:Number,required:!0}});e.exports=o.model("textFields",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},tag:{type:String,required:!0},label:{type:String,required:!0},value:{type:String,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},color:{type:String,required:!0},fontSize:{type:Number,required:!0},rows:{type:Number,required:!0}});e.exports=o.model("textFieldInputs",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({name:{type:String,default:""},img:{type:String,default:""},date:{type:Date,default:new Date}});e.exports=o.model("bitDisplay_Image_Library",a)},function(e,t){e.exports=require("mime")},function(e,t,r){var o=r(0),a=new(0,o.Schema)({name:{type:String,default:""},img:{type:String,default:""},date:{type:Date,default:new Date}});e.exports=o.model("map_Image_Library",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({name:{type:String,unique:!0,default:""},imgRun:{type:String,default:""},imgStop:{type:String,default:""},imgLock:{type:String,default:""},imgFault:{type:String,default:""},date:{type:Date,default:Date.now,timestamps:!0}});e.exports=o.model("element_Image_Library",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},leftIcon:{type:Number,required:!0},topIcon:{type:Number,required:!0},widthIcon:{type:Number,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},backgroundColor:{type:String,default:"#4c7549"},borderRadius:{type:Number,default:5},boxShadow1:{type:Number,default:10},boxShadow2:{type:Number,default:10},boxShadow3:{type:Number,default:20},boxShadowColor:{type:String,default:"#100"},zIndex:{type:Number,default:0},margin:{type:Number,default:10},padding:{type:Number,default:10},active:{type:Number,default:0}});e.exports=o.model("groupcontrols",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},tag:{type:Number,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},color:{type:String,default:"black"},fontSize:{type:Number,default:14},speedScroll:{type:Number,default:0}});e.exports=o.model("strings",a)},function(e,t,r){var o=r(9);const{hash:a,compare:i}=r(16),{sign:s,verify:n}=r(103),{ServerError:d}=r(105);e.exports={UserService:class{static async signIn(e,t){const r=await o.findOne({id:e});if(console.log(r),!r)throw new d("Invalid_user_info1",404);if(!await i(t,r.password))throw new d("Invalid_user_info2",404);const a=r.toObject(),n=await s({_id:r._id});return a.token=n,delete a.password,a}static async signUp(e,t,r){if(!e)throw new d("EMPTY_ID",400);if(!t)throw new d("EMPTY_NAME",400);if(!r)throw new d("EMPTY_PASSWORD",400);try{const i=await a(r,8),s=new o({id:e,name:t,password:i});return await s.save(),s}catch(e){throw new d("ID_EXISTED",409)}}static async check(e){if(!e)throw new d("EMPTY_TOKEN",400);const{_id:t}=await n(e).catch(()=>{throw new d("INVALID_TOKEN",400)}),r=await o.findById(t);if(!r)throw new d("CANNOT FIND USER",404);const a=r.toObject(),i=await s({_id:r._id});return a.token=i,delete a.password,a}}}},function(e,t,r){var o=r(0),a=new(0,o.Schema)({IdCode:{type:String,default:""},NameCode:{type:String,default:""},Amount:{type:Number,required:!0},Goal:{type:String,default:""},Weigh:{type:Number,required:!0},SampleNumber:{type:Number,required:!0},Order:{type:Number,required:!0}});e.exports=o.model("sample_route",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({FormularNumber:{type:Number,required:!0},FormularName:{type:String,required:!0},Step:{type:Number,required:!0},Type1:{type:String,required:!0},TypeValue:{type:Number,required:!0},TypeValueMachine:{type:Number,required:!0},AbsolutePosition:{type:Number,required:!0}});e.exports=o.model("formular_project",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0}});e.exports=o.model("SearchBoxs",a)},function(e,t,r){var o=r(0),a=new(0,o.Schema)({SearchBoxListNumber:{type:Number,required:!0},SearchBoxListName:{type:String,required:!0}});e.exports=o.model("search_box_list",a)},function(e,t){e.exports={oldEnableCalib1:!1,oldConfirm1:!1,heso1:0,oldEnableCalib2:!1,oldConfirm2:!1,heso2:0,oldFinish1:!1,oldFinish2:!1,saveFinish1:!1,saveFinish2:!1,RealWeight1:0,InitialConnectCOM:!1}},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},idGroupControl:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},rotate:{type:Number,required:!0},value:{type:Number,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0},unit:{type:String,default:""}});e.exports=o.model("view_percents",a)},function(e,t,r){(function(){var r=this,o=r._,a={},i=Array.prototype,s=Object.prototype,n=Function.prototype,d=i.push,l=i.slice,u=i.concat,c=s.toString,p=s.hasOwnProperty,f=i.forEach,h=i.map,y=i.reduce,g=i.reduceRight,b=i.filter,m=i.every,I=i.some,v=i.indexOf,C=i.lastIndexOf,D=Array.isArray,w=Object.keys,B=n.bind,S=function(e){return e instanceof S?e:this instanceof S?void(this._wrapped=e):new S(e)};e.exports&&(t=e.exports=S),t._=S,S.VERSION="1.4.4";var A=S.each=S.forEach=function(e,t,r){if(null!=e)if(f&&e.forEach===f)e.forEach(t,r);else if(e.length===+e.length){for(var o=0,i=e.length;o<i;o++)if(t.call(r,e[o],o,e)===a)return}else for(var s in e)if(S.has(e,s)&&t.call(r,e[s],s,e)===a)return};S.map=S.collect=function(e,t,r){var o=[];return null==e?o:h&&e.map===h?e.map(t,r):(A(e,(function(e,a,i){o[o.length]=t.call(r,e,a,i)})),o)};var k="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(e,t,r,o){var a=arguments.length>2;if(null==e&&(e=[]),y&&e.reduce===y)return o&&(t=S.bind(t,o)),a?e.reduce(t,r):e.reduce(t);if(A(e,(function(e,i,s){a?r=t.call(o,r,e,i,s):(r=e,a=!0)})),!a)throw new TypeError(k);return r},S.reduceRight=S.foldr=function(e,t,r,o){var a=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return o&&(t=S.bind(t,o)),a?e.reduceRight(t,r):e.reduceRight(t);var i=e.length;if(i!==+i){var s=S.keys(e);i=s.length}if(A(e,(function(n,d,l){d=s?s[--i]:--i,a?r=t.call(o,r,e[d],d,l):(r=e[d],a=!0)})),!a)throw new TypeError(k);return r},S.find=S.detect=function(e,t,r){var o;return L(e,(function(e,a,i){if(t.call(r,e,a,i))return o=e,!0})),o},S.filter=S.select=function(e,t,r){var o=[];return null==e?o:b&&e.filter===b?e.filter(t,r):(A(e,(function(e,a,i){t.call(r,e,a,i)&&(o[o.length]=e)})),o)},S.reject=function(e,t,r){return S.filter(e,(function(e,o,a){return!t.call(r,e,o,a)}),r)},S.every=S.all=function(e,t,r){t||(t=S.identity);var o=!0;return null==e?o:m&&e.every===m?e.every(t,r):(A(e,(function(e,i,s){if(!(o=o&&t.call(r,e,i,s)))return a})),!!o)};var L=S.some=S.any=function(e,t,r){t||(t=S.identity);var o=!1;return null==e?o:I&&e.some===I?e.some(t,r):(A(e,(function(e,i,s){if(o||(o=t.call(r,e,i,s)))return a})),!!o)};S.contains=S.include=function(e,t){return null!=e&&(v&&e.indexOf===v?-1!=e.indexOf(t):L(e,(function(e){return e===t})))},S.invoke=function(e,t){var r=l.call(arguments,2),o=S.isFunction(t);return S.map(e,(function(e){return(o?t:e[t]).apply(e,r)}))},S.pluck=function(e,t){return S.map(e,(function(e){return e[t]}))},S.where=function(e,t,r){return S.isEmpty(t)?r?null:[]:S[r?"find":"filter"](e,(function(e){for(var r in t)if(t[r]!==e[r])return!1;return!0}))},S.findWhere=function(e,t){return S.where(e,t,!0)},S.max=function(e,t,r){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-1/0;var o={computed:-1/0,value:-1/0};return A(e,(function(e,a,i){var s=t?t.call(r,e,a,i):e;s>=o.computed&&(o={value:e,computed:s})})),o.value},S.min=function(e,t,r){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return 1/0;var o={computed:1/0,value:1/0};return A(e,(function(e,a,i){var s=t?t.call(r,e,a,i):e;s<o.computed&&(o={value:e,computed:s})})),o.value},S.shuffle=function(e){var t,r=0,o=[];return A(e,(function(e){t=S.random(r++),o[r-1]=o[t],o[t]=e})),o};var P=function(e){return S.isFunction(e)?e:function(t){return t[e]}};S.sortBy=function(e,t,r){var o=P(t);return S.pluck(S.map(e,(function(e,t,a){return{value:e,index:t,criteria:o.call(r,e,t,a)}})).sort((function(e,t){var r=e.criteria,o=t.criteria;if(r!==o){if(r>o||void 0===r)return 1;if(r<o||void 0===o)return-1}return e.index<t.index?-1:1})),"value")};var R=function(e,t,r,o){var a={},i=P(t||S.identity);return A(e,(function(t,s){var n=i.call(r,t,s,e);o(a,n,t)})),a};S.groupBy=function(e,t,r){return R(e,t,r,(function(e,t,r){(S.has(e,t)?e[t]:e[t]=[]).push(r)}))},S.countBy=function(e,t,r){return R(e,t,r,(function(e,t){S.has(e,t)||(e[t]=0),e[t]++}))},S.sortedIndex=function(e,t,r,o){for(var a=(r=null==r?S.identity:P(r)).call(o,t),i=0,s=e.length;i<s;){var n=i+s>>>1;r.call(o,e[n])<a?i=n+1:s=n}return i},S.toArray=function(e){return e?S.isArray(e)?l.call(e):e.length===+e.length?S.map(e,S.identity):S.values(e):[]},S.size=function(e){return null==e?0:e.length===+e.length?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:l.call(e,0,t)},S.initial=function(e,t,r){return l.call(e,0,e.length-(null==t||r?1:t))},S.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:l.call(e,Math.max(e.length-t,0))},S.rest=S.tail=S.drop=function(e,t,r){return l.call(e,null==t||r?1:t)},S.compact=function(e){return S.filter(e,S.identity)};var W=function(e,t,r){return A(e,(function(e){S.isArray(e)?t?d.apply(r,e):W(e,t,r):r.push(e)})),r};S.flatten=function(e,t){return W(e,t,[])},S.without=function(e){return S.difference(e,l.call(arguments,1))},S.uniq=S.unique=function(e,t,r,o){S.isFunction(t)&&(o=r,r=t,t=!1);var a=r?S.map(e,r,o):e,i=[],s=[];return A(a,(function(r,o){(t?o&&s[s.length-1]===r:S.contains(s,r))||(s.push(r),i.push(e[o]))})),i},S.union=function(){return S.uniq(u.apply(i,arguments))},S.intersection=function(e){var t=l.call(arguments,1);return S.filter(S.uniq(e),(function(e){return S.every(t,(function(t){return S.indexOf(t,e)>=0}))}))},S.difference=function(e){var t=u.apply(i,l.call(arguments,1));return S.filter(e,(function(e){return!S.contains(t,e)}))},S.zip=function(){for(var e=l.call(arguments),t=S.max(S.pluck(e,"length")),r=new Array(t),o=0;o<t;o++)r[o]=S.pluck(e,""+o);return r},S.object=function(e,t){if(null==e)return{};for(var r={},o=0,a=e.length;o<a;o++)t?r[e[o]]=t[o]:r[e[o][0]]=e[o][1];return r},S.indexOf=function(e,t,r){if(null==e)return-1;var o=0,a=e.length;if(r){if("number"!=typeof r)return e[o=S.sortedIndex(e,t)]===t?o:-1;o=r<0?Math.max(0,a+r):r}if(v&&e.indexOf===v)return e.indexOf(t,r);for(;o<a;o++)if(e[o]===t)return o;return-1},S.lastIndexOf=function(e,t,r){if(null==e)return-1;var o=null!=r;if(C&&e.lastIndexOf===C)return o?e.lastIndexOf(t,r):e.lastIndexOf(t);for(var a=o?r:e.length;a--;)if(e[a]===t)return a;return-1},S.range=function(e,t,r){arguments.length<=1&&(t=e||0,e=0),r=arguments[2]||1;for(var o=Math.max(Math.ceil((t-e)/r),0),a=0,i=new Array(o);a<o;)i[a++]=e,e+=r;return i},S.bind=function(e,t){if(e.bind===B&&B)return B.apply(e,l.call(arguments,1));var r=l.call(arguments,2);return function(){return e.apply(t,r.concat(l.call(arguments)))}},S.partial=function(e){var t=l.call(arguments,1);return function(){return e.apply(this,t.concat(l.call(arguments)))}},S.bindAll=function(e){var t=l.call(arguments,1);return 0===t.length&&(t=S.functions(e)),A(t,(function(t){e[t]=S.bind(e[t],e)})),e},S.memoize=function(e,t){var r={};return t||(t=S.identity),function(){var o=t.apply(this,arguments);return S.has(r,o)?r[o]:r[o]=e.apply(this,arguments)}},S.delay=function(e,t){var r=l.call(arguments,2);return setTimeout((function(){return e.apply(null,r)}),t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(l.call(arguments,1)))},S.throttle=function(e,t){var r,o,a,i,s=0,n=function(){s=new Date,a=null,i=e.apply(r,o)};return function(){var d=new Date,l=t-(d-s);return r=this,o=arguments,l<=0?(clearTimeout(a),a=null,s=d,i=e.apply(r,o)):a||(a=setTimeout(n,l)),i}},S.debounce=function(e,t,r){var o,a;return function(){var i=this,s=arguments,n=function(){o=null,r||(a=e.apply(i,s))},d=r&&!o;return clearTimeout(o),o=setTimeout(n,t),d&&(a=e.apply(i,s)),a}},S.once=function(e){var t,r=!1;return function(){return r||(r=!0,t=e.apply(this,arguments),e=null),t}},S.wrap=function(e,t){return function(){var r=[e];return d.apply(r,arguments),t.apply(this,r)}},S.compose=function(){var e=arguments;return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var r in e)S.has(e,r)&&(t[t.length]=r);return t},S.values=function(e){var t=[];for(var r in e)S.has(e,r)&&t.push(e[r]);return t},S.pairs=function(e){var t=[];for(var r in e)S.has(e,r)&&t.push([r,e[r]]);return t},S.invert=function(e){var t={};for(var r in e)S.has(e,r)&&(t[e[r]]=r);return t},S.functions=S.methods=function(e){var t=[];for(var r in e)S.isFunction(e[r])&&t.push(r);return t.sort()},S.extend=function(e){return A(l.call(arguments,1),(function(t){if(t)for(var r in t)e[r]=t[r]})),e},S.pick=function(e){var t={},r=u.apply(i,l.call(arguments,1));return A(r,(function(r){r in e&&(t[r]=e[r])})),t},S.omit=function(e){var t={},r=u.apply(i,l.call(arguments,1));for(var o in e)S.contains(r,o)||(t[o]=e[o]);return t},S.defaults=function(e){return A(l.call(arguments,1),(function(t){if(t)for(var r in t)null==e[r]&&(e[r]=t[r])})),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e};var N=function(e,t,r,o){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof S&&(e=e._wrapped),t instanceof S&&(t=t._wrapped);var a=c.call(e);if(a!=c.call(t))return!1;switch(a){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==e)return o[i]==t;r.push(e),o.push(t);var s=0,n=!0;if("[object Array]"==a){if(n=(s=e.length)==t.length)for(;s--&&(n=N(e[s],t[s],r,o)););}else{var d=e.constructor,l=t.constructor;if(d!==l&&!(S.isFunction(d)&&d instanceof d&&S.isFunction(l)&&l instanceof l))return!1;for(var u in e)if(S.has(e,u)&&(s++,!(n=S.has(t,u)&&N(e[u],t[u],r,o))))break;if(n){for(u in t)if(S.has(t,u)&&!s--)break;n=!s}}return r.pop(),o.pop(),n};S.isEqual=function(e,t){return N(e,t,[],[])},S.isEmpty=function(e){if(null==e)return!0;if(S.isArray(e)||S.isString(e))return 0===e.length;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!(!e||1!==e.nodeType)},S.isArray=D||function(e){return"[object Array]"==c.call(e)},S.isObject=function(e){return e===Object(e)},A(["Arguments","Function","String","Number","Date","RegExp"],(function(e){S["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}})),S.isArguments(arguments)||(S.isArguments=function(e){return!(!e||!S.has(e,"callee"))}),S.isFunction=function(e){return"function"==typeof e},S.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},S.isNaN=function(e){return S.isNumber(e)&&e!=+e},S.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==c.call(e)},S.isNull=function(e){return null===e},S.isUndefined=function(e){return void 0===e},S.has=function(e,t){return p.call(e,t)},S.noConflict=function(){return r._=o,this},S.identity=function(e){return e},S.times=function(e,t,r){for(var o=Array(e),a=0;a<e;a++)o[a]=t.call(r,a);return o},S.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};j.unescape=S.invert(j.escape);var _={escape:new RegExp("["+S.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(j.unescape).join("|")+")","g")};S.each(["escape","unescape"],(function(e){S[e]=function(t){return null==t?"":(""+t).replace(_[e],(function(t){return j[e][t]}))}})),S.result=function(e,t){if(null==e)return null;var r=e[t];return S.isFunction(r)?r.call(e):r},S.mixin=function(e){A(S.functions(e),(function(t){var r=S[t]=e[t];S.prototype[t]=function(){var e=[this._wrapped];return d.apply(e,arguments),U.call(this,r.apply(S,e))}}))};var x=0;S.uniqueId=function(e){var t=++x+"";return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},E=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(e,t,r){var o;r=S.defaults({},r,S.templateSettings);var a=new RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(a,(function(t,r,o,a,n){return s+=e.slice(i,n).replace(E,(function(e){return"\\"+O[e]})),r&&(s+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),o&&(s+="'+\n((__t=("+o+"))==null?'':__t)+\n'"),a&&(s+="';\n"+a+"\n__p+='"),i=n+t.length,t})),s+="';\n",r.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{o=new Function(r.variable||"obj","_",s)}catch(e){throw e.source=s,e}if(t)return o(t,S);var n=function(e){return o.call(this,e,S)};return n.source="function("+(r.variable||"obj")+"){\n"+s+"}",n},S.chain=function(e){return S(e).chain()};var U=function(e){return this._chain?S(e).chain():e};S.mixin(S),A(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=i[e];S.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],U.call(this,r)}})),A(["concat","join","slice"],(function(e){var t=i[e];S.prototype[e]=function(){return U.call(this,t.apply(this._wrapped,arguments))}})),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},function(e,t,r){var o=r(119);t.FinsClient=o},function(e,t,r){"use strict";var o=r(13),a=r(17),i=r(128),s=r(129);t.client={tcp:{core:i.compose(s),complete:i.compose(s)},handler:{}},o.readdirSync(a.join(__dirname,"/handler/client")).filter((function(e){return".js"===e.substr(-3)})).forEach((function(e){t.client.tcp.complete=t.client.tcp.complete.compose(r(15)("./"+e)),t.client.serial.complete=t.client.serial.complete.compose(r(15)("./"+e)),t.client.handler[e.substr(0,e.length-3)]=r(15)("./"+e)})),t.server={tcp:{core:r(59),complete:r(59)},handler:{}},o.readdirSync(a.join(__dirname,"/handler/server")).filter((function(e){return".js"===e.substr(-3)})).forEach((function(e){t.server.tcp.complete=t.server.tcp.complete.compose(r(60)("./"+e)),t.server.handler[e.substr(0,e.length-3)]=r(60)("./"+e)}))},function(e,t){e.exports=require("stampit-state-machine")},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(1,t)}.bind(this),t=function(e,t){this.log.debug("handling read coils response.");var r=e.readUInt8(0),o=e.readUInt8(1),a={fc:r,byteCount:o,payload:e.slice(2),coils:[]};if(1===r){for(var i=0,s=0;s<o;s+=1)for(var n=1,d=e.readUInt8(2+s),l=0;l<8;l+=1)a.coils[i]=(d&n)>0,n<<=1,i+=1;t.defer.resolve(a)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readCoils=function(e,t){return new a(function(r,o){var a=Buffer.allocUnsafe(5);a.writeUInt8(1,0),a.writeUInt16BE(e,1),a.writeUInt16BE(t,3),this.queueRequest(1,a,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(2,t)}.bind(this),t=function(e,t){this.log.debug("handling read discrete inputs response.");var r=e.readUInt8(0),o=e.readUInt8(1),a=0,i={fc:r,byteCount:o,payload:e.slice(2),coils:[]};if(2===r){for(var s=0;s<o;s+=1)for(var n=1,d=e.readUInt8(2+s),l=0;l<8;l+=1)i.coils[a]=(d&n)>0,n<<=1,a+=1;t.defer.resolve(i)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readDiscreteInputs=function(e,t){return new a(function(r,o){var a=Buffer.allocUnsafe(5);a.writeUInt8(2),a.writeUInt16BE(e,1),a.writeUInt16BE(t,3),t>2e3?o():this.queueRequest(2,a,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(3,t)}.bind(this),t=function(e,t){this.log.debug("handling read holding registers response.");var r=e.readUInt8(0),o=e.readUInt8(1),a={fc:r,byteCount:o,payload:e.slice(2),register:[]};if(3===r){for(var i=o/2,s=0;s<i;s+=1)a.register.push(e.readUInt16BE(2+2*s));t.defer.resolve(a)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readHoldingRegisters=function(e,t){return new a(function(r,o){this.log.debug("Starting read holding registers request.");var a=Buffer.allocUnsafe(5);a.writeUInt8(3),a.writeUInt16BE(e,1),a.writeUInt16BE(t,3),this.queueRequest(3,a,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(4,t)}.bind(this),t=function(e,t){this.log.debug("handling read input registers response.");var r=e.readUInt8(0),o=e.readUInt8(1),a={fc:r,byteCount:o,payload:e.slice(2),register:[]};if(4===r){for(var i=o/2,s=0;s<i;s+=1)a.register.push(e.readUInt16BE(2+2*s));t.defer.resolve(a)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readInputRegisters=function(e,t){return new a(function(r,o){var a=Buffer.allocUnsafe(5);a.writeUInt8(4),a.writeUInt16BE(e,1),a.writeUInt16BE(t,3),this.queueRequest(4,a,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(15,t)}.bind(this),t=function(e,t){this.log.debug("handling multiple coils response.");var r=e.readUInt8(0),o={fc:r,startAddress:e.readUInt16BE(1),quantity:e.readUInt16BE(3)};15===r?t.defer.resolve(o):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeMultipleCoils=function(e,t,r){return new a(function(o,a){var i,s=Buffer.allocUnsafe(6);if(s.writeUInt8(15,0),s.writeUInt16BE(e,1),t instanceof Buffer)s.writeUInt16BE(r,3),s.writeUInt8(t.length,5),i=Buffer.concat([s,t]);else if(t instanceof Array){if(t.length>1968)return void a();var n=Math.ceil(t.length/8),d=0,l=0,u=0,c=Buffer.allocUnsafe(n);s.writeUInt16BE(t.length,3),s.writeUInt8(n,5);for(var p=0;p<t.length;p+=1)d+=t[p]?Math.pow(2,u):0,0!==(u=(u+1)%8)&&p!==t.length-1||(c.writeUInt8(d,l),l+=1,d=0);i=Buffer.concat([s,c])}this.queueRequest(15,i,{resolve:o,reject:a})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(16,t)}.bind(this),t=function(e,t){this.log.debug("handling multiple registers response.");var r=e.readUInt8(0),o={fc:r,startAddress:e.readUInt16BE(1),quantity:e.readUInt16BE(3)};16===r?t.defer.resolve(o):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeMultipleRegisters=function(e,t){return new a(function(r,o){var a,i=Buffer.allocUnsafe(6);if(i.writeUInt8(16),i.writeUInt16BE(e,1),t instanceof Buffer)t.length/2>123&&o(),i.writeUInt16BE(t.length/2,3),i.writeUInt8(t.length,5),a=Buffer.concat([i,t]);else{if(!(t instanceof Array))return void o();if(t.length>123)return void o();var s=Math.ceil(2*t.length),n=Buffer.allocUnsafe(s);i.writeUInt16BE(t.length,3),i.writeUInt8(s,5);for(var d=0;d<t.length;d+=1)n.writeUInt16BE(t[d],2*d);a=Buffer.concat([i,n])}this.queueRequest(16,a,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(5,t)}.bind(this),t=function(e,t){this.log.debug("handling write single coil response.");var r=e.readUInt8(0),o=e.readUInt16BE(1),a=e.readUInt16BE(3),i={fc:r,outputAddress:o,outputValue:0!==a&&(65280===a||void 0)};5===r?t.defer.resolve(i):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeSingleCoil=function(e,t){return new a(function(r,o){var a=t instanceof Buffer?t.readUInt8(0)>0:t,i=Buffer.allocUnsafe(5);i.writeUInt8(5,0),i.writeUInt16BE(e,1),i.writeUInt16BE(a?65280:0,3),this.queueRequest(5,i,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(6);e.exports=o().init((function(){var e=function(){this.addResponseHandler(6,t)}.bind(this),t=function(e,t){this.log.debug("handling write single register response.");var r=e.readUInt8(0),o={fc:r,registerAddress:e.readUInt16BE(1),registerValue:e.readUInt16BE(3),registerAddressRaw:e.slice(1,3),registerValueRaw:e.slice(3,5)};6===r?t.defer.resolve(o):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeSingleRegister=function(e,t){return new a(function(r,o){var a=t instanceof Buffer?t.readUInt16BE(0):t,i=Buffer.allocUnsafe(5);i.writeUInt8(6,0),i.writeUInt16BE(e,1),i.writeUInt16BE(a,3),this.queueRequest(6,i,{resolve:r,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var o=r(3),a=r(130),i=r(50),s=r(132);e.exports=o().compose(a).compose(i).init((function(){let e,t=[],o=[],a=[],i=function(){this.port||(this.port=502),this.hostname||(this.hostname="0.0.0.0");let t=this.injNet||r(7);e=t.createServer(),e.on("connection",function(e){let t=e.address();if(this.log.debug("new connection",t),this.whiteListIPs&&this.whiteListIPs.indexOf(t.address)<0)return this.log.debug("client connection REJECTED",t),e.end(),!1;a.push(e),d(e)}.bind(this)),e.listen(this.port,this.hostname,function(e){if(e)return this.log.debug("error while listening",e),void this.emit("error",e)}.bind(this)),this.log.debug("server is listening on port",this.hostname+":"+this.port),this.on("newState_ready",n),this.setState("ready")}.bind(this);var n=function(){if(!this.inState("processing")&&0!==o.length){this.setState("processing");var e=o.shift();this.onData(e.pdu,function(t){this.log.debug("sending tcp data");var r=Buffer.allocUnsafe(7);r.writeUInt16BE(e.request.trans_id,0),r.writeUInt16BE(e.request.protocol_ver,2),r.writeUInt16BE(t.length+1,4),r.writeUInt8(e.request.unit_id,6);var o=Buffer.concat([r,t]);e.socket.write(o),this.setState("ready")}.bind(this))}}.bind(this),d=function(e){let r=t.length;var a=function(){t[r]=void 0;for(let e=t.length-1;e>=0;e-=1){if(void 0!==t[e])break;t.splice(e,1)}this.log.debug("Client connection closed, remaining clients. ",t.length)}.bind(this);let i=s({socket:e,socketId:r,onRequest:function(e){o.push(e),n()},onEnd:a});t.push(i)}.bind(this);this.close=function(t){for(var r in a)a[r].destroy();e.close((function(){e.unref(),t&&t()}))},i()}))},function(e,t,r){var o={"./ReadCoils":61,"./ReadCoils.js":61,"./ReadDiscreteInputs":62,"./ReadDiscreteInputs.js":62,"./ReadHoldingRegisters":63,"./ReadHoldingRegisters.js":63,"./ReadInputRegisters":64,"./ReadInputRegisters.js":64,"./WriteMultipleCoils":65,"./WriteMultipleCoils.js":65,"./WriteMultipleRegisters":66,"./WriteMultipleRegisters.js":66,"./WriteSingleCoil":67,"./WriteSingleCoil.js":67,"./WriteSingleRegister":68,"./WriteSingleRegister.js":68};function a(e){var t=i(e);return r(t)}function i(e){if(!r.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=i,e.exports=a,a.id=60},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating read coils request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(1,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read coils request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(129,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),o=e.readUInt16BE(3);this.emit("readCoilsRequest",r,o);var a=this.getCoils();if(r>8*a.length||r+o>8*a.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(129,0),e.writeUInt8(2,1),void t(e)}var i=0,s=0,n=2,d=Math.ceil(o/8),l=Buffer.allocUnsafe(2+d);l.writeUInt8(1,0),l.writeUInt8(d,1);for(var u=r;u<r+o;u+=1){a.readUInt8(Math.floor(u/8))&1<<u%8&&(i+=1<<s%8),(s+=1)%8!=0&&u!==r+o-1||(l.writeUInt8(i,n),i=0,n+=1)}t(l)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var o=r(3)().init((function(){var e=function(){this.log.debug("initiating read discrete inputs request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(2,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read discrete inputs request."),5!==e.length){this.log.debug("wrong pdu length.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(130,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),o=e.readUInt16BE(3);this.emit("readDiscreteInputsRequest",r,o);var a=this.getDiscrete();if(r>8*a.length||r+o>8*a.length){this.log.debug("wrong pdu length.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(130,0),e.writeUInt8(2,1),void t(e)}var i=0,s=0,n=2,d=Math.ceil(o/8),l=Buffer.allocUnsafe(2+d);l.writeUInt8(2,0),l.writeUInt8(d,1);for(var u=r;u<r+o;u+=1){a.readUInt8(Math.floor(u/8))&1<<u%8&&(i+=1<<s%8),(s+=1)%8!=0&&u!==r+o-1||(l.writeUInt8(i,n),i=0,n+=1)}t(l)}.bind(this),this.responseDelay)}.bind(this);e()}));e.exports=o},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating read holding registers request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(3,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read holding registers request."),5!==e.length){this.log.debug("wrong pdu length.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(131,0),e.writeUInt8(2,1),void t(e)}var r=2*e.readUInt16BE(1),o=e.readUInt16BE(3);this.emit("readHoldingRegistersRequest",r,o);var a=this.getHolding();if(r>a.length||r+2*o>a.length){this.log.debug("request outside register boundaries.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(131,0),e.writeUInt8(2,1),void t(e)}var i=Buffer.allocUnsafe(2);i.writeUInt8(3,0),i.writeUInt8(2*o,1);var s=Buffer.concat([i,a.slice(r,r+2*o)]);this.log.debug("finished read holding register request."),t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating read input registers request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(4,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read input registers request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(132,0),e.writeUInt8(2,1),void t(e)}var r=2*e.readUInt16BE(1),o=e.readUInt16BE(3);this.emit("readInputRegistersRequest",r,o);var a=this.getInput();if(r>a.length||r+2*o>a.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(132,0),e.writeUInt8(2,1),void t(e)}var i=Buffer.allocUnsafe(2);i.writeUInt8(4,0),i.writeUInt8(2*o,1);var s=Buffer.concat([i,a.slice(r,r+2*o)]);t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating write multiple coils request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(15,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write multiple coils request."),e.length<3){let e=Buffer.allocUnsafe(2);return e.writeUInt8(143,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),o=e.readUInt16BE(3),a=e.readUInt8(5);this.emit("preWriteMultipleCoilsRequest",r,o,a);var i=this.getCoils();if(r>8*i.length||r+o>8*i.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(143,0),e.writeUInt8(2,1),void t(e)}var s,n,d=Buffer.allocUnsafe(5);d.writeUInt8(15,0),d.writeUInt16BE(r,1),d.writeUInt16BE(o,3);for(var l=e.readUInt8(6),u=0,c=r;c<r+o;c+=1)s=i.readUInt8(Math.floor(c/8)),n=Math.pow(2,u%8)&l?s|Math.pow(2,c%8):s&~Math.pow(2,c%8),i.writeUInt8(n,Math.floor(c/8)),(u+=1)%8==0&&u<o&&(l=e.readUInt8(6+Math.floor(u/8)));this.emit("postWriteMultipleCoilsRequest",r,o,a),t(d)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating write multiple registers request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(16,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write multiple registers request."),e.length<3){let e=Buffer.allocUnsafe(2);return e.writeUInt8(144,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),o=2*r,a=e.readUInt16BE(3),i=e.readUInt8(5);if(a>123){let e=Buffer.allocUnsafe(2);return e.writeUInt8(144,0),e.writeUInt8(3,1),void t(e)}this.emit("preWriteMultipleRegistersRequest",o,a,i);var s=this.getHolding();if(o>s.length||o+2*a>s.length){var n=Buffer.allocUnsafe(2);return n.writeUInt8(144,0),n.writeUInt8(2,1),void t(n)}var d=Buffer.allocUnsafe(5);d.writeUInt8(16,0),d.writeUInt16BE(r,1),d.writeUInt16BE(a,3),e.copy(s,o,6,6+i),this.emit("postWriteMultipleRegistersRequest",o,a,i),t(d)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating write single coil request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(5,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write single coil request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(133,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),o=!(0===e.readUInt16BE(3));if(0!==e.readUInt16BE(3)&&65280!==e.readUInt16BE(3)){let e=Buffer.allocUnsafe(2);return e.writeUInt8(133,0),e.writeUInt8(3,1),void t(e)}this.emit("preWriteSingleCoilRequest",r,o);var a=this.getCoils();if(r>8*a.length){var i=Buffer.allocUnsafe(2);return i.writeUInt8(133,0),i.writeUInt8(2,1),void t(i)}var s=Buffer.allocUnsafe(5);s.writeUInt8(5,0),s.writeUInt16BE(r,1),s.writeUInt16BE(o?65280:0,3);var n,d=a.readUInt8(Math.floor(r/8));n=o?d|Math.pow(2,r%8):d&~Math.pow(2,r%8),a.writeUInt8(n,Math.floor(r/8)),this.emit("postWriteSingleCoilRequest",r,o),t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e=function(){this.log.debug("initiating write single register request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(6,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write single register request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(134,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),o=2*r,a=e.readUInt16BE(3);this.emit("preWriteSingleRegisterRequest",o,a);var i=this.getHolding();if(o>i.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(134,0),e.writeUInt8(2,1),void t(e)}var s=Buffer.allocUnsafe(5);s.writeUInt8(6),s.writeUInt16BE(r,1),s.writeUInt16BE(a,3),i.writeUInt16BE(a,o),this.emit("postWriteSingleRegisterRequest",o,a),t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){var o=r(0),a=new(0,o.Schema)({parent:{type:String,default:""},type:{type:String,default:""},x:{type:Number,required:!0},y:{type:Number,required:!0},z:{type:Number,required:!0},yaw:{type:Number,required:!0},pitch:{type:Number,required:!0},roll:{type:Number,required:!0},time:{type:Date,required:!0}});e.exports=o.model("posCobots",a)},function(e,t){e.exports={oldEnableCalib1:!1,oldConfirm1:!1,heso1:0,oldEnableCalib2:!1,oldConfirm2:!1,heso2:0,oldFinish1:!1,oldFinish2:!1,saveFinish1:!1,saveFinish2:!1}},function(e,t,r){var o=r(0),a=new(0,o.Schema)({uuid:{type:String,required:!0},measure:{type:Array,required:!0},date:{type:Date,default:Date.now,timestamps:!0}});e.exports=o.model("Nanoenvis",a)},function(e,t,r){var o=r(4),a=r(1);const i=r(16),s=r(73),n=o.Port;var d=r(74),l=r(115).Server(d);a.IO=r(116)(l),l.listen(process.env.PORT||n,"");var u=r(5);function c(){process.exit(1)}s.system().then(e=>{i.compare(e.uuid+"1101111010",o.license,(function(t,r){!0===r&&console.log("Check LICENSE OK"),!1===r&&(console.log("Check LICENSE NG"),u.saveFeedbackFile("./Store/LicenseFeedback.json",e.uuid),setTimeout(c,3e3)),t&&(console.error(t),u.saveFeedbackFile("./Store/LicenseFeedback.json",t),setTimeout(c,3e3))}))}).catch(e=>{console.error(e),u.saveJsonFile("./Store/LicenseFeedback.json",e),setTimeout(c,3e3)}),process.on("uncaughtException",(function(e){console.log("Caught exception: ",e)}));setInterval((function(){a.TextField[0]=function(){var e=new Date,t=e.getHours();t=(t<10?"0":"")+t;var r=e.getMinutes();r=(r<10?"0":"")+r;var o=e.getSeconds();return t+":"+r+":"+(o=(o<10?"0":"")+o)}()}),1e3);if(o.ProjectOMRON)r(118)(),r(123)();if(o.ProjectOnsemi)r(125)();if(o.PLC_Schneider)r(127)();if(o.Cobot)r(134)();if(o.MobileRobot)r(135)();if(o.PLC_Mitsubishi)r(138)();if(o.PLC_Siemens)r(141)();if(o.PLC_ScaleMeasure)r(146)();if(o.Nanoenvi)r(149)();r(153)();setInterval((function(){JSON.stringify(a.Element)!==JSON.stringify(a.OldElement)&&(a.OldElement=a.Element.slice(),a.haveChangeElement=!0),JSON.stringify(a.BitAdjust)!==JSON.stringify(a.OldBitAdjust)&&(a.OldBitAdjust=a.BitAdjust.slice(),a.haveChangeBitAdjust=!0),JSON.stringify(a.BitDisplay)!==JSON.stringify(a.OldBitDisplay)&&(a.OldBitDisplay=a.BitDisplay.slice(),a.haveChangeBitDisplay=!0),JSON.stringify(a.WordAdjust)!==JSON.stringify(a.OldWordAdjust)&&(a.OldWordAdjust=a.WordAdjust.slice(),a.haveChangeWordAdjust=!0),JSON.stringify(a.WordDisplay)!==JSON.stringify(a.OldWordDisplay)&&(a.OldWordDisplay=a.WordDisplay.slice(),a.haveChangeWordDisplay=!0),JSON.stringify(a.DWordAdjust)!==JSON.stringify(a.OldDWordAdjust)&&(a.OldDWordAdjust=a.DWordAdjust.slice(),a.haveChangeDWordAdjust=!0),JSON.stringify(a.DWordDisplay)!==JSON.stringify(a.OldDWordDisplay)&&(a.OldDWordDisplay=a.DWordDisplay.slice(),a.haveChangeDWordDisplay=!0),JSON.stringify(a.TextField)!==JSON.stringify(a.OldTextField)&&(a.OldTextField=a.TextField.slice(),a.haveChangeTextField=!0),JSON.stringify(a.ListString)!==JSON.stringify(a.OldListString)&&(a.OldListString=a.ListString.slice(),a.haveChangeString=!0),JSON.stringify(a.Percent)!==JSON.stringify(a.OldPercent)&&(a.OldPercent=a.Percent.slice(),a.haveChangePercent=!0)}),200)},function(e,t){e.exports=require("systeminformation")},function(e,t,r){var o=r(4),a=r(0);a.Promise=Promise;var i="mongodb://localhost:27017";o.ProjectOnsemi&&(i="mongodb://localhost:27017/Onsemi"),o.ProjectOMRON&&(i="mongodb://localhost:27017/Omron"),o.Cobot&&(i="mongodb://localhost:27017/Cobot"),o.PLC_ScaleMeasure&&(i="mongodb://localhost:27017/ScaleMeasure"),o.Nanoenvi&&(i="mongodb://localhost:27017/Nanoenvi");function s(){a.connect(i,{auto_reconnect:!0}).catch(()=>{})}const n=a.connection;n.on("connecting",()=>{console.info("Connecting to MongoDB...")}),n.on("error",e=>{console.error("MongoDB connection error: "+e),a.disconnect()}),n.on("connected",()=>{console.info("Connected to MongoDB!")}),n.once("open",()=>{console.info("MongoDB connection opened!")}),n.on("reconnected",()=>{console.info("MongoDB reconnected!")}),n.on("disconnected",()=>{console.error("MongoDB disconnected! Reconnecting in 5s..."),setTimeout(()=>s(),5e3)}),s();var d=r(75),l=r(2),u=r(17),c=r(76),p=r(77),f=r(78),h=r(79),y=r(80),g=r(81),b=r(82),m=r(84),I=r(85),v=r(86),C=r(87),D=r(88),w=r(89),B=r(90),S=r(91),A=r(92),k=r(93),L=r(94),P=r(95),R=r(96),W=r(97),N=r(98),j=r(99),_=r(100),x=r(101),T=r(102),O=r(106),E=r(107),U=r(108),q=r(109),M=r(110),F=r(111),G=r(112),V=r(113);const z=r(114);var Y=l();Y.use(z.json({limit:"5mb"})),Y.use(z.urlencoded({limit:"5mb",extended:!0,parameterLimit:5e3})),Y.use(f()),Y.use(p("dev")),Y.use(l.json()),Y.use(l.urlencoded({extended:!1})),Y.use(c()),Y.use(l.static(u.join(__dirname,"public"))),Y.use((function(e,t,r){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),r()})),Y.use("/uploadImage",W),Y.use("/uploadMap",N),Y.use("/elementLibrary",j),Y.use("/point",h),Y.use("/product",y),Y.use("/goal",g),Y.use("/pointPickPlace",b),Y.use("/element",m),Y.use("/label",I),Y.use("/line",v),Y.use("/wordDisplay",C),Y.use("/wordAdjust",D),Y.use("/dwordDisplay",w),Y.use("/dwordAdjust",B),Y.use("/bitDisplay",S),Y.use("/map",A),Y.use("/bitAdjust",k),Y.use("/panel",L),Y.use("/textField",P),Y.use("/textFieldInput",R),Y.use("/groupControl",_),Y.use("/string",x),Y.use("/user",T),Y.use("/sampleRoute",O),Y.use("/formularProjectRoute",E),Y.use("/scaleProjectRoute",U),Y.use("/searchBox",q),Y.use("/searchBoxListRoute",M),Y.use("/reportScaleProject",F),Y.use("/airCheck",G),Y.use("/percent",V),Y.use((function(e,t,r){r(d(404))})),Y.use((function(e,t,r,o){r.locals.message=e.message,e&&console.log("Error: "+e.message),r.locals.error="development"===t.app.get("env")?e:{},r.status(e.status||500),r.render("error")})),e.exports=Y},function(e,t){e.exports=require("http-errors")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("cors")},function(e,t,r){var o=r(2).Router(),a=r(18),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{console.log("have get request"),s.refreshDataPoint=!0,t.send(s.resultpoint)}),o.post("/insert_point",(e,t,r)=>{new a({type:parseInt(s.TypeCobot),number:parseInt(e.body.number),offsetInX:parseInt(e.body.offsetInX),offsetInY:parseInt(e.body.offsetInY),offsetInZ:parseInt(e.body.offsetInZ),offsetInR:parseInt(e.body.offsetInR),offsetInAddX:parseInt(e.body.offsetInAddX),offsetInAddY:parseInt(e.body.offsetInAddY),PlaceX:parseInt(e.body.PlaceX),PlaceY:parseInt(e.body.PlaceY)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{type:parseInt(s.TypeCobot),number:parseInt(e.body.number),offsetInX:parseInt(e.body.offsetInX),offsetInY:parseInt(e.body.offsetInY),offsetInZ:parseInt(e.body.offsetInZ),offsetInR:parseInt(e.body.offsetInR),offsetInAddX:parseInt(e.body.offsetInAddX),offsetInAddY:parseInt(e.body.offsetInAddY),PlaceX:parseInt(e.body.PlaceX),PlaceY:parseInt(e.body.PlaceY)},message:"Add data success"}),s.refreshDataPoint=!0,console.log("insert db ok"))})}),o.put("/update_point",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==s.TypeCobot&&(r.type=s.TypeCobot),void 0!==e.body.number&&(r.number=e.body.number),void 0!==e.body.offsetInX&&(r.offsetInX=e.body.offsetInX),void 0!==e.body.offsetInY&&(r.offsetInY=e.body.offsetInY),void 0!==e.body.offsetInZ&&(r.offsetInZ=e.body.offsetInZ),void 0!==e.body.offsetInR&&(r.offsetInR=e.body.offsetInR),void 0!==e.body.offsetInAddX&&(r.offsetInAddX=e.body.offsetInAddX),void 0!==e.body.offsetInAddY&&(r.offsetInAddY=e.body.offsetInAddY),void 0!==e.body.PlaceX&&(r.PlaceX=e.body.PlaceX),void 0!==e.body.PlaceY&&(r.PlaceY=e.body.PlaceY);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPoint=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPoint=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_point",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPoint=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPoint=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(19),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataProduct=!0,t.send(s.resultProduct)}),o.post("/insert_product",(e,t,r)=>{new a({IdCode:e.body.IdCode,NameCode:e.body.NameCode,Weigh:parseInt(e.body.Weigh),Warehouse1:parseInt(e.body.Warehouse1),Warehouse2:parseInt(e.body.Warehouse2),Warehouse3:parseInt(e.body.Warehouse3)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{IdCode:e.body.IdCode,NameCode:e.body.NameCode,Weigh:parseInt(e.body.Weigh),Warehouse1:parseInt(e.body.Warehouse1),Warehouse2:parseInt(e.body.Warehouse2),Warehouse3:parseInt(e.body.Warehouse3)},message:"Add data success"}),s.refreshDataProduct=!0,console.log("insert db ok"))})}),o.put("/update_product",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.IdCode&&(r.IdCode=e.body.IdCode),void 0!==e.body.NameCode&&(r.NameCode=e.body.NameCode),void 0!==e.body.Weigh&&(r.Weigh=e.body.Weigh),void 0!==e.body.Warehouse1&&(r.Warehouse1=e.body.Warehouse1),void 0!==e.body.Warehouse2&&(r.Warehouse2=e.body.Warehouse2),void 0!==e.body.Warehouse3&&(r.Warehouse3=e.body.Warehouse3);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataProduct=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataProduct=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_product",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataProduct=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataProduct=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(20),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataGoal=!0,t.send(s.resultGoal)}),o.post("/insert_goal",(e,t,r)=>{new a({NameGoal:e.body.NameGoal,Warehouse1:parseInt(e.body.Warehouse1),Warehouse2:parseInt(e.body.Warehouse2),Warehouse3:parseInt(e.body.Warehouse3)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{NameGoal:e.body.NameGoal,Warehouse1:parseInt(e.body.Warehouse1),Warehouse2:parseInt(e.body.Warehouse2),Warehouse3:parseInt(e.body.Warehouse3)},message:"Add data success"}),s.refreshDataGoal=!0,console.log("insert db ok"))})}),o.put("/update_goal",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.NameGoal&&(r.NameGoal=e.body.NameGoal),void 0!==e.body.Warehouse1&&(r.Warehouse1=e.body.Warehouse1),void 0!==e.body.Warehouse2&&(r.Warehouse2=e.body.Warehouse2),void 0!==e.body.Warehouse3&&(r.Warehouse3=e.body.Warehouse3);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataGoal=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataGoal=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_goal",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataGoal=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataGoal=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(83),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{console.log("have get request"),s.refreshDataPointPickPlace=!0,t.send(s.resultpointPickPlace)}),o.post("/insert_point",(e,t,r)=>{const o=new a({type:parseInt(s.TypeCobot),pickX:parseInt(e.body.pickX),pickY:parseInt(e.body.pickY),placeX:parseInt(e.body.placeX),placeY:parseInt(e.body.placeY),placeZ_Layer1:parseInt(e.body.placeZ_Layer1),placeZ_Layer2:parseInt(e.body.placeZ_Layer2),placeZ_Layer3:parseInt(e.body.placeZ_Layer3),placeZ_Layer4:parseInt(e.body.placeZ_Layer4)});console.log(e.body),o.save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add Point PickPlace Success",data:{type:parseInt(s.TypeCobot),pickX:parseInt(e.body.pickX),pickY:parseInt(e.body.pickY),placeX:parseInt(e.body.placeX),placeY:parseInt(e.body.placeY),placeZ_Layer1:parseInt(e.body.placeZ_Layer1),placeZ_Layer2:parseInt(e.body.placeZ_Layer2),placeZ_Layer3:parseInt(e.body.placeZ_Layer3),placeZ_Layer4:parseInt(e.body.placeZ_Layer4)}}),s.refreshDataPointPickPlace=!0,console.log("insert db ok"))})}),o.put("/update_point",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.pickX&&(r.pickX=e.body.pickX),void 0!==e.body.pickY&&(r.pickY=e.body.pickY),void 0!==e.body.placeX&&(r.placeX=e.body.placeX),void 0!==e.body.placeY&&(r.placeY=e.body.placeY),void 0!==e.body.placeZ_Layer1&&(r.placeZ_Layer1=e.body.placeZ_Layer1),void 0!==e.body.placeZ_Layer2&&(r.placeZ_Layer2=e.body.placeZ_Layer2),void 0!==e.body.placeZ_Layer3&&(r.placeZ_Layer3=e.body.placeZ_Layer3),void 0!==e.body.placeZ_Layer4&&(r.placeZ_Layer4=e.body.placeZ_Layer4);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPointPickPlace=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPointPickPlace=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_point",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPointPickPlace=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPointPickPlace=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(0),a=new(0,o.Schema)({type:{type:Number,required:!0},pickX:{type:Number,required:!0},pickY:{type:Number,required:!0},placeX:{type:Number,required:!0},placeY:{type:Number,required:!0},placeZ_Layer1:{type:Number,required:!0},placeZ_Layer2:{type:Number,required:!0},placeZ_Layer3:{type:Number,required:!0},placeZ_Layer4:{type:Number,required:!0}});e.exports=o.model("pointPickPlace",a)},function(e,t,r){var o=r(2).Router(),a=r(21),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultElement)}),o.post("/insert_element",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),nameElement:e.body.nameElement,src:e.body.src}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Element Success",data:{parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),nameElement:e.body.nameElement,src:e.body.src}}),s.refreshDataElement=!0,console.log("insert db ok"))})}),o.put("/update_element",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.nameElement&&(r.nameElement=e.body.nameElement);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataElement=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_element",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataElement=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataElement=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(22),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultlabel)}),o.post("/insert_label",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),text:e.body.text,color:e.body.color,fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Label Success",data:{parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),text:e.body.text,color:e.body.color,fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl}}),s.refreshDataLabel=!0,console.log("insert db ok"))})}),o.put("/update_label",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataLabel=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataLabel=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_label",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataLabel=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataLabel=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(23),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultline)}),o.post("/insert_line",(e,t,r)=>{new a({parent:e.body.parent,idRun:e.body.idRun,type:e.body.type,left:parseInt(e.body.left),top:parseInt(e.body.top),length:parseInt(e.body.length)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Line Success",data:{parent:e.body.parent,idRun:e.body.idRun,type:e.body.type,left:parseInt(e.body.left),top:parseInt(e.body.top),length:parseInt(e.body.length)}}),s.refreshDataLine=!0,console.log("insert db ok"))})}),o.put("/update_line",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.idRun&&(r.idRun=e.body.idRun),void 0!==e.body.type&&(r.type=e.body.type),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.length&&(r.length=e.body.length);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataLine=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataLine=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_line",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataLine=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataLine=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(24),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultWordDisplay)}),o.post("/insert_wordDisplay",(e,t,r)=>{new a({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),noBorder:parseInt(e.body.noBorder),idGroupControl:e.body.idGroupControl,unit:e.body.unit}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add WordDisplay Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),noBorder:parseInt(e.body.noBorder),idGroupControl:e.body.idGroupControl,unit:e.body.unit}}),s.refreshDataWordDisplay=!0,console.log("insert db ok"))})}),o.put("/update_worddisplay",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.noBorder&&(r.noBorder=e.body.noBorder),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl),void 0!==e.body.unit&&(r.unit=e.body.unit);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataWordDisplay=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataWordDisplay=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_worddisplay",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataWordDisplay=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataWordDisplay=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(25),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultWordAdjust)}),o.post("/insert_wordAdjust",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl,unit:e.body.unit}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error - "+r)):(t.json({result:"success",message:"Add WordAdjust Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl,unit:e.body.unit}}),s.refreshDataWordAdjust=!0,console.log("insert db ok"))})}),o.put("/update_wordadjust",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl),void 0!==e.body.unit&&(r.unit=e.body.unit);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataWordAdjust=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataWordAdjust=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_wordadjust",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataWordAdjust=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataWordAdjust=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(26),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultDWordDisplay)}),o.post("/insert_dwordDisplay",(e,t,r)=>{new a({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl,unit:e.body.unit}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add DWordDispaly Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl,unit:e.body.unit}}),s.refreshDataDWordDisplay=!0,console.log("insert db ok"))})}),o.put("/update_dworddisplay",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl),void 0!==e.body.unit&&(r.unit=e.body.unit);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataDWordDisplay=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataDWordDisplay=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_dworddisplay",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataDWordDisplay=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataDWordDisplay=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(27),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultDWordAdjust)}),o.post("/insert_dwordAdjust",(e,t,r)=>{new a({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add DWordAdjust Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl}}),s.refreshDataDWordAdjust=!0,console.log("insert db ok"))})}),o.put("/update_dwordadjust",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataDWordAdjust=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataDWordAdjust=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_dwordadjust",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataDWordAdjust=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataDWordAdjust=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(28),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultBitDisplay)}),o.post("/insert_bitDisplay",(e,t,r)=>{const o=new a({parent:e.body.parent,status:e.body.status,tag:e.body.tag,text0:e.body.text0,text1:e.body.text1,color0:e.body.color0,color1:e.body.color1,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),nameImage0:e.body.nameImage0,nameImage1:e.body.nameImage1,type:parseInt(e.body.type),blink0:parseInt(e.body.blink0),blink1:parseInt(e.body.blink1),idGroupControl:e.body.idGroupControl});console.log(e.body),o.save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add BitDisplay success",data:{parent:e.body.parent,status:e.body.status,tag:e.body.tag,text0:e.body.text0,text1:e.body.text1,color0:e.body.color0,color1:e.body.color1,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),nameImage0:e.body.nameImage0,nameImage1:e.body.nameImage1,type:parseInt(e.body.type),blink0:parseInt(e.body.blink0),blink1:parseInt(e.body.blink1),idGroupControl:e.body.idGroupControl}}),s.refreshDataBitDisplay=!0,console.log("insert db ok"))})}),o.put("/update_bitdisplay",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.status&&(r.status=e.body.status),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text0&&(r.text0=e.body.text0),void 0!==e.body.text1&&(r.text1=e.body.text1),void 0!==e.body.color0&&(r.color0=e.body.color0),void 0!==e.body.color1&&(r.color1=e.body.color1),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.nameImage0&&(r.nameImage0=e.body.nameImage0),void 0!==e.body.nameImage1&&(r.nameImage1=e.body.nameImage1),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl),void 0!==e.body.blink0&&(r.blink0=e.body.blink0),void 0!==e.body.blink1&&(r.blink1=e.body.blink1);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataBitDisplay=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataBitDisplay=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_bitdisplay",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataBitDisplay=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataBitDisplay=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(29),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{console.log(s.resultMap),t.send(s.resultMap)}),o.post("/insert_map",(e,t,r)=>{new a({parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),sellectPoint:parseInt(e.body.sellectPoint),image1X:parseInt(e.body.image1X),image1Y:parseInt(e.body.image1Y),image2X:parseInt(e.body.image2X),image2Y:parseInt(e.body.image2Y),map1X:parseInt(e.body.map1X),map1Y:parseInt(e.body.map1Y),map2X:parseInt(e.body.map2X),map2Y:parseInt(e.body.map2Y),nameImage:e.body.nameImage,idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add Map success",data:{parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),sellectPoint:parseInt(e.body.sellectPoint),image1X:parseInt(e.body.image1X),image1Y:parseInt(e.body.image1Y),image2X:parseInt(e.body.image2X),image2Y:parseInt(e.body.image2Y),map1X:parseInt(e.body.map1X),map1Y:parseInt(e.body.map1Y),map2X:parseInt(e.body.map2X),map2Y:parseInt(e.body.map2Y),nameImage:e.body.nameImage,idGroupControl:e.body.idGroupControl}}),s.refreshDataMap=!0,console.log("insert db ok"))})}),o.put("/update_map",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.sellectPoint&&(r.sellectPoint=e.body.sellectPoint),void 0!==e.body.image1X&&(r.image1X=e.body.image1X),void 0!==e.body.image1Y&&(r.image1Y=e.body.image1Y),void 0!==e.body.image2X&&(r.image2X=e.body.image2X),void 0!==e.body.image2Y&&(r.image2Y=e.body.image2Y),void 0!==e.body.map1X&&(r.map1X=e.body.map1X),void 0!==e.body.map1Y&&(r.map1Y=e.body.map1Y),void 0!==e.body.map2X&&(r.map2X=e.body.map2X),void 0!==e.body.map2Y&&(r.map2Y=e.body.map2Y),void 0!==e.body.nameImage&&(r.nameImage=e.body.nameImage),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataMap=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataMap=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_map",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataMap=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataMap=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(30),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultBitAdjust)}),o.post("/insert_bitAdjust",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,status:e.body.status,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),type:parseInt(e.body.type),borderRadius:parseInt(e.body.borderRadius),colorText:e.body.colorText,colorOn:e.body.colorOn,colorOff:e.body.colorOff,myKeyPress:e.body.myKeyPress,idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add BitAdjust Success",data:{parent:e.body.parent,status:e.body.status,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),type:parseInt(e.body.type),borderRadius:parseInt(e.body.borderRadius),colorText:e.body.colorText,colorOn:e.body.colorOn,colorOff:e.body.colorOff,myKeyPress:e.body.myKeyPress,idGroupControl:e.body.idGroupControl}}),s.refreshDataBitAdjust=!0,console.log("insert db ok"))})}),o.put("/update_bitadjust",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.status&&(r.status=e.body.status),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.type&&(r.type=e.body.type),void 0!==e.body.borderRadius&&(r.borderRadius=e.body.borderRadius),void 0!==e.body.colorText&&(r.colorText=e.body.colorText),void 0!==e.body.colorOn&&(r.colorOn=e.body.colorOn),void 0!==e.body.colorOff&&(r.colorOff=e.body.colorOff),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl),void 0!==e.body.myKeyPress&&(r.myKeyPress=e.body.myKeyPress);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataBitAdjust=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataBitAdjust=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_bitadjust",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataBitAdjust=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataBitAdjust=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(31),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultPanel)}),o.post("/insert_panel",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),backgroundColor:e.body.backgroundColor,borderRadius:parseInt(e.body.borderRadius),boxShadow1:parseInt(e.body.boxShadow1),boxShadow2:parseInt(e.body.boxShadow2),boxShadow3:parseInt(e.body.boxShadow3),boxShadowColor:e.body.boxShadowColor,zIndex:parseInt(e.body.zIndex),margin:parseInt(e.body.margin),padding:parseInt(e.body.padding),idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Panel Success",data:{parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),backgroundColor:e.body.backgroundColor,borderRadius:parseInt(e.body.borderRadius),boxShadow1:parseInt(e.body.boxShadow1),boxShadow2:parseInt(e.body.boxShadow2),boxShadow3:parseInt(e.body.boxShadow3),boxShadowColor:e.body.boxShadowColor,zIndex:parseInt(e.body.zIndex),margin:parseInt(e.body.margin),padding:parseInt(e.body.padding),idGroupControl:e.body.idGroupControl}}),s.refreshDataPanel=!0,console.log("insert db ok"))})}),o.put("/update_panel",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.backgroundColor&&(r.backgroundColor=e.body.backgroundColor),void 0!==e.body.borderRadius&&(r.borderRadius=e.body.borderRadius),void 0!==e.body.boxShadow1&&(r.boxShadow1=e.body.boxShadow1),void 0!==e.body.boxShadow2&&(r.boxShadow2=e.body.boxShadow2),void 0!==e.body.boxShadow3&&(r.boxShadow3=e.body.boxShadow3),void 0!==e.body.boxShadowColor&&(r.boxShadowColor=e.body.boxShadowColor),void 0!==e.body.zIndex&&(r.zIndex=e.body.zIndex),void 0!==e.body.margin&&(r.margin=e.body.margin),void 0!==e.body.padding&&(r.padding=e.body.padding),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPanel=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPanel=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_panel",(e,t)=>{console.log(e.body),1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPanel=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPanel=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(32),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultTextField)}),o.post("/insert_textField",(e,t,r)=>{new a({parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows),idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add TextField Success",data:{parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows),idGroupControl:e.body.idGroupControl}}),s.refreshDataTextField=!0,console.log("insert db ok"))})}),o.put("/update_textField",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.label&&(r.label=e.body.label),void 0!==e.body.value&&(r.value=e.body.value),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.rows&&(r.rows=e.body.rows),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataTextField=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataTextField=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_textField",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataTextField=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataTextField=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(33),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultTextFieldInput)}),o.post("/insert_textFieldInput",(e,t,r)=>{new a({parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows),text:e.body.text,idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add WordDisplay Success",data:{parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows),text:e.body.text,idGroupControl:e.body.idGroupControl}}),s.refreshDataTextFieldInput=!0,console.log("insert db ok"))})}),o.put("/update_textFieldInput",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.label&&(r.label=e.body.label),void 0!==e.body.value&&(r.value=e.body.value),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.rows&&(r.rows=e.body.rows),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataTextFieldInput=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataTextFieldInput=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_textFieldInput",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataTextFieldInput=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataTextFieldInput=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(34),i=r(0),s=r(1);r(35);o.get("/getdata",(e,t)=>{s.refreshDataBitDisplayImageLibrary=!0,t.send(s.resultBitDisplayImageLibrary)}),o.post("/upload",(e,t,r)=>{3!==e.body.data.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"});new a({name:e.body.name,img:e.body.data}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add BitAdjust Success",data:{name:e.body.name,img:e.body.data}}),s.refreshDataBitDisplayImageLibrary=!0,console.log("insert db ok"))})}),o.delete("/delete",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataBitDisplayImageLibrary=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataBitDisplayImageLibrary=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(36),i=r(0),s=r(1);r(35);o.get("/getdata",(e,t)=>{s.refreshDataMapImageLibrary=!0,t.send(s.resultMapImageLibrary)}),o.post("/upload",(e,t,r)=>{3!==e.body.data.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"});new a({name:e.body.name,img:e.body.data}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add Map Image Success",data:{name:e.body.name,img:e.body.data}}),s.refreshDataMapImageLibrary=!0,console.log("insert db ok"))})}),o.delete("/delete",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataMapImageLibrary=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataMapImageLibrary=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(37),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataElementImageLibrary=!0,t.send(s.resultElementImageLibrary)}),o.post("/insert_element",(e,t,r)=>{new a({name:e.body.name}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Element Success",data:{name:e.body.name}}),s.refreshDataElementImageLibrary=!0,console.log("insert db ok"))})}),o.put("/update_elementLibrary",(e,t,r)=>{if(void 0!==e.body.imgRun){var o={};3!==e.body.imgRun.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}if(void 0!==e.body.imgStop){o={};3!==e.body.imgStop.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}if(void 0!==e.body.imgFault){o={};3!==e.body.imgFault.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}if(void 0!==e.body.imgLock){o={};3!==e.body.imgLock.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}let n={};if(1==i.Types.ObjectId.isValid(e.body._id)){n._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.imgRun&&(r.imgRun=e.body.imgRun),void 0!==e.body.imgStop&&(r.imgStop=e.body.imgStop),void 0!==e.body.imgFault&&(r.imgFault=e.body.imgFault),void 0!==e.body.imgLock&&(r.imgLock=e.body.imgLock);const o={new:!0};a.findOneAndUpdate(n,{$set:r},o,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataElementImageLibrary=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataElementImageLibrary=!0)})}else o.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataElementImageLibrary=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataElementImageLibrary=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(38),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataGroupControl=!0,t.send(s.resultGroupControl)}),o.post("/insert_groupControl",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),backgroundColor:e.body.backgroundColor,borderRadius:parseInt(e.body.borderRadius),boxShadow1:parseInt(e.body.boxShadow1),boxShadow2:parseInt(e.body.boxShadow2),boxShadow3:parseInt(e.body.boxShadow3),boxShadowColor:e.body.boxShadowColor,zIndex:parseInt(e.body.zIndex),margin:parseInt(e.body.margin),padding:parseInt(e.body.padding),leftIcon:parseInt(e.body.leftIcon),topIcon:parseInt(e.body.topIcon),widthIcon:parseInt(e.body.widthIcon),active:parseInt(e.body.active)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Panel Success",data:{parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),backgroundColor:e.body.backgroundColor,borderRadius:parseInt(e.body.borderRadius),boxShadow1:parseInt(e.body.boxShadow1),boxShadow2:parseInt(e.body.boxShadow2),boxShadow3:parseInt(e.body.boxShadow3),boxShadowColor:e.body.boxShadowColor,zIndex:parseInt(e.body.zIndex),margin:parseInt(e.body.margin),padding:parseInt(e.body.padding),leftIcon:parseInt(e.body.leftIcon),topIcon:parseInt(e.body.topIcon),widthIcon:parseInt(e.body.widthIcon),active:parseInt(e.body.active)}}),s.refreshDataGroupControl=!0,console.log("insert db ok"))})}),o.put("/update_groupControl",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.backgroundColor&&(r.backgroundColor=e.body.backgroundColor),void 0!==e.body.borderRadius&&(r.borderRadius=e.body.borderRadius),void 0!==e.body.boxShadow1&&(r.boxShadow1=e.body.boxShadow1),void 0!==e.body.boxShadow2&&(r.boxShadow2=e.body.boxShadow2),void 0!==e.body.boxShadow3&&(r.boxShadow3=e.body.boxShadow3),void 0!==e.body.boxShadowColor&&(r.boxShadowColor=e.body.boxShadowColor),void 0!==e.body.zIndex&&(r.zIndex=e.body.zIndex),void 0!==e.body.margin&&(r.margin=e.body.margin),void 0!==e.body.padding&&(r.padding=e.body.padding),void 0!==e.body.leftIcon&&(r.leftIcon=e.body.leftIcon),void 0!==e.body.topIcon&&(r.topIcon=e.body.topIcon),void 0!==e.body.widthIcon&&(r.widthIcon=e.body.widthIcon),void 0!==e.body.active&&(r.active=e.body.active);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataGroupControl=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataGroupControl=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_groupControl",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataGroupControl=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataGroupControl=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(1),i=r(39),s=r(0);o.get("/getdata",(e,t)=>{t.send(a.resultString)}),o.post("/insert_string",(e,t,r)=>{new i({parent:e.body.parent,tag:parseInt(e.body.tag),left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),text:e.body.text,color:e.body.color,fontSize:parseInt(e.body.fontSize),speedScroll:parseInt(e.body.speedScroll),idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add String Success",data:{parent:e.body.parent,tag:parseInt(e.body.tag),left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),text:e.body.text,color:e.body.color,fontSize:parseInt(e.body.fontSize),speedScroll:parseInt(e.body.speedScroll),idGroupControl:e.body.idGroupControl}}),a.refreshDataString=!0,console.log("insert db ok"))})}),o.put("/update_string",(e,t,r)=>{let o={};if(console.log(e.body),1==s.Types.ObjectId.isValid(e.body._id)){o._id=s.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.speedScroll&&(r.speedScroll=e.body.speedScroll),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};i.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),a.refreshDataString=!0):(t.json({result:"success",data:r,message:"Update successfully"}),a.refreshDataString=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_string",(e,t)=>{1==s.Types.ObjectId.isValid(e.body._id)?i.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),a.refreshDataString=!0),t.json({result:"success",data:{},message:"Delete successfully"}),a.refreshDataString=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(9),i=r(0),s=r(1);const{UserService:n}=r(40);o.get("/getdata",(e,t)=>{s.refreshDataUser=!0,t.send(s.resultUser)}),o.post("/signup",(e,t,r)=>{const{id:o,name:a,password:i,rePassword:d}=e.body;i!==d?t.json({result:"error",data:{},message:"Error is: password not match"}):n.signUp(o,a,i).then(e=>{t.json({result:"success",message:"Signup Success",data:e}),s.refreshDataUser=!0,console.log("insert db ok")}).catch(e=>{t.json({result:"error",data:{},status:e.statusCode||500,message:"Error is: "+e.message}),e.statusCode||console.log(e)})}),o.post("/signin",async(e,t)=>{console.log(e.body);const{id:r,password:o}=e.body;n.signIn(r,o).then(e=>{t.json({result:"success",message:"SignIn Success",data:e})}).catch(e=>{t.json({result:"error",data:{},status:e.statusCode||500,message:"Error is: "+e.message}),e.statusCode||console.log(e)})}),o.post("/check",async(e,t)=>{const{token:r}=e.headers;n.check(r).then(e=>{t.cookie("token",e.token,{httpOnly:!0}).sendStatus(200)}).catch(e=>{t.json({result:"error",data:{},status:e.statusCode||500,message:"Error is: "+e.message}),e.statusCode||console.log(e)})}),o.delete("/delete_user",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataProduct=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataUser=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){const o=r(104);e.exports={sign:function(e){return new Promise((t,r)=>{o.sign(e,"sdfdsf33432432sasdsads",{expiresIn:"1d"},(e,o)=>{if(e)return r(e);t(o)})})},verify:function(e){return new Promise((t,r)=>{o.verify(e,"sdfdsf33432432sasdsads",(e,o)=>{e&&r(e),delete o.iat,delete o.exp,t(o)})})}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){class r extends Error{constructor(e,t){super(e),this.statusCode=t}}e.exports={ServerError:r}},function(e,t,r){var o=r(2).Router(),a=r(41),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataSampleRoute=!0,t.send(s.resultSampleRoute)}),o.post("/insert_sample_route",(e,t,r)=>{new a({IdCode:e.body.IdCode,NameCode:e.body.NameCode,Amount:parseInt(e.body.Amount),Weigh:parseInt(e.body.Weigh),Goal:e.body.Goal,SampleNumber:parseInt(e.body.SampleNumber),Order:parseInt(e.body.Order)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{IdCode:e.body.IdCode,NameCode:e.body.NameCode,Amount:parseInt(e.body.Amount),Weigh:parseInt(e.body.Weigh),Goal:e.body.Goal,SampleNumber:parseInt(e.body.SampleNumber),Order:parseInt(e.body.Order)},message:"Add data success"}),s.refreshDataSampleRoute=!0,console.log("insert db ok"))})}),o.put("/update_sample_route",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.IdCode&&(r.IdCode=e.body.IdCode),void 0!==e.body.NameCode&&(r.NameCode=e.body.NameCode),void 0!==e.body.Weigh&&(r.Weigh=e.body.Weigh),void 0!==e.body.Amount&&(r.Amount=e.body.Amount),void 0!==e.body.Goal&&(r.Goal=e.body.Goal),void 0!==e.body.SampleNumber&&(r.SampleNumber=e.body.SampleNumber),void 0!==e.body.Order&&(r.Order=e.body.Order);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataProduct=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataSampleRoute=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_sample_route",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataSampleRoute=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataSampleRoute=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(42),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataFormularProject=!0,t.send(s.resultFormularProject)}),o.get("/gettype",(e,t)=>{t.send(s.xlData2)}),o.post("/insert_formular_project",(e,t,r)=>{new a({FormularNumber:parseInt(e.body.FormularNumber),FormularName:e.body.FormularName,Step:parseInt(e.body.Step),Type1:e.body.Type1,TypeValue:s.xlData2[0][e.body.Type1],TypeValueMachine:parseInt(e.body.TypeValueMachine),AbsolutePosition:parseInt(e.body.AbsolutePosition)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{FormularNumber:parseInt(e.body.FormularNumber),FormularName:e.body.FormularName,Step:parseInt(e.body.Step),Type1:e.body.Type1,TypeValue:s.xlData2[0][e.body.Type1],TypeValueMachine:parseInt(e.body.TypeValueMachine),AbsolutePosition:parseInt(e.body.AbsolutePosition)},message:"Add data success"}),s.refreshDataFormularProject=!0,console.log("insert db ok"))})}),o.put("/update_formular_project",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.FormularNumber&&(r.FormularNumber=e.body.FormularNumber),void 0!==e.body.FormularName&&(r.FormularName=e.body.FormularName),void 0!==e.body.Step&&(r.Step=e.body.Step),void 0!==e.body.Type1&&(r.Type1=e.body.Type1),void 0!==e.body.TypeValue&&(r.TypeValue=e.body.TypeValue),void 0!==e.body.AbsolutePosition&&(r.AbsolutePosition=e.body.AbsolutePosition),void 0!==e.body.TypeValueMachine&&(r.TypeValueMachine=e.body.TypeValueMachine);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataFormularProject=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataFormularProject=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_formular_project",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataFormularProject=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataFormularProject=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(10),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{s.refreshDataScaleProject=!0,t.send(s.resultScaleProject)}),o.post("/insert_scale_project",(e,t,r)=>{new a({ScaleNumber:parseInt(e.body.ScaleNumber),ProductName:e.body.ProductName,ProductCapacity:parseInt(e.body.ProductCapacity),ProductTonKho:parseInt(e.body.ProductTonKho),ProductHeSo:e.body.ProductHeSo}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{ScaleNumber:parseInt(e.body.ScaleNumber),ProductName:e.body.ProductName,ProductCapacity:parseInt(e.body.ProductCapacity),ProductTonKho:parseInt(e.body.ProductTonKho),ProductHeSo:e.body.ProductHeSo},message:"Add data success"}),s.refreshDataScaleProject=!0,console.log("insert db ok"))})}),o.put("/update_scale_project",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.ScaleNumber&&(r.ScaleNumber=e.body.ScaleNumber),void 0!==e.body.ProductName&&(r.ProductName=e.body.ProductName),void 0!==e.body.ProductCapacity&&(r.ProductCapacity=e.body.ProductCapacity),void 0!==e.body.ProductTonKho&&(r.ProductTonKho=e.body.ProductTonKho),void 0!==e.body.ProductHeSo&&(r.ProductHeSo=e.body.ProductHeSo);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataScaleProject=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataScaleProject=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_scale_project",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataScaleProject=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataScaleProject=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(43),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultSearchBox)}),o.post("/insert_searchBox",(e,t,r)=>{new a({parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error"+r)):(t.json({result:"success",message:"Add SearchBox Success",data:{parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl}}),s.refreshDataSearchBox=!0,console.log("insert db ok"))})}),o.put("/update_searchBox",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataSearchBox=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataSearchBox=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_searchBox",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataSearchBox=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataSearchBox=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(44),i=r(0),s=r(1),n=r(11);o.get("/getdata",(e,t)=>{s.refreshDataSearchBoxList=!0,t.send(n.GetSearchDataList())}),o.post("/insert_searchBoxList",(e,t,r)=>{new a({SearchBoxListNumber:parseInt(e.body.SearchBoxListNumber),SearchBoxListName:e.body.SearchBoxListName}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{SearchBoxListNumber:parseInt(e.body.SearchBoxListNumber),SearchBoxListName:e.body.SearchBoxListName},message:"Add data success"}),s.refreshDataSearchBoxList=!0,console.log("insert db ok"))})}),o.put("/update_searchBoxList",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.SearchBoxListNumber&&(r.SearchBoxListNumber=e.body.SearchBoxListNumber),void 0!==e.body.SearchBoxListName&&(r.SearchBoxListName=e.body.SearchBoxListName);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataScaleProject=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataSearchBoxList=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_searchBoxList",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataSearchBoxList=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataSearchBoxList=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(12),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{console.log(e.query.start),console.log(e.query.stop);var r=+e.query.start.replace(/\/Date\((.*?)\)\//g,"$1"),o=+e.query.stop.replace(/\/Date\((.*?)\)\//g,"$1");a.find({date:{$gte:new Date(r),$lte:new Date(o)}}).limit(1e3).sort().exec((e,r)=>{e?(console.log("get data from db error"),t.send([])):t.send(r)})}),o.post("/insert_report_scale_project",(e,t,r)=>{new a({ScaleNumber:e.body.ScaleNumber,NameProduct:e.body.NameProduct,NameCustomer:e.body.NameCustomer,NameOperator:e.body.NameOperator,AmoutProduct:parseInt(e.body.AmoutProduct),AmoutProductReal:parseInt(e.body.AmoutProductReal)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{ScaleNumber:e.body.ScaleNumber,NameProduct:e.body.NameProduct,NameCustomer:e.body.NameCustomer,NameOperator:e.body.NameOperator,AmoutProduct:parseInt(e.body.AmoutProduct),AmoutProductReal:parseInt(e.body.AmoutProductReal)},message:"Add data success"}),s.refreshDataReportScaleProject=!0,console.log("insert db ok"))})}),o.put("/update_report_scale_project",(e,t,r)=>{console.log(e.body);let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.ScaleNumber&&(r.ScaleNumber=e.body.ScaleNumber),void 0!==e.body.NameProduct&&(r.NameProduct=e.body.NameProduct),void 0!==e.body.NameCustomer&&(r.NameCustomer=e.body.NameCustomer),void 0!==e.body.NameOperator&&(r.NameOperator=e.body.NameOperator),void 0!==e.body.AmoutProduct&&(r.AmoutProduct=e.body.AmoutProduct),void 0!==e.body.AmoutProductReal&&(r.AmoutProductReal=e.body.AmoutProductReal);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataReportScaleProject=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataReportScaleProject=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_report_scale_project",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataReportScaleProject=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataReportScaleProject=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(1);o.get("/getdata",(e,t)=>{t.send(a.resultProjectNanoenvi)}),e.exports=o},function(e,t,r){var o=r(2).Router(),a=r(46),i=r(0),s=r(1);o.get("/getdata",(e,t)=>{t.send(s.resultPercent)}),o.post("/insert_percent",(e,t,r)=>{console.log(e.body);new a({parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl,unit:e.body.unit,rotate:parseInt(e.body.rotate),value:parseInt(e.body.value)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error - "+r)):(t.json({result:"success",message:"Add WordAdjust Success",data:{parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),idGroupControl:e.body.idGroupControl,unit:e.body.unit,rotate:parseInt(e.body.rotate),value:parseInt(e.body.value)}}),s.refreshDataPercent=!0,console.log("insert db ok"))})}),o.put("/update_percent",(e,t,r)=>{let o={};if(1==i.Types.ObjectId.isValid(e.body._id)){o._id=i.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.idGroupControl&&(r.idGroupControl=e.body.idGroupControl),void 0!==e.body.unit&&(r.unit=e.body.unit),void 0!==e.body.rotate&&(r.rotate=e.body.rotate),void 0!==e.body.value&&(r.value=e.body.value);const n={new:!0};a.findOneAndUpdate(o,{$set:r},n,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPercent=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPercent=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),o.delete("/delete_percent",(e,t)=>{1==i.Types.ObjectId.isValid(e.body._id)?a.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPercent=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPercent=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=o},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("objects-to-csv")},function(e,t,r){var o=r(1),a=r(5),i=r(4);e.exports=function(){var e=r(48);o.COMMUNICATION_PLC_OMRON=e.FinsClient(9600,i.PLC_Omron_IP),o.COMMUNICATION_PLC_OMRON.on("open",(function(){console.log("Ket noi den PLC"),o.TextField[1]="Opening Connect to PLC",StatusConnectPLC=1})),o.COMMUNICATION_PLC_OMRON.on("error",(function(e){StatusConnectPLC=0,o.TextField[1]="Error",console.log("Error: ",e)})),o.COMMUNICATION_PLC_OMRON.on("close",(function(e){StatusConnectPLC=0,o.TextField[1]="Close",console.log("clossing")})),o.COMMUNICATION_PLC_OMRON.on("reply",(function(e){StatusConnectPLC=1,o.TextField[1]="Connected","0101"==e.command&&e.values.length===i.PLC_Omron_Size_D0&&(o.Element=a.ReadWordOfPLC(i.PLC_Omron_WordStartElement,i.PLC_Omron_LengthOfWordElement,e.values),o.BitAdjust=a.ReadBitOfPLC(i.PLC_Omron_WordStartBitAdjust,i.PLC_Omron_LengthOfWordBitAdjust,e.values),o.WordBitAdjust=a.ReadWordOfPLC(i.PLC_Omron_WordStartBitAdjust,i.PLC_Omron_LengthOfWordBitAdjust,e.values),o.BitDisplay=a.ReadBitOfPLC(i.PLC_Omron_WordStartBitDisplay,i.PLC_Omron_LengthOfWordBitDisplay,e.values),o.WordDisplay=a.ReadWordOfPLC(i.PLC_Omron_WordStartWordDisplay,i.PLC_Omron_LengthOfWordWordDisplay,e.values),o.WordAdjust=a.ReadWordOfPLC(i.PLC_Omron_WordStartWordAdjust,i.PLC_Omron_LengthOfWordWordAdjust,e.values),o.DWordDisplay=a.ReadDWordOfPLC(i.PLC_Omron_WordStartDWordDisplay,i.PLC_Omron_LengthOfWordDWordDisplay,e.values),o.DWordAdjust=a.ReadDWordOfPLC(i.PLC_Omron_WordStartDWordAdjust,i.PLC_Omron_LengthOfWordDWordAdjust,e.values),o.ValueCommunicationPLC=a.ReadWordOfPLC(i.PLC_Omron_WordStartCommunicationPLC,i.PLC_Omron_LengthOfWordCommunicationPLC,e.values),i.PLC_Omron_Debug&&console.log("Debug: "+e.values)),"0101"==e.command&&e.values.length===i.PLC_Omron_LengthOfWordString1&&(o.ListString=a.ReadStringOfPLC(i.PLC_Omron_NumberWordInString,e.values)),"0101"==e.command&&e.values.length===i.PLC_Omron_LengthOfWordString2&&(o.ListString=o.ListString.concat(a.ReadStringOfPLC(i.PLC_Omron_NumberWordInString,e.values)))}));setInterval((function(){o.COMMUNICATION_PLC_OMRON.read("D0",i.PLC_Omron_Size_D0,(function(e,t){}))}),300)}},function(e,t,r){var o=r(120),a=r(8).inherits,i=r(121).EventEmitter,s=r(122);function n(e,t,r){if(!(this instanceof n))return new n(e,t,r);i.call(this),n.init.call(this,e,t,r)}e.exports=n,a(n,i),_compareArrays=function(e,t){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(e[r]!==t[r])return!1;return!0},_mergeArrays=function(e){for(var t=[],r=0,o=e.length;r<o;r++){var a=Object.prototype.toString.call(e[r]).split(" ").pop().split("]").shift().toLowerCase();a&&(t=t.concat(/^(array|collection|arguments|object)$/.test(a)?_mergeArrays(e[r]):e[r]))}return t},_keyFromValue=function(e,t){return Object.keys(e).filter((function(r){return e[r]===t}))[0]},_padHex=function(e,t){return"0"*e+t.toString(16).substr(-e)},_wordsToBytes=function(e){var t=[];if(e.length)for(var r in e)t.push((65280&e[r])>>8),t.push(255&e[r]);else t.push((65280&e)>>8),t.push(255&e);return t},_translateMemoryAddress=function(e){var t=e.match(/(.)([0-9]*):?([0-9]*)/),r={MemoryArea:t[1],Address:t[2],Bit:t[3]},o=[];return s.MemoryAreas[r.MemoryArea]?o.push([s.MemoryAreas[r.MemoryArea]]):o.push([130]),o.push(_wordsToBytes([r.Address])),o.push([0]),_mergeArrays(o)},_incrementSID=function(e){return e%254+1},_buildHeader=function(e){return[e.ICF,e.RSV,e.GCT,e.DNA,e.DA1,e.DA2,e.SNA,e.SA1,e.SA2,e.SID]},_buildPacket=function(e){return _mergeArrays(e)},_getResponseType=function(e){var t=[];return t.push(e[10]),t.push(e[11]),t},_processDefault=function(e,t){var r=e[9],o=e.slice(10,12).toString("hex"),a=e.slice(12,14).toString("hex");return{remotehost:t.address,sid:r,command:o,response:a}},_processStatusRead=function(e,t){var r=e[9],o=e.slice(10,12).toString("hex"),a=e.slice(12,14).toString("hex"),i=e[14],n=e[15],d={},l={};for(var u in s.FatalErrorData)0!=(e.readInt16BE(17)&s.FatalErrorData[u])&&d.push(u);for(var u in s.nonFatalErrorData)0!=(e.readInt16BE(18)&s.nonFatalErrorData[u])&&l.push(u);var c=s.Status,p=s.Modes;return{remotehost:t.address,sid:r,command:o,response:a,status:_keyFromValue(c,i),mode:_keyFromValue(p,n),fatalErrorData:d||null,nonFatalErrorData:l||null}},_processMemoryAreaRead=function(e,t){for(var r=[],o=e[9],a=e.slice(10,12).toString("hex"),i=e.slice(12,14).toString("hex"),s=e.slice(14,e.length),n=0;n<s.length;n+=2)r.push(s.readInt16BE(n));return{remotehost:t.address,sid:o,command:a,response:i,values:r}},_processReply=function(e,t){var r=s.Commands;switch(_getResponseType(e).join(" ")){case r.CONTROLLER_STATUS_READ.join(" "):return _processStatusRead(e,t);case r.MEMORY_AREA_READ.join(" "):return _processMemoryAreaRead(e,t);default:return _processDefault(e,t)}},_decodePacket=function(e,t){for(var r=[],o=e.slice(10,12).toString("hex"),a=e.slice(12,14).toString("hex"),i=e.slice(14,e.length),s=0;s<i.length;s+=2)r.push(i.readInt16BE(s));return{remotehost:t.address,command:o,code:a,values:r}},n.init=function(e,t,r){var a=this,i=s.DefaultHostValues,n=s.DefaultOptions;this.port=e||i.port,this.host=t||i.host,this.timeout=r&&r.timeout||n.timeout,this.socket=o.createSocket("udp4"),this.responded=!1,this.header=s.DefaultFinsHeader,this.socket.on("message",(function(e,t){a.responded=!0;var r=_processReply(e,t);a.emit("reply",r)})),this.socket.on("listening",(function(){a.emit("open")})),this.socket.on("close",(function(){a.emit("close")})),this.socket.on("error",(function(e){a.emit("error",e)})),this.timeout&&setTimeout((function(){0==a.responded&&a.emit("timeout",a.host)}),a.timeout)},n.prototype.read=function(e,t,r){this.header.SID=_incrementSID(this.header.SID);var o=_buildHeader(this.header),a=(e=_translateMemoryAddress(e),t=_wordsToBytes(t),s.Commands.MEMORY_AREA_READ),i=_buildPacket([o,a,[e,t]]),n=new Buffer(i);this.socket.send(n,0,n.length,this.port,this.host,r)},n.prototype.write=function(e,t,r){this.header.SID=_incrementSID(this.header.SID);var o=_buildHeader(this.header),a=(e=_translateMemoryAddress(e),_wordsToBytes(t.length||1)),i=s.Commands.MEMORY_AREA_WRITE,n=(t=_wordsToBytes(t),_buildPacket([o,i,[e,a,t]])),d=new Buffer(n);this.socket.send(d,0,d.length,this.port,this.host,r)},n.prototype.fill=function(e,t,r,o){this.header.SID=_incrementSID(this.header.SID);var a=_buildHeader(this.header),i=(e=_translateMemoryAddress(e),r=_wordsToBytes(r),s.Commands.MEMORY_AREA_FILL),n=(t=_wordsToBytes(t),_buildPacket([a,i,[e,r,t]])),d=new Buffer(n);this.socket.send(d,0,d.length,this.port,this.host,o)},n.prototype.run=function(e){this.header.SID=_incrementSID(this.header.SID);var t=_buildHeader(this.header),r=s.Commands.RUN,o=_buildPacket([t,r]),a=new Buffer(o);this.socket.send(a,0,a.length,this.port,this.host,e)},n.prototype.stop=function(e){this.header.SID=_incrementSID(this.header.SID);var t=_buildHeader(this.header),r=s.Commands.STOP,o=_buildPacket([t,r]),a=new Buffer(o);this.socket.send(a,0,a.length,this.port,this.host,e)},n.prototype.status=function(e){this.header.SID=_incrementSID(this.header.SID);var t=_buildHeader(this.header),r=s.Commands.CONTROLLER_STATUS_READ,o=_buildPacket([t,r]),a=new Buffer(o);this.socket.send(a,0,a.length,this.port,this.host,e)},n.prototype.close=function(){this.socket.close()}},function(e,t){e.exports=require("dgram")},function(e,t){e.exports=require("events")},function(e,t){e.exports.DefaultHostValues={host:"127.0.0.1",port:9600},e.exports.DefaultOptions={timeout:2e3},e.exports.DefaultFinsHeader={ICF:128,RSV:0,GCT:2,DNA:0,DA1:0,DA2:0,SNA:0,SA1:34,SA2:0,SID:0},e.exports.Commands={CONTROLLER_STATUS_READ:[6,1],MEMORY_AREA_READ:[1,1],MEMORY_AREA_WRITE:[1,2],MEMORY_AREA_FILL:[1,3],RUN:[4,1],STOP:[4,2]},e.exports.FatalErrorData={SYSTEM_ERROR:64,IO_SETTING_ERROR:1024,IO_POINT_OVERFLOW:2048,CPU_BUS_ERROR:16384,MEMORY_ERROR:32768},e.exports.NonFatalErrorData={PC_LINK_ERROR:1,HOST_LINK_ERROR:2,BATTERY_ERROR:16,REMOTE_IO_ERROR:32,SPECIAL_IO_UNIT_ERROR:256,IO_COLLATE_ERROR:512,SYSTEM_ERROR:32768},e.exports.Status={CPU_STANDBY:128,STOP:0,RUN:1},e.exports.Modes={MONITOR:2,DEBUG:1,RUN:4},e.exports.MemoryAreas={E:160,C:176,W:177,H:178,A:179,D:130},e.exports.Errors={"0000":"Completed normally","0001":"Service was interrupted","0101":"Local node not part of Network","0102":"Token time-out, node number too large","0103":"Number of transmit retries exceeded","0104":"Maximum number of frames exceeded","0105":"Node number setting error (range)","0106":"Node number duplication error"}},function(e,t,r){var o=r(124),a=r(1),i=r(4);e.exports=function(){a.IO.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",a.resultElement),e.emit("UpdateBitAdjust",a.resultBitAdjust),e.emit("UpdateBitDisplay",a.resultBitDisplay),e.emit("UpdateWordAdjust",a.resultWordAdjust),e.emit("UpdateWordDisplay",a.resultWordDisplay),e.emit("UpdateDWordAdjust",a.resultDWordAdjust),e.emit("UpdateDWordDisplay",a.resultDWordDisplay),e.emit("UpdateString",a.resultString),e.on("disconnect",(function(){console.log("ngat kekt noi")})),setInterval((function(){e.emit("UpdateElement",a.resultElement),e.emit("UpdateBitAdjust",a.resultBitAdjust),e.emit("UpdateBitDisplay",a.resultBitDisplay),e.emit("UpdateWordAdjust",a.resultWordAdjust),e.emit("UpdateWordDisplay",a.resultWordDisplay),e.emit("UpdateDWordAdjust",a.resultDWordAdjust),e.emit("UpdateDWordDisplay",a.resultDWordDisplay),e.emit("UpdateString",a.resutlString)}),6e4),e.on("Client-send-data",(function(e){if(console.log("Data socketio client: "+JSON.stringify(e)),"ElementForce_Run"!==e.NameCommand||isNaN(e.tag)||a.COMMUNICATION_PLC_OMRON.write("D1000",[100,100,e.tag,e.tag]),"ElementForce_Stop"!==e.NameCommand||isNaN(e.tag)||a.COMMUNICATION_PLC_OMRON.write("D1000",[101,101,e.tag,e.tag]),"ElementForce_Auto"!==e.NameCommand||isNaN(e.tag)||a.COMMUNICATION_PLC_OMRON.write("D1000",[102,102,e.tag,e.tag]),"ElementForce_Interlock"!==e.NameCommand||isNaN(e.tag)||a.COMMUNICATION_PLC_OMRON.write("D1000",[103,103,e.tag,e.tag]),"BitAdjustForce"===e.NameCommand&&!isNaN(e.tag))if(i.PLC_Omron_WriteUnSafe){if(parseInt(e.tag)/16<=i.PLC_Omron_LengthOfWordBitAdjust){let t=1<<parseInt(e.tag)%16,r=i.PLC_Omron_WordStartBitAdjust+parseInt(e.tag)/16,o=a.WordBitAdjust[Math.floor(parseInt(e.tag)/16)];console.log(a.WordBitAdjust[Math.floor(parseInt(e.tag)/16)]),o^=t,a.COMMUNICATION_PLC_OMRON.write("D"+r,[o])}}else a.COMMUNICATION_PLC_OMRON.write("D1000",[110,110,e.mode,e.mode,e.tag,e.tag]);if("BitAdjustForce"===e.NameCommand&&isNaN(e.tag)&&"ExportPos"==e.tag){o.savePositions("PositionSolomon",a.WordDisplay[4]+"\t"+a.WordDisplay[5]+"\t"+a.WordDisplay[6]+"\t"+a.WordDisplay[7]+"\t"+a.WordDisplay[8]+"\t"+a.WordDisplay[9])}if("WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(i.PLC_Omron_WriteUnSafe?parseInt(e.tag)<=i.PLC_Omron_LengthOfWordWordAdjust&&a.COMMUNICATION_PLC_OMRON.write("D"+(parseInt(i.PLC_Omron_WordStartWordAdjust)+parseInt(e.tag)),[e.value]):a.COMMUNICATION_PLC_OMRON.write("D1000",[111,111,e.tag,e.tag,e.value,e.value])),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var t=parseInt(e.value/65536),r=parseInt(e.value%65536);a.COMMUNICATION_PLC_OMRON.write("D1000",[112,112,e.tag,e.tag,t,t,r,r])}}))}))}},function(e,t,r){const o=r(13);var a=r(1);e.exports={savePositions:function(e,t){var r="log/"+e+".log",i=t+"\r\n";try{o.existsSync(r)||o.writeFile(r,"Data:\r\n",(function(e){e&&console.log("An error occured while writing JSON Object to File.")})),o.appendFile(r,i,(function(e){if(e)return console.log(e);console.log('successfully appended "'+i+'"'),a.IO.sockets.emit("Server-Send-Snackbar",{status:"success",message:"Export: "+i})}))}catch(e){console.error(e)}}}},function(e,t,r){var o=r(1),a=r(5),i=r(4);e.exports=function(e){var t=r(48).FinsClient(9600,i.PLC_Omron_IP);t.on("open",(function(){console.log("Ket noi den PLC"),o.TextField[1]="Opening Connect to PLC",StatusConnectPLC=1})),t.on("error",(function(e){StatusConnectPLC=0,o.TextField[1]="Error",console.log("Error: ",e)})),t.on("close",(function(e){StatusConnectPLC=0,o.TextField[1]="Close",console.log("clossing")})),t.on("reply",(function(e){StatusConnectPLC=1,o.TextField[1]="Connected","0101"==e.command&&e.values.length===i.PLC_Omron_Size_D0&&(o.Element=a.ReadWordOfPLC(i.PLC_Omron_WordStartElement,i.PLC_Omron_LengthOfWordElement,e.values),o.BitAdjust=a.ReadBitOfPLC(i.PLC_Omron_WordStartBitAdjust,i.PLC_Omron_LengthOfWordBitAdjust,e.values),o.WordBitAdjust=a.ReadWordOfPLC(i.PLC_Omron_WordStartBitAdjust,i.PLC_Omron_LengthOfWordBitAdjust,e.values),o.BitDisplay=a.ReadBitOfPLC(i.PLC_Omron_WordStartBitDisplay,i.PLC_Omron_LengthOfWordBitDisplay,e.values),o.WordDisplay=a.ReadWordOfPLC(i.PLC_Omron_WordStartWordDisplay,i.PLC_Omron_LengthOfWordWordDisplay,e.values),o.WordAdjust=a.ReadWordOfPLC(i.PLC_Omron_WordStartWordAdjust,i.PLC_Omron_LengthOfWordWordAdjust,e.values),o.DWordDisplay=a.ReadDWordOfPLC(i.PLC_Omron_WordStartDWordDisplay,i.PLC_Omron_LengthOfWordDWordDisplay,e.values),o.DWordAdjust=a.ReadDWordOfPLC(i.PLC_Omron_WordStartDWordAdjust,i.PLC_Omron_LengthOfWordDWordAdjust,e.values),o.ValueCommunicationPLC=a.ReadWordOfPLC(i.PLC_Omron_WordStartCommunicationPLC,i.PLC_Omron_LengthOfWordCommunicationPLC,e.values),i.PLC_Omron_Debug&&console.log("Debug: "+e.values)),"0101"==e.command&&e.values.length===i.PLC_Omron_LengthOfWordString1&&(o.ListString=a.ReadStringOfPLC(i.PLC_Omron_NumberWordInString,e.values)),"0101"==e.command&&e.values.length===i.PLC_Omron_LengthOfWordString2&&(o.ListString=o.ListString.concat(a.ReadStringOfPLC(i.PLC_Omron_NumberWordInString,e.values)))}));setInterval((function(){t.read("D0",i.PLC_Omron_Size_D0,(function(e,t){}))}),300);if(!0===i.PLC_Omron_Enable_String)setInterval((function(){t.read("D"+i.PLC_Omron_WordStartString1,i.PLC_Omron_LengthOfWordString1,(function(e,t){}))}),2e3),setInterval((function(){t.read("D"+i.PLC_Omron_WordStartString2,i.PLC_Omron_LengthOfWordString2,(function(e,t){}))}),2e3);r(126)(e,t);if(i.PLC_Omron_SocketServer){var s=r(7),n="";s.createServer((function(e){e.write("Echo server\r\n"),e.on("data",(function(t){if(n=t.toString("utf8"),0!=t[0]||0!=t[1]||0!=t[2]||0!=t[3]||0!=t[4]||0!=t[5]){console.log(n);let e=n.split("||");e[0].length>0&&(a.saveLog(e[0],e[1]+""),a.saveExcel("Report",n)),console.log(e[0]),console.log(e[0].length),console.log(e[1])}e.write("receiver_OK")}))})).listen(i.PLC_Omron_SocketServer_PORT,i.PLC_Omron_SocketServer_IP)}if(i.ProjectOnsemi){const{UserService:e}=r(40);setInterval(()=>{if(1===o.BitAdjust[0]&&0===o.BitAdjust[1]&&o.ValueCommunicationPLC[1]!==o.WordAdjust[0]&&!isNaN(o.WordAdjust[0]&&o.WordAdjust[0]<200))if(o.WordAdjust[0]>=o.resultProduct.length)t.write("D1000",[110,110,0,0,0,0]);else{let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=o.resultProduct[o.WordAdjust[0]].NameCode.split("");for(let e=0;e<a.length;e++)e<40&&(e%2==0&&(r[parseInt(e/2)]=a[e].charCodeAt()),e%2==1&&(r[parseInt(e/2)]=256*a[e].charCodeAt()+parseInt(r[parseInt(e/2)])));r[20]=parseInt(o.resultProduct[o.WordAdjust[0]].Warehouse1),r[21]=parseInt(o.resultProduct[o.WordAdjust[0]].Warehouse2),r[22]=parseInt(o.resultProduct[o.WordAdjust[0]].Warehouse3);let i=o.resultProduct[o.WordAdjust[0]].IdCode.split("");for(let e=0;e<i.length;e++)e<10&&(e%2==0&&(r[23+parseInt(e/2)]=i[e].charCodeAt()),e%2==1&&(r[23+parseInt(e/2)]=256*i[e].charCodeAt()+parseInt(r[23+parseInt(e/2)])));r[33]=parseInt(o.resultProduct[o.WordAdjust[0]].Weigh);var e=[200,o.WordAdjust[0]];t.write("D1000",e.concat(r)),console.log("Write Products")}if(0===o.BitAdjust[0]&&1===o.BitAdjust[1]&&o.ValueCommunicationPLC[1]!==o.WordAdjust[0]&&!isNaN(o.WordAdjust[0]&&o.WordAdjust[0]<200))if(o.WordAdjust[0]>=o.resultGoal.length)t.write("D1000",[110,110,0,0,1,1]);else{let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=o.resultGoal[o.WordAdjust[0]].NameGoal.split("");for(let e=0;e<a.length;e++)e<40&&(e%2==0&&(r[parseInt(e/2)]=a[e].charCodeAt()),e%2==1&&(r[parseInt(e/2)]=256*a[e].charCodeAt()+parseInt(r[parseInt(e/2)])));r[20]=parseInt(o.resultGoal[o.WordAdjust[0]].Warehouse1),r[21]=parseInt(o.resultGoal[o.WordAdjust[0]].Warehouse2),r[22]=parseInt(o.resultGoal[o.WordAdjust[0]].Warehouse3);e=[200,o.WordAdjust[0]];t.write("D1000",e.concat(r)),console.log("Write Goal")}let r=0;if(1===o.BitAdjust[48]&&(r=1),1===o.BitAdjust[49]&&(r=2),1===o.BitAdjust[50]&&(r=3),1===o.BitAdjust[51]&&(r=4),1===o.BitAdjust[52]&&(r=5),1===o.BitAdjust[53]&&(r=6),1===o.BitAdjust[54]&&(r=7),1===o.BitAdjust[55]&&(r=8),1===o.BitAdjust[56]&&(r=9),1===o.BitAdjust[57]&&(r=10),1===o.BitAdjust[58]&&(r=11),1===o.BitAdjust[59]&&(r=12),1===o.BitAdjust[60]&&(r=13),1===o.BitAdjust[61]&&(r=14),1===o.BitAdjust[62]&&(r=15),1===o.BitAdjust[63]&&(r=16),1===o.BitAdjust[64]&&(r=17),1===o.BitAdjust[65]&&(r=18),1===o.BitAdjust[66]&&(r=19),1===o.BitAdjust[67]&&(r=20),1===o.BitAdjust[68]&&(r=21),1===o.BitAdjust[69]&&(r=22),1===o.BitAdjust[70]&&(r=23),1===o.BitAdjust[71]&&(r=24),1===o.BitAdjust[72]&&(r=25),1===o.BitAdjust[73]&&(r=26),1===o.BitAdjust[74]&&(r=27),1===o.BitAdjust[75]&&(r=28),1===o.BitAdjust[76]&&(r=29),1===o.BitAdjust[77]&&(r=30),1===o.BitAdjust[78]&&(r=31),1===o.BitAdjust[79]&&(r=32),0===o.BitAdjust[0]&&0===o.BitAdjust[1]&&r>0&&o.ValueCommunicationPLC[1]!==o.WordAdjust[0]){let a=[];for(let e=0;e<o.resultSampleRoute.length;e++)o.resultSampleRoute[e].SampleNumber===r&&a.push(o.resultSampleRoute[e]);if(!isNaN(o.WordAdjust[0]&&o.WordAdjust[0]<200))if(o.WordAdjust[0]>=a.length)t.write("D1000",[110,110,0,0,47+r,47+r]);else{let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=a[o.WordAdjust[0]].NameCode.split("");for(let e=0;e<i.length;e++)e<40&&(e%2==0&&(r[parseInt(e/2)]=i[e].charCodeAt()),e%2==1&&(r[parseInt(e/2)]=256*i[e].charCodeAt()+parseInt(r[parseInt(e/2)])));let s=a[o.WordAdjust[0]].IdCode.split("");for(let e=0;e<s.length;e++)e<10&&(e%2==0&&(r[20+parseInt(e/2)]=s[e].charCodeAt()),e%2==1&&(r[20+parseInt(e/2)]=256*s[e].charCodeAt()+parseInt(r[20+parseInt(e/2)])));let n=a[o.WordAdjust[0]].Goal.split("");for(let e=0;e<n.length;e++)e<40&&(e%2==0&&(r[40+parseInt(e/2)]=n[e].charCodeAt()),e%2==1&&(r[40+parseInt(e/2)]=256*n[e].charCodeAt()+parseInt(r[40+parseInt(e/2)])));r[60]=parseInt(a[o.WordAdjust[0]].Amount),r[61]=parseInt(a[o.WordAdjust[0]].Weigh);e=[205,o.WordAdjust[0]];t.write("D1000",e.concat(r)),console.log("Write Products")}}},i.PLC_Omron_IntervalWriteData)}}},function(e,t,r){var o=r(1),a=r(4);e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateString",o.resultString),e.on("disconnect",(function(){console.log("ngat kekt noi")})),setInterval((function(){e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateString",o.resutlString)}),6e4),e.on("Client-send-data",(function(e){if(console.log("Data socketio client: "+JSON.stringify(e)),"ElementForce_Run"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[100,100,e.tag,e.tag]),"ElementForce_Stop"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[101,101,e.tag,e.tag]),"ElementForce_Auto"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[102,102,e.tag,e.tag]),"ElementForce_Interlock"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[103,103,e.tag,e.tag]),"BitAdjustForce"===e.NameCommand&&!isNaN(e.tag))if(a.PLC_Omron_WriteUnSafe){if(parseInt(e.tag)/16<=a.PLC_Omron_LengthOfWordBitAdjust){let r=1<<parseInt(e.tag)%16,i=a.PLC_Omron_WordStartBitAdjust+parseInt(e.tag)/16,s=o.WordBitAdjust[Math.floor(parseInt(e.tag)/16)];console.log(o.WordBitAdjust[Math.floor(parseInt(e.tag)/16)]),s^=r,t.write("D"+i,[s])}}else t.write("D1000",[110,110,e.mode,e.mode,e.tag,e.tag]);if("BitAdjustForce"===e.NameCommand&&isNaN(e.tag)){let r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=e.tag.split("_"),s=20;if("BitAdjustForce"===e.NameCommand&&"Custom"===i[0]){let e=i[1].split(""),o=i[2].split("");if(i[1].length<s&&i[2].length<s){for(let t=0;t<e.length;t++)t<40&&(t%2==0&&(r[parseInt(t/2)]=e[t].charCodeAt()),t%2==1&&(r[parseInt(t/2)]=256*e[t].charCodeAt()+parseInt(r[parseInt(t/2)])));for(let e=0;e<o.length;e++)e<40&&(e%2==0&&(a[parseInt(e/2)]=o[e].charCodeAt()),e%2==1&&(a[parseInt(e/2)]=256*o[e].charCodeAt()+parseInt(a[parseInt(e/2)])))}let n=[210].concat(r).concat(a);t.write("D1000",n)}"BitAdjustForce"===e.NameCommand&&"UpdateProductsList"===e.tag&&(o.LoadProductsToPLC=!0)}if("WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(a.PLC_Omron_WriteUnSafe?parseInt(e.tag)<=a.PLC_Omron_LengthOfWordWordAdjust&&t.write("D"+(parseInt(a.PLC_Omron_WordStartWordAdjust)+parseInt(e.tag)),[e.value]):t.write("D1000",[111,111,e.tag,e.tag,e.value,e.value])),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var r=parseInt(e.value/65536),i=parseInt(e.value%65536);t.write("D1000",[112,112,e.tag,e.tag,r,r,i,i])}}))}))}},function(e,t,r){var o=r(1),a=(r(5),r(4));e.exports=function(e){var t=r(49).client.tcp.complete({host:a.PLC_Schneider_IP,port:502,autoReconnect:!0,reconnectTimeout:2e3,timeout:5e3,unitId:0});t.connect(),t.on("connect",(function(){console.log("Da connect to Schneider"),o.StatusModbus=!0,StatusConnectPLC=1;r(133)(t,e);setInterval((function(){try{t.readHoldingRegisters(0,10).then((function(e){if(o.StatusCobot=e.register,console.log("Data Read Modbus: "+e.register),2===o.StatusCobot[0]){let e=[0];t.writeMultipleRegisters(9001,e).then((function(e){console.log("Write Modbus: "+e)}),console.error)}})).catch((function(e){console.log(e)})).done()}catch(e){console.log(e),StatusConnectPLC=0}}),1e3)})),t.on("error",(function(e){StatusConnectPLC=0,console.log("Error::"+StatusConnectPLC+e),o.StatusModbus=!1}))}},function(e,t,r){"use strict";var o=r(3),a=r(14),i=r(50),s={1:"ILLEGAL FUNCTION",2:"ILLEGAL DATA ADDRESS",3:"ILLEGAL DATA VALUE",4:"SLAVE DEVICE FAILURE",5:"ACKNOWLEDGE",6:"SLAVE DEVICE BUSY",8:"MEMORY PARITY ERROR",10:"GATEWAY PATH UNAVAILABLE",11:"GATEWAY TARGET DEVICE FAILED TO RESPOND"};e.exports=o().compose(i).compose(a).init((function(){var e={},t=null;this.reqFifo=[];var r=function(){this.timeout||(this.timeout=5e3),this.on("data",i),this.on("newState_ready",o),this.on("newState_closed",a)}.bind(this),o=function(){this.log.debug("Trying to flush data."),0!==this.reqFifo.length?((t=this.reqFifo.shift()).timeout=setTimeout(function(){t.defer.reject({err:"timeout"}),this.emit("trashCurrentRequest"),this.logError("Request timed out."),this.setState("error")}.bind(this),this.timeout),this.setState("waiting"),this.emit("send",t.pdu),this.log.debug("Data flushed.")):this.log.debug("Nothing in request pipe.")}.bind(this),a=function(){t&&(this.log.debug("Clearing timeout of the current request."),clearTimeout(t.timeout)),this.log.debug("Cleaning up request fifo."),this.reqFifo=[]}.bind(this),i=function(r){if(this.log.debug("received data"),t){if(clearTimeout(t.timeout),function(e){var r=e.readUInt8(0);if(r<128)return!1;var o=e.readUInt8(1),a={errorCode:r,exceptionCode:o,message:s[o]};return t.defer.reject(a),!0}(r))return this.log.debug("Received pdu describes an error."),t=null,void this.setState("ready");var o=e[t.fc];if(!o)throw this.log.debug("Found not handler for fc",t.fc),new Error("No handler implemented for fc "+t.fc);o(r,t),this.setState("ready")}else this.log.debug("No current request.")}.bind(this);this.addResponseHandler=function(t,r){return e[t]=r,this}.bind(this),this.queueRequest=function(e,t,r){var a={fc:e,defer:r,pdu:t};this.reqFifo.push(a),this.inState("ready")&&o()},r()}))},function(e,t,r){"use strict";var o=r(3);e.exports=o().init((function(){var e,t,o=0,a=o,i=!1,s=!1,n=Buffer.alloc(0),d=!0,l=function(){this.setState("init"),this.unitId||(this.unitId=0),this.protocolVersion||(this.protocolVersion=0),this.port||(this.port=502),this.host||(this.host="localhost"),this.autoReconnect||(this.autoReconnect=!1),this.reconnectTimeout||(this.reconnectTimeout=0),this.on("send",g),this.on("newState_error",y),this.on("trashCurrentRequest",b),this.on("stateChanged",this.log.debug)}.bind(this),u=function(){this.setState("connect"),t||((t=this.injectedSocket?this.injectedSocket:r(7).Socket()).on("connect",c),t.on("close",p),t.on("error",f),t.on("data",h)),t.connect(this.port,this.host)}.bind(this),c=function(){d=!1,this.emit("connect"),this.setState("ready")}.bind(this),p=function(e){this.log.debug("Socket closed with error",e),this.setState("closed"),this.emit("close"),i||!this.autoReconnect&&!s||setTimeout((function(){s=!1,u()}),this.reconnectTimeout||0)}.bind(this),f=function(e){this.logError("Socket Error",e),this.setState("error"),this.emit("error",e)}.bind(this),h=function(t){for(this.log.debug("received data"),n=Buffer.concat([n,t]);n.length>7;){var r=n.readUInt16BE(0),o=n.readUInt16BE(4),i=n.readUInt16BE(2);if(0!==i)return this.log.debug("current mbap contains invalid protocol id."),this.setState("error"),console.log(i),void this.emit("error",new Error("Socket out of sync, received invalid protocol id"));if(r===e)return void this.log.debug("current mbap contains trashed request id.");if(r!==a)return this.log.debug("current mbap contains invalid request id."),this.setState("error"),void this.emit("error",new Error("Socket out of sync, received invalid request id"));if(n.length<7+o-1)break;var s=n.slice(7,7+o-1);this.log.debug("PDU extracted"),this.emit("data",s),n=n.slice(s.length+7,n.length)}}.bind(this),y=function(){this.logError("Client in error state."),t.destroy()}.bind(this),g=function(e){this.log.debug("Sending pdu to the socket."),o=(o+1)%65535;var r=Buffer.allocUnsafe(7);r.writeUInt16BE(o,0),r.writeUInt16BE(this.protocolVersion,2),r.writeUInt16BE(e.length+1,4),r.writeUInt8(this.unitId,6);var i=Buffer.concat([r,e]);a=o,t.write(i)}.bind(this),b=function(){e=a};this.connect=function(){return this.setState("connect"),u(),this},this.reconnect=function(){return this.inState("closed")?(i=!1,s=!0,this.log.debug("Reconnecting client."),t.end(),this):this},this.close=function(){return d||(d=!0,i=!0,this.log.debug("Closing client on purpose."),t.end()),this},process.env.DEBUG&&(this.getSocket=function(){return t},this.setCurrentRequestId=function(e){a=e},this.registerOnSend=function(e){this.removeListener(g),this.on("send",e.bind(this))}),l()}))},function(e,t,r){"use strict";var o=r(3),a=r(131),i=r(14),s=o().compose(a,i).init((function(){var e,t,r,o,a={},i=function(){e=this.coils?this.coils:Buffer.alloc(1024,0),t=this.holding?this.holding:Buffer.alloc(1024,0),r=this.input?this.input:Buffer.alloc(1024,0),o=this.discrete?this.discrete:r}.bind(this);this.onData=function(e,t){var r=e.readUInt8(0),o=a[r];if(!o){this.log.debug("no handler for fc",r);var i=Buffer.alloc(2);return i.writeUInt8(r+128,0),i.writeUInt8(1,1),void t(i)}o(e,(function(e){t(e)}))}.bind(this),this.setRequestHandler=function(e,t){return this.log.debug("setting request handler",e),a[e]=t,this},this.getCoils=function(){return e},this.getInput=function(){return r},this.getHolding=function(){return t},this.getDiscrete=function(){return o},i()}));e.exports=s},function(e,t){e.exports=require("stampit-event-bus")},function(e,t,r){"use strict";var o=r(3),a=r(14);e.exports=o().compose(a).init((function(){let e=Buffer.alloc(0),t=function(){if(!this.socket||void 0===this.socketId||!this.onRequest)throw new Error("No Socket defined.");this.socket.on("end",this.onSocketEnd),this.socket.on("data",this.onSocketData),this.socket.on("error",this.onSocketError)}.bind(this);this.onSocketEnd=function(){this.onEnd&&this.onEnd(),this.log.debug("connection closed, socket",this.socketId)}.bind(this),this.onSocketData=function(t){for(this.log.debug("received data socket",this.socketId,t.byteLength),e=Buffer.concat([e,t]);e.length>8;){let t=e.readUInt16BE(4),r={trans_id:e.readUInt16BE(0),protocol_ver:e.readUInt16BE(2),unit_id:e.readUInt8(6)};if(e.length<7+t-1)break;let o=e.slice(7,7+t);this.log.debug("PDU extracted."),this.onRequest({request:r,pdu:o,socket:this.socket}),e=e.slice(o.length+7,e.length)}}.bind(this),this.onSocketError=function(e){this.logError("Socker error",e)}.bind(this),t()}))},function(e,t,r){r(18);var o=r(1),a=r(5);e.exports=function(e,t){o.ChoiseModbus&&setInterval((function(){try{e.readHoldingRegisters(o.WordDisplayCobotStart,o.LengthOfWordDisplayCobot+o.LengthOfWordAdjustCobot).then((function(e){o.WordDisplay=a.ReadWordOfPLC(0,o.LengthOfWordDisplayCobot,e.register),o.WordAdjust=a.ReadWordOfPLC(20,o.LengthOfWordAdjustCobot,e.register),o.WordAdjust.push(o.counter)})).catch((function(){console.error(r(8).inspect(arguments,{depth:null}))}))}catch(e){console.log(e),StatusConnectPLC=0}}),100)}},function(e,t,r){var o=r(1),a=r(5),i=r(4);e.exports=function(){var e,t,s,n,d,l,u,c,p,f,h,y,g=!1,b=r(69);var m=r(49).client.tcp.complete({host:i.Cobot_IP,port:502,autoReconnect:!0,reconnectTimeout:1e3,timeout:5e3,unitId:0});console.log("prepare connect cobot"),m.connect(),m.on("connect",(function(){console.log("Da connect to Cobot___________"),o.StatusModbus=!0,StatusConnectPLC=1,i.Cobot_Write&&setInterval((function(){try{console.log("read mb"),m.readInputRegisters(7025,12).then((function(r){if(u=parseInt(a.convertPosCobot(r.register[0],r.register[1])),c=parseInt(a.convertPosCobot(r.register[2],r.register[3])),p=parseInt(a.convertPosCobot(r.register[4],r.register[5])),f=parseInt(a.convertPosCobot(r.register[6],r.register[7])),h=parseInt(a.convertPosCobot(r.register[8],r.register[9])),y=parseInt(a.convertPosCobot(r.register[10],r.register[11])),g||(g=!0,e=u,t=c,s=p,n=f,d=h,l=y),u!==e||c!==t||p!==s||f!==n||h!==d||y!==l){e=u,t=c,s=p,n=f,d=h,l=y;new b({parent:"Cobot",type:"test",x:u,y:c,z:p,yaw:f,pitch:h,roll:y,time:(new Date).toISOString()}).save(e=>{e?console.log("insert db error",e):console.log("insert db ok")})}})).catch((function(e){console.log(e)})).done()}catch(e){console.log(e),StatusConnectPLC=0}}),50),i.Cobot_Read&&setInterval((function(){try{if(o.resultPosCobot.length>0)try{let e=[],t=0;m.readHoldingRegisters(9e3,10).then((function(r){r.register[0]<o.resultPosCobot.length&&OldWrite!==r.register[0]&&(OldWrite=r.register[0],t=0,e[0]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[1]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[2]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[3]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[4]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[5]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=1,e[6]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[7]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[8]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[9]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[10]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[11]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=2,e[12]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[13]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[14]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[15]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[16]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[17]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=3,e[18]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[19]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[20]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[21]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[22]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[23]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=4,e[24]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[25]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[26]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[27]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[28]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[29]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=5,e[30]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[31]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[32]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[33]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[34]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[35]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=6,e[36]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[37]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[38]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[39]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[40]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[41]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=7,e[42]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[43]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[44]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[45]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[46]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[47]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=8,e[48]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[49]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[50]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[51]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[52]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[53]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),t=9,e[54]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].x),e[55]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].y),e[56]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].z),e[57]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].yaw),e[58]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].pitch),e[59]=a.CheckNegativeNumber(o.resultPosCobot[10*a.getIndexCobotWriteMB(t,r.register[0])+t].roll),m.writeMultipleRegisters(9005,e).then((function(e){console.log(e)}),console.error))})).catch((function(){console.error(r(8).inspect(arguments,{depth:null}))}))}catch(e){console.log(e),StatusConnectPLC=0}}catch(e){console.log(e),StatusConnectPLC=0}}),10),m.on("error",(function(e){StatusConnectPLC=0,console.log("Error::"+StatusConnectPLC+e),o.StatusModbus=!1}))}))}},function(e,t,r){var o=r(1),a=(r(5),r(4));e.exports=function(e){var t=new(r(7).Socket);o.BitAdjust=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o.BitDisplay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o.WordAdjust=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o.WordDisplay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o.DWordAdjust=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o.DWordDisplay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o.TextField=["",""];var i=["","","","",""];ConnectMobile=()=>{try{console.log("Prepare Connect Mobile"),o.TextField[1]="Prepare Connect Mobile",t.connect(a.MobileRobot_Port,a.MobileRobot_IP,(function(){console.log("Connected"),o.TextField[1]="Connected",o.BitDisplay[0]=1}))}catch(e){console.log("Log mobile robot: "+e)}},ReconnectMobile=()=>{o.BitDisplay[0]=0,o.TextField[1]="Reconnect to Mobile",setTimeout(()=>{ConnectMobile()},5e3)},ConnectMobile(),t.on("error",(function(){o.TextField[1]="Error",o.BitDisplay[0]=0})),t.on("close",(function(e){o.TextField[1]="Close",ReconnectMobile(),o.BitDisplay[0]=0})),setInterval((function(){t.write("status\r\n")}),500),t.on("data",(function(r){tempCheck=r+"";var a=tempCheck.indexOf("Location"),s=tempCheck.indexOf("LocalizationScore:");if(a>0&&s>0&&a<s){let t=tempCheck.substring(a+10,s).split(" "),r=[{x:t[0],y:t[1]}];e.sockets.emit("PositionMobile",r)}var n=r+"";i[4]=i[3],i[3]=i[2],i[2]=i[1],i[1]=i[0],i[0]=n,o.TextField[2]=i[4]+"\r\n"+i[3]+"\r\n"+i[2]+"\r\n"+i[1]+"\r\n"+i[0],e.sockets.emit("StatusMobile",n),"Enter password:\r\n"==r&&(console.log("send password"),t.write("omron\r\n"))}));r(136)(e,t)}},function(e,t,r){var o=r(1);r(5),r(137).exec;e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.on("disconnect",(function(){console.log("ngat ket noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay)})),e.on("Client-send-data",(function(e){if(console.log(e),"BitAdjustForce"===e.NameCommand)try{t.write(e.tag+"\r\n")}catch(e){console.log(e)}if("WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(o.resultWordAdjust[e.tag]=e.value,console.log(o.resultWordAdjust)),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var r=parseInt(e.value/65536),a=parseInt(e.value%65536);conn.writeItems("ComPC",[112,112,e.tag,e.tag,r,r,a,a],()=>{console.log("can not write data Mitsubishi")})}if("TextFieldInput"===e.NameCommand){console.log(e);try{t.write(e.tag+" "+e.value+"\r\n")}catch(e){console.log(e)}}}))}))}},function(e,t){e.exports=require("child_process")},function(e,t,r){var o=r(1),a=r(5),i=r(4);e.exports=function(e){var t=new(r(139)),s={DataRegister:"D0,"+i.PLC_Mitsubishi_Size_D0,ComPC:i.PLC_Mitsubishi_ComPC+",10",WriteUnSafeBitAdjust:"D"+i.PLC_Mitsubishi_WordStartBitAdjust+",1",WriteUnSafeWordAdjust:i.PLC_Mitsubishi_WordStartWordAdjust+",1",WriteUnSafeDWordAdjust:i.PLC_Mitsubishi_WordStartDWordAdjust+",1"};function n(e,t){e&&(console.log("SOMETHING WENT WRONG READING VALUES!!!!"),o.TextField[1]="SOMETHING WENT WRONG READING VALUES!!!!"),console.log("Value Mitsubishi: "+t),t&&("BAD 255"===t.DataRegister[0]?o.TextField[1]="Disconnect PLC":o.TextField[1]="Connected PLC",o.ElementMitsubishi=a.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartElement,i.PLC_Mitsubishi_LengthOfWordElement,t.DataRegister),o.BitAdjustMitsubishi=a.ReadBitOfPLC(i.PLC_Mitsubishi_WordStartBitAdjust,i.PLC_Mitsubishi_LengthOfWordBitAdjust,t.DataRegister),o.WordBitAdjust=a.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartBitAdjust,i.PLC_Mitsubishi_LengthOfWordBitAdjust,t.DataRegister),o.BitDisplayMitsubishi=a.ReadBitOfPLC(i.PLC_Mitsubishi_WordStartBitDisplay,i.PLC_Mitsubishi_LengthOfWordBitDisplay,t.DataRegister),o.WordDisplayMitsubishi=a.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartWordDisplay,i.PLC_Mitsubishi_LengthOfWordWordDisplay,t.DataRegister),o.WordAdjustMitsubishi=a.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartWordAdjust,i.PLC_Mitsubishi_LengthOfWordWordAdjust,t.DataRegister),o.DWordDisplayMitsubishi=a.ReadDWordOfPLC(i.PLC_Mitsubishi_WordStartDWordDisplay,i.PLC_Mitsubishi_LengthOfWordDWordDisplay,t.DataRegister),o.DWordAdjustMitsubishi=a.ReadDWordOfPLC(i.PLC_Mitsubishi_WordStartDWordAdjust,i.PLC_Mitsubishi_LengthOfWordDWordAdjust,t.DataRegister),o.Element=o.ElementMitsubishi,o.BitAdjust=o.BitAdjustMitsubishi,o.BitDisplay=o.BitDisplayMitsubishi,o.WordAdjust=o.WordAdjustMitsubishi,o.WordDisplay=o.WordDisplayMitsubishi,o.DWordAdjust=o.DWordAdjustMitsubishi,o.DWordDisplay=o.DWordDisplayMitsubishi)}t.initiateConnection({port:"5050",host:i.PLC_Mitsubishi_IP,ascii:!1},(function(e){void 0!==e&&(o.TextField[1]=e,console.log(e));o.TextField[1]="Connected",console.log("Connected PLC Mitsubishi success"),t.setTranslationCB((function(e){return s[e]})),t.addItems("DataRegister");setInterval((function(){t.readAllItems(n)}),i.PLC_Mitsubishi_Interval_Communication)}));r(140)(e,t)}},function(e,t,r){var o=r(7),a=r(47),s=r(8);function n(){this.readReq=new Buffer(1500),this.writeReq=new Buffer(1500),this.resetPending=!1,this.resetTimeout=void 0,this.maxPDU=255,this.isoclient=void 0,this.isoConnectionState=0,this.requestMaxParallel=1,this.maxParallel=1,this.isAscii=1,this.octalInputOutput,this.parallelJobsNow=0,this.maxGap=5,this.doNotOptimize=!1,this.connectCallback=void 0,this.readDoneCallback=void 0,this.writeDoneCallback=void 0,this.connectTimeout=void 0,this.PDUTimeout=void 0,this.globalTimeout=4500,this.readPacketArray=[],this.writePacketArray=[],this.polledReadBlockList=[],this.instantWriteBlockList=[],this.globalReadBlockList=[],this.globalWriteBlockList=[],this.masterSequenceNumber=1,this.translationCB=C,this.connectionParams=void 0,this.connectionID="UNDEF",this.addRemoveArray=[],this.readPacketValid=!1,this.writeInQueue=!1,this.connectCBIssued=!1}function d(e,t,r){var o;o=void 0===r?"":" "+r,(void 0===t||0>=t)&&console.log("["+process.hrtime()+o+"] "+s.format(e))}function l(e){return!(!e.sent||!e.rcvd)}function u(e,t,r){var o;o=void 0===e?0:e.length;if(t.qualityBuffer=new Buffer(t.byteLength),t.qualityBuffer.fill(255),o<2)return t.valid=!1,void 0!==e?(t.errCode="Malformed MC Packet - Less Than 2 Bytes.  TDL "+e.length+" TP "+r+" RL"+o,d(t.errCode,0)):(t.errCode="Timeout error - zero length packet",d(t.errCode,1)),0;if(129!==e[0])return t.valid=!1,t.errCode="Invalid MC - Expected first byte (binary) to be 0x81 (129) - got "+function(e){e<0&&(e=4294967295+e+1);return"0x"+e.toString(16).toUpperCase()}(e[0])+" ("+e[0]+")",d(t.errCode),1;if(0!==e[1])return t.valid=!1,t.errCode="MC Error Response - Second Byte is "+e[1]+" and error code is "+e[2],d(t.errCode),1;if(expectedLength=t.byteLength,e.length-2!==expectedLength)return t.valid=!1,t.errCode="Invalid Response Length - Expected "+expectedLength+" but got "+(e.length-2)+" bytes.",d(t.errCode),1;r+=2;return t.valid=!0,t.byteBuffer=e.slice(2),d("Byte Buffer is:",2),d(t.byteBuffer,2),t.qualityBuffer.fill(192),d("Marking quality as good L"+t.qualityBuffer.length,2),-1}function c(e,t,r){return void 0===e||e.length<2?(t.valid=!1,t.errCode="Malformed Reply MC Packet - Less Than 2 Bytes"+e,d(t.errCode),t.writeQualityBuffer.fill(255),0):(0!==e.readUInt8(1)||130!==e[0]&&131!==e[0]?(e.length>2?d("Received response "+e[0]+" "+e[1]+" "+e[2]+") indicating write error on "+t.addr):d("Received response "+e[0]+" "+e[1]+") indicating write error on "+t.addr),t.writeQualityBuffer.fill(255)):t.writeQualityBuffer.fill(192),-1)}function p(e){var t=0;if(1===e.arrayLength)255===e.writeQualityBuffer[0]?e.writeQuality="BAD":e.writeQuality="OK";else for(e.writeQuality=[],arrayIndex=0;arrayIndex<e.arrayLength;arrayIndex++)255===e.writeQualityBuffer[t]?e.writeQuality[arrayIndex]="BAD":e.writeQuality[arrayIndex]="OK","X"==e.datatype&&(arrayIndex+e.bitOffset+1)%8!=0&&arrayIndex!=e.arrayLength-1||(t+=e.dtypelen)}function f(e,t){var r=0;new Buffer(4);if(e.arrayLength>1){"C"!=e.datatype&&"CHAR"!=e.datatype?(e.value=[],e.quality=[]):(e.value="",e.quality="");var o=e.bitOffset;for(e.bitNative&&(o=e.remainder),arrayIndex=0;arrayIndex<e.arrayLength;arrayIndex++){if(192!==e.qualityBuffer[r])e.value.push(e.badValue()),e.quality.push("BAD "+e.qualityBuffer[r]),d("Logging a Bad Quality thePointer "+r,2);else switch(e.quality instanceof Array?e.quality.push("OK"):e.quality="OK",e.datatype){case"REAL":t?e.value.push(D(e.byteBuffer,r)):e.value.push(e.byteBuffer.readFloatLE(r));break;case"DWORD":t?e.value.push(A(e.byteBuffer,r)):e.value.push(e.byteBuffer.readUInt32LE(r));break;case"DINT":t?e.value.push(B(e.byteBuffer,r)):e.value.push(e.byteBuffer.readInt32LE(r));break;case"INT":t?e.value.push(e.byteBuffer.readInt16BE(r)):e.value.push(e.byteBuffer.readInt16LE(r));break;case"WORD":t?e.value.push(e.byteBuffer.readUInt16BE(r)):e.value.push(e.byteBuffer.readUInt16LE(r));break;case"X":e.bitNative,t?e.value.push(!!(e.byteBuffer.readUInt16BE(r)>>o&1)):e.value.push(!!(e.byteBuffer.readUInt16LE(r)>>o&1));break;case"B":case"BYTE":t?arrayIndex%2?e.value.push(e.byteBuffer.readUInt8(r-1)):e.value.push(e.byteBuffer.readUInt8(r+1)):e.value.push(e.byteBuffer.readUInt8(r));break;case"C":case"CHAR":t?arrayIndex%2?e.value+=String.fromCharCode(e.byteBuffer.readUInt8(r-1)):e.value+=String.fromCharCode(e.byteBuffer.readUInt8(r+1)):e.value+=String.fromCharCode(e.byteBuffer.readUInt8(r));break;default:return d("Unknown data type in response - should never happen.  Should have been caught earlier.  "+e.datatype),0}"X"==e.datatype?(o++,e.bitNative?(arrayIndex+e.remainder+1)%16!=0&&arrayIndex!=e.arrayLength-1||(r+=e.dtypelen,o=0):(arrayIndex+e.bitOffset+1)%16!=0&&arrayIndex!=e.arrayLength-1||(r+=e.dtypelen,o=0)):r+=e.dtypelen}}else{if(192!==e.qualityBuffer[r])e.value=e.badValue(),e.quality="BAD "+e.qualityBuffer[r],d("Item Quality is Bad",1);else switch(e.quality="OK",d("Item Datatype (single value) is "+e.datatype,1),e.datatype){case"REAL":e.value=t?D(e.byteBuffer,r):e.byteBuffer.readFloatLE(r);break;case"DWORD":e.value=t?A(e.byteBuffer,r):e.byteBuffer.readUInt32LE(r);break;case"DINT":e.value=t?B(e.byteBuffer,r):e.byteBuffer.readInt32LE(r);break;case"INT":e.value=t?e.byteBuffer.readInt16BE(r):e.byteBuffer.readInt16LE(r);break;case"WORD":e.value=t?e.byteBuffer.readUInt16BE(r):e.byteBuffer.readUInt16LE(r);break;case"X":e.bitNative?e.value=t?!!(e.byteBuffer.readUInt16BE(r)>>e.remainder&1):!!(e.byteBuffer.readUInt16LE(r)>>e.remainder&1):e.value=t?!!(e.byteBuffer.readUInt16BE(r)>>e.bitOffset&1):!!(e.byteBuffer.readUInt16LE(r)>>e.bitOffset&1);break;case"B":case"BYTE":e.value=t?e.byteBuffer.readUInt8(r+1):e.byteBuffer.readUInt8(r);break;case"C":case"CHAR":e.value=t?String.fromCharCode(e.byteBuffer.readUInt8(r+1)):String.fromCharCode(e.byteBuffer.readUInt8(r));break;default:return d("Unknown data type in response - should never happen.  Should have been caught earlier.  "+e.datatype),0}r+=e.dtypelen}return r%2&&(r+=1),r}function h(e,t){var r,o;if(o=0,r=0,e.arrayLength>1){e.bitOffset;for(arrayIndex=0;arrayIndex<e.arrayLength;arrayIndex++){switch(e.datatype){case"REAL":t?w(e.writeBuffer,r,e.writeValue[arrayIndex]):e.writeBuffer.writeFloatLE(e.writeValue[arrayIndex],r);break;case"DWORD":t?k(e.writeBuffer,r,e.writeValue[arrayIndex]):e.writeBuffer.writeUInt32LE(e.writeValue[arrayIndex],r);break;case"DINT":t?S(e.writeBuffer,r,e.writeValue[arrayIndex]):e.writeBuffer.writeInt32LE(e.writeValue[arrayIndex],r);break;case"INT":t?e.writeBuffer.writeInt16BE(e.writeValue[arrayIndex],r):e.writeBuffer.writeInt16LE(e.writeValue[arrayIndex],r);break;case"WORD":t?e.writeBuffer.writeUInt16BE(e.writeValue[arrayIndex],r):e.writeBuffer.writeUInt16LE(e.writeValue[arrayIndex],r);break;case"X":arrayIndex%2?o|=!0===e.writeValue[arrayIndex]?1:0:o|=(!0===e.writeValue[arrayIndex]?1:0)<<4,e.writeBuffer.writeUInt8(o,r),e.writeBuffer.writeUInt8(0,r+1);break;case"B":case"BYTE":t?arrayIndex%2?e.writeBuffer.writeUInt8(e.writeValue[arrayIndex],r-1):e.writeBuffer.writeUInt8(e.writeValue[arrayIndex],r+1):e.writeBuffer.writeUInt8(Math.round(e.writeValue[arrayIndex]),r);break;case"C":case"CHAR":t?arrayIndex%2?e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(arrayIndex),r-1):e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(arrayIndex),r+1):e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(arrayIndex),r);break;default:return d("Unknown data type when preparing array write packet - should never happen.  Should have been caught earlier.  "+e.datatype),0}"X"==e.datatype?arrayIndex%2&&(r+=1,o=0):r+=e.dtypelen}}else{switch(e.datatype){case"REAL":t?w(e.writeBuffer,r,e.writeValue):e.writeBuffer.writeFloatLE(e.writeValue,r);break;case"DWORD":t?k(e.writeBuffer,r,e.writeValue):e.writeBuffer.writeUInt32LE(e.writeValue,r);break;case"DINT":t?S(e.writeBuffer,r,e.writeValue):e.writeBuffer.writeInt32LE(e.writeValue,r);break;case"INT":t?e.writeBuffer.writeInt16BE(e.writeValue,r):e.writeBuffer.writeInt16LE(e.writeValue,r);break;case"WORD":t?e.writeBuffer.writeUInt16BE(e.writeValue,r):e.writeBuffer.writeUInt16LE(e.writeValue,r);break;case"X":e.bitNative?(e.writeBuffer.writeUInt8(e.writeValue?16:0,r),e.writeBuffer.writeUInt8(0,r+1),d("Datatype is X writing "+e.writeValue+" tpi "+e.writeBuffer[0],1)):d("We don't support writing individual bits of non-native types - write the whole word externally please",0);break;case"B":case"BYTE":t?(e.writeBuffer.writeUInt8(Math.round(e.writeValue),r+1),e.writeBuffer.writeUInt8(0,r)):e.writeBuffer.writeUInt8(Math.round(e.writeValue),r);break;case"C":case"CHAR":t?(e.writeBuffer.writeUInt8(String.toCharCode(e.writeValue),r+1),e.writeBuffer.writeUInt8(0,r)):e.writeBuffer.writeUInt8(String.toCharCode(e.writeValue),r);break;default:return d("Unknown data type in write prepare - should never happen.  Should have been caught earlier.  "+e.datatype),0}r+=e.dtypelen}}function y(e){if("string"==typeof e){if("OK"!==e)return!1}else if(a.isArray(e))for(i=0;i<e.length;i++)if("string"!=typeof e[i]||"OK"!==e[i])return!1;return!0}function g(e,t,r){var o,a=new Buffer(300);return 4,e.bitNative?a[0]=t?2:1:a[0]=t?3:1,a[1]=255,r?(d("We're Ascii",2),a.writeUInt16BE(10,2)):(d("We're Binary",2),a.writeUInt16LE(10,2)),o=t?e.byteLengthWrite:0,r?a.writeUInt16BE(e.areaMCCode,4):a.writeUInt16LE(e.areaMCCode,8),r?t?a.writeUInt32BE(e.offset,6):a.writeUInt32BE(e.requestOffset,6):t?a.writeUInt32LE(e.offset,4):a.writeUInt32LE(e.requestOffset,4),e.bitNative&&t?a.writeUInt8(e.arrayLength,10):e.bitNative&&!t?a.writeUInt8(Math.ceil((e.arrayLength+e.remainder)/16),10):t?a.writeUInt8(e.byteLengthWrite/2,10):a.writeUInt8(e.byteLength/2,10),a.writeUInt8(0,11),t&&e.writeBuffer.copy(a,12,0,o),a.slice(0,12+o)}function b(e,t,r){"use strict";var o,a,i,s,n;if(o=new I,"_COMMERR"!==t){2==(a=e.split(",")).length?o.arrayLength=parseInt(a[1].replace(/[A-z]/gi,""),10):o.arrayLength=1,a[0]=a[0].replace("/",".");var l=a[0].split(".");if(l.length>2)d("Error - String Couldn't Split Properly.  Only one dot or slash.");else{switch(2==l.length&&(d("PostDotNumeric is "+(s=parseInt(l[1].replace(/[A-z]/gi,""),10)),2),a[0]=l[0]),o.offset=parseInt(a[0].replace(/[A-z]/gi,""),10),"X"!==(i=a[0].replace(/[0-9]/gi,""))&&"Y"!==i||!r||(n=o.offset,o.offset=parseInt(o.offset.toString(),8),isNaN(o.offset)&&(o.offset=n)),i){case"DFLOAT":o.addrtype="D",o.datatype="REAL",o.multidtypelen=4,o.remainder=0,o.requestOffset=o.offset,o.dtypelen=4;break;case"DDINT":o.addrtype="D",o.datatype="DINT",o.multidtypelen=4,o.remainder=0,o.requestOffset=o.offset,o.dtypelen=4;break;case"RFLOAT":o.addrtype="R",o.datatype="REAL",o.multidtypelen=4,o.remainder=0,o.requestOffset=o.offset,o.dtypelen=4;break;case"RDINT":o.addrtype="R",o.datatype="DINT",o.multidtypelen=4,o.remainder=0,o.requestOffset=o.offset,o.dtypelen=4;break;case"DSTR":o.addrtype="D",o.datatype="CHAR",o.multidtypelen=1,o.remainder=0,o.requestOffset=o.offset,o.dtypelen=1;break;case"RSTR":o.addrtype="R",o.datatype="CHAR",o.multidtypelen=1,o.remainder=0,o.requestOffset=o.offset,o.dtypelen=1;break;case"TN":case"CN":case"D":case"R":o.addrtype=i,void 0!==s?(o.datatype="X",o.bitOffset=s):o.datatype="INT","CN"===o.addrtype&&o.offset>=200?(o.dtypelen=4,o.multidtypelen=4,o.datatype="DINT"):(o.dtypelen=2,o.multidtypelen=2),o.remainder=0,o.requestOffset=o.offset;break;case"TS":case"CS":o.addrtype=i,o.datatype="X",o.multidtypelen=2,o.remainder=o.offset%16,o.requestOffset=o.offset-o.remainder,o.dtypelen=2;break;case"X":case"Y":case"M":case"S":o.addrtype=i,o.datatype="X",o.multidtypelen=2,o.remainder=o.offset%16,o.requestOffset=o.offset-o.remainder,o.dtypelen=2;break;default:return void d("Failed to find a match for "+a[0]+" possibly because "+i+" type is not supported yet.")}switch("D"===o.addrtype||"R"===o.addrtype||"TN"===o.addrtype||"CN"===o.addrtype?o.bitNative=!1:o.bitNative=!0,o.addrtype){case"D":o.areaMCCode=17440;break;case"R":o.areaMCCode=21024;break;case"TN":o.areaMCCode=21582;break;case"TS":o.areaMCCode=21587;break;case"CN":o.areaMCCode=17230;break;case"CS":o.areaMCCode=17235;break;case"X":o.areaMCCode=22560;break;case"Y":o.areaMCCode=22816;break;case"M":o.areaMCCode=19744;break;case"S":o.areaMCCode=21280;break;default:return void d("Failed to find a match for "+o.addrtype+" possibly because that type is not supported yet.")}if(o.addr=e,o.useraddr=void 0===t?e:t,"X"===o.datatype?o.wordLength=Math.ceil((o.remainder+o.arrayLength)/16):o.wordLength=o.arrayLength*o.dataTypeByteLength()/2,o.byteLength=2*o.wordLength,o.byteLengthWrite=o.bitNative?Math.ceil(o.arrayLength/2):o.byteLength,o.totalArrayLength=o.arrayLength,!("CN"===o.addrtype&&o.requestOffset<200&&o.requestOffset+o.arrayLength>200))return o;d("IMPORTANT NOTE: You can't have a counter array that crosses the 200-point boundary.")}}}function m(){this.seqNum=void 0,this.itemList=void 0,this.reqTime=void 0,this.sent=!1,this.rcvd=!1,this.timeoutError=void 0,this.timeout=void 0}function I(){this.areaMCCode=void 0,this.bitNative=void 0,this.startRegister=void 0,this.byteLengthWrite=void 0,this.addr=void 0,this.useraddr=void 0,this.addrtype=void 0,this.datatype=void 0,this.bitOffset=void 0,this.byteOffset=void 0,this.offset=void 0,this.arrayLength=void 0,this.totalArrayLength=void 0,this.maxWordLength=function(e){if(void 0===this.addrtype)return 1;switch(this.addrtype){case"D":case"R":case"TN":return 64;case"CN":return void 0===this.offset||this.offset<0?1:this.offset>=200?32:Math.max(199-this.offset,64);case"TS":case"CS":case"X":case"Y":case"M":case"S":return e?40:16;default:return void d("Failed to find a match for "+theItem.addrtype+" possibly because that type is not supported yet.")}},this.dataTypeByteLength=function(){if(void 0===this.addrtype)return 1;switch(this.addrtype){case"D":case"R":return"REAL"===this.datatype||"DINT"===this.datatype||"DWORD"===this.datatype?4:"CHAR"===this.datatype?1:2;case"TN":return 2;case"CN":return void 0===this.offset||this.offset<0?1:this.offset>=200?4:2;case"TS":case"CS":case"X":case"Y":case"M":case"S":return 1;default:return void d("Failed to find a match for "+theItem.addrtype+" possibly because that type is not supported yet.")}},this.dtypelen=void 0,this.multidtypelen=void 0,this.areaMCCode=void 0,this.byteLength=void 0,this.byteLengthWithFill=void 0,this.readTransportCode=void 0,this.writeTransportCode=void 0,this.byteBuffer=new Buffer(8192),this.writeBuffer=new Buffer(8192),this.qualityBuffer=new Buffer(8192),this.writeQualityBuffer=new Buffer(8192),this.value=void 0,this.writeValue=void 0,this.valid=!1,this.errCode=void 0,this.part=void 0,this.maxPart=void 0,this.isOptimized=!1,this.resultReference=void 0,this.itemReference=void 0,this.clone=function(){var e=new I;for(var t in this)"clone"!=t&&(e[t]=this[t]);return e},this.badValue=function(){switch(this.datatype){case"REAL":return 0;case"DWORD":case"DINT":case"INT":case"WORD":case"B":case"BYTE":return 0;case"X":return!1;case"C":case"CHAR":return"";default:return d("Unknown data type when figuring out bad value - should never happen.  Should have been caught earlier.  "+this.datatype),0}}}function v(e,t){return e.areaMCCode<t.areaMCCode?-1:e.areaMCCode>t.areaMCCode?1:e.offset<t.offset?-1:e.offset>t.offset?1:e.bitOffset<t.bitOffset?-1:e.bitOffset>t.bitOffset?1:e.byteLength>t.byteLength?-1:e.byteLength<t.byteLength?1:void 0}function C(e){return e}function D(e,t){var r=new Buffer(4);return r[0]=e[t+2],r[1]=e[t+3],r[2]=e[t+0],r[3]=e[t+1],r.readFloatBE(0)}function w(e,t,r){var o=new Buffer(4);o.writeFloatBE(r,0),e[t+2]=o[0],e[t+3]=o[1],e[t+0]=o[2],e[t+1]=o[3]}function B(e,t){var r=new Buffer(4);return r[0]=e[t+2],r[1]=e[t+3],r[2]=e[t+0],r[3]=e[t+1],r.readInt32BE(0)}function S(e,t,r){var o=new Buffer(4);o.writeInt32BE(Math.round(r),0),e[t+2]=o[0],e[t+3]=o[1],e[t+0]=o[2],e[t+1]=o[3]}function A(e,t){var r=new Buffer(4);return r[0]=e[t+2],r[1]=e[t+3],r[2]=e[t+0],r[3]=e[t+1],r.readUInt32BE(0)}function k(e,t,r){var o=new Buffer(4);o.writeUInt32BE(Math.round(r),0),e[t+2]=o[0],e[t+3]=o[1],e[t+0]=o[2],e[t+1]=o[3]}function L(e){var t,r;if(e&&!(e.length%2)){for(r=new Buffer(e.length/2),t=0;t<e.length;t+=2)if(r[t/2]=parseInt("0x"+e.toString("ascii",t,t+2)),isNaN(r[t/2]))return;return r}}function P(e){var t,r,o,a;if(e){for(r=new Buffer(2*e.length),t=0;t<e.length;t+=1)r.write((o=e[t],a=void 0,a=2-o.toString(16).length+1,Array(+(a>0&&a)).join("0")+o.toString(16)),2*t,2,"ascii");return r}}e.exports=n,n.prototype.setTranslationCB=function(e){"function"==typeof e&&(d("Translation OK"),this.translationCB=e)},n.prototype.initiateConnection=function(e,t){void 0===e&&(e={port:1e4,host:"192.168.8.106",ascii:!1}),d("Initiate Called - Connecting to PLC with address and parameters:"),d(e),void 0===e.name?this.connectionID=e.host:this.connectionID=e.name,void 0===e.ascii?this.isAscii=!1:this.isAscii=e.ascii,void 0===e.octalInputOutput?this.octalInputOutput=!0:this.octalInputOutput=e.octalInputOutput,this.connectionParams=e,this.connectCallback=t,this.connectCBIssued=!1,this.connectNow(this.connectionParams,!1)},n.prototype.dropConnection=function(){void 0!==this.isoclient&&this.isoclient.end(),this.connectionCleanup()},n.prototype.connectNow=function(e,t){var r=this;r.isoConnectionState>=1||(r.connectionCleanup(),r.isoclient=o.connect(e,(function(){r.onTCPConnect.apply(r,arguments)})),r.isoclient.setKeepAlive(!0,2500),r.isoConnectionState=1,r.isoclient.on("error",(function(){r.connectError.apply(r,arguments)})),d("<initiating a new connection>",1,r.connectionID),d("Attempting to connect to host...",0,r.connectionID))},n.prototype.connectError=function(e){d("We Caught a connect error "+e.code,0,this.connectionID),this.connectCBIssued||"function"!=typeof this.connectCallback||(this.connectCBIssued=!0,this.connectCallback(e)),this.isoConnectionState=0},n.prototype.readWriteError=function(e){d("We Caught a read/write error "+e.code+" - resetting connection",0,this.connectionID),this.isoConnectionState=0,this.connectionReset()},n.prototype.packetTimeout=function(e,t){return d("PacketTimeout called with type "+e+" and seq "+t,1,this.connectionID),"read"===e?(d("READ TIMEOUT on sequence number "+t,0,this.connectionID),void this.readResponse(void 0)):"write"===e?(d("WRITE TIMEOUT on sequence number "+t,0,this.connectionID),void this.writeResponse(void 0)):void d("Unknown timeout error.  Nothing was done - this shouldn't happen.",0,this.connectionID)},n.prototype.onTCPConnect=function(){var e=this;d("TCP Connection Established to "+e.isoclient.remoteAddress+" on port "+e.isoclient.remotePort,0,e.connectionID),e.isoConnectionState=4,e.isoclient.removeAllListeners("data"),e.isoclient.removeAllListeners("error"),e.isoclient.on("data",(function(){e.onResponse.apply(e,arguments)})),e.isoclient.on("error",(function(){e.readWriteError.apply(e,arguments)})),e.connectCBIssued||"function"!=typeof e.connectCallback||(e.connectCBIssued=!0,e.connectCallback())},n.prototype.writeItems=function(e,t,r){var o;if(d("Preparing to WRITE "+e,0,this.connectionID),this.isWriting())d("You must wait until all previous writes have finished before scheduling another. ",0,this.connectionID);else{if(this.writeDoneCallback="function"==typeof r?r:C,this.instantWriteBlockList=[],"string"==typeof e)this.instantWriteBlockList.push(b(this.translationCB(e),e,this.octalInputOutput)),void 0!==this.instantWriteBlockList[this.instantWriteBlockList.length-1]&&(this.instantWriteBlockList[this.instantWriteBlockList.length-1].writeValue=t);else if(a.isArray(e)&&a.isArray(t)&&e.length==t.length)for(o=0;o<e.length;o++)"string"==typeof e[o]&&(this.instantWriteBlockList.push(b(this.translationCB(e[o]),e[o],this.octalInputOutput)),void 0!==this.instantWriteBlockList[this.instantWriteBlockList.length-1]&&(this.instantWriteBlockList[this.instantWriteBlockList.length-1].writeValue=t[o]));for(o=this.instantWriteBlockList.length-1;o>=0;o--)void 0===this.instantWriteBlockList[o]&&(this.instantWriteBlockList.splice(o,1),d("Dropping an undefined write item."));this.prepareWritePacket(),this.isReading()?this.writeInQueue=!0:this.sendWritePacket()}},n.prototype.findItem=function(e){var t,r={value:4!==this.isoConnectionState,quality:"OK"};if("_COMMERR"===e)return r;for(t=0;t<this.polledReadBlockList.length;t++)if(this.polledReadBlockList[t].useraddr===e)return this.polledReadBlockList[t]},n.prototype.addItems=function(e){this.addRemoveArray.push({arg:e,action:"add"})},n.prototype.addItemsNow=function(e){var t;if(d("Adding "+e,0,this.connectionID),addItemsFlag=!1,"string"==typeof e&&"_COMMERR"!==e)this.polledReadBlockList.push(b(this.translationCB(e),e,this.octalInputOutput));else if(a.isArray(e))for(t=0;t<e.length;t++)"string"==typeof e[t]&&"_COMMERR"!==e[t]&&this.polledReadBlockList.push(b(this.translationCB(e[t]),e[t],this.octalInputOutput));for(t=this.polledReadBlockList.length-1;t>=0;t--)void 0===this.polledReadBlockList[t]&&(this.polledReadBlockList.splice(t,1),d("Dropping an undefined request item."));this.readPacketValid=!1},n.prototype.removeItems=function(e){this.addRemoveArray.push({arg:e,action:"remove"})},n.prototype.removeItemsNow=function(e){var t;if(this.removeItemsFlag=!1,void 0===e)this.polledReadBlockList=[];else if("string"==typeof e)for(t=0;t<this.polledReadBlockList.length;t++)d("TCBA "+this.translationCB(e)),this.polledReadBlockList[t].addr===this.translationCB(e)&&(d("Splicing"),this.polledReadBlockList.splice(t,1));else if(a.isArray(e))for(t=0;t<this.polledReadBlockList.length;t++)for(j=0;j<e.length;j++)this.polledReadBlockList[t].addr===this.translationCB(e[j])&&this.polledReadBlockList.splice(t,1);this.readPacketValid=!1},n.prototype.readAllItems=function(e){var t=this;d("Reading All Items (readAllItems was called)",1,t.connectionID),t.readDoneCallback="function"==typeof e?e:C,4!==t.isoConnectionState&&d("Unable to read when not connected. Return bad values.",0,t.connectionID),t.isWaiting()?d("Waiting to read for all R/W operations to complete.  Will re-trigger readAllItems in 100ms."):(t.addRemoveArray.forEach((function(e){d("Adding or Removing "+s.format(e),1,t.connectionID),"remove"===e.action&&t.removeItemsNow(e.arg),"add"===e.action&&t.addItemsNow(e.arg)})),t.addRemoveArray=[],t.readPacketValid||t.prepareReadPacket(),d("Calling SRP from RAI",1,t.connectionID),t.sendReadPacket())},n.prototype.isWaiting=function(){return this.isReading()||this.isWriting()},n.prototype.isReading=function(){var e;for(e=0;e<this.readPacketArray.length;e++)if(!0===this.readPacketArray[e].sent)return!0;return!1},n.prototype.isWriting=function(){var e;for(e=0;e<this.writePacketArray.length;e++)if(!0===this.writePacketArray[e].sent)return!0;return!1},n.prototype.clearReadPacketTimeouts=function(){for(d("Clearing read PacketTimeouts",1,this.connectionID),i=0;i<this.readPacketArray.length;i++)clearTimeout(this.readPacketArray[i].timeout),this.readPacketArray[i].sent=!1,this.readPacketArray[i].rcvd=!1},n.prototype.clearWritePacketTimeouts=function(){for(d("Clearing write PacketTimeouts",1,this.connectionID),i=0;i<this.writePacketArray.length;i++)clearTimeout(this.writePacketArray[i].timeout),this.writePacketArray[i].sent=!1,this.writePacketArray[i].rcvd=!1},n.prototype.prepareWritePacket=function(){var e,t=this.instantWriteBlockList,r=[],o=0;if(t.sort(v),0!=t.length){this.globalWriteBlockList[0]=t[0],this.globalWriteBlockList[0].itemReference=[],this.globalWriteBlockList[0].itemReference.push(t[0]);var a=0;for(t[0].block=0,p=0;p<t.length;p++)this.globalWriteBlockList[p]=t[p],this.globalWriteBlockList[p].isOptimized=!1,this.globalWriteBlockList[p].itemReference=[],this.globalWriteBlockList[p].itemReference.push(t[p]),h(t[p],this.isAscii);for(p=0;p<this.globalWriteBlockList.length;p++){var i=this.globalWriteBlockList[p].offset,s=this.globalWriteBlockList[p].byteLengthWrite,n=this.globalWriteBlockList[p].totalArrayLength,l=2*this.globalWriteBlockList[p].maxWordLength(!0),u=0;for(r[a]=this.globalWriteBlockList[p].clone(),this.globalWriteBlockList[p].parts=Math.ceil(this.globalWriteBlockList[p].byteLengthWrite/l),d("globalWriteBlockList "+p+" parts is "+this.globalWriteBlockList[p].parts+" offset is "+this.globalWriteBlockList[p].offset+" MBR is "+l,2),this.globalWriteBlockList[p].requestReference=[],j=0;j<this.globalWriteBlockList[p].parts;j++)r[a]=this.globalWriteBlockList[p].clone(),this.globalWriteBlockList[p].requestReference.push(r[a]),r[a].offset=i,r[a].byteLengthWrite=Math.min(l,s),r[a].bitNative?r[a].totalArrayLength=Math.min(2*l,n,this.globalWriteBlockList[p].totalArrayLength):r[a].totalArrayLength=Math.min(l/this.globalWriteBlockList[p].dtypelen,s/this.globalWriteBlockList[p].dtypelen,this.globalWriteBlockList[p].totalArrayLength),n-=r[a].totalArrayLength,r[a].byteLengthWithFill=r[a].byteLengthWrite,r[a].writeBuffer=this.globalWriteBlockList[p].writeBuffer.slice(u,u+r[a].byteLengthWithFill),r[a].writeQualityBuffer=this.globalWriteBlockList[p].writeQualityBuffer.slice(u,u+r[a].byteLengthWithFill),u+=this.globalWriteBlockList[p].requestReference[j].byteLengthWrite,this.globalWriteBlockList[p].parts>1&&(r[a].datatype="BYTE",r[a].dtypelen=1,r[a].bitNative?r[a].arrayLength=r[a].totalArrayLength:r[a].arrayLength=r[a].byteLengthWrite/2),s-=l,this.globalWriteBlockList[p].bitNative?i+=2*l:i+=l/2,a++}for(this.clearWritePacketTimeouts(),this.writePacketArray=[];o<r.length;){this.masterSequenceNumber+=1,this.masterSequenceNumber>32767&&(this.masterSequenceNumber=1),e=0;this.writePacketArray.push(new m);var c=this.writePacketArray.length-1;this.writePacketArray[c].seqNum=this.masterSequenceNumber,this.writePacketArray[c].itemList=[];for(var p=o;p<r.length&&1!=e;p++)o++,e++,r[p].byteLengthWithFill+4,this.writePacketArray[c].itemList.push(r[p])}d("WPAL is "+this.writePacketArray.length,1)}},n.prototype.prepareReadPacket=function(){var e,t,r=this.polledReadBlockList,o=[];for(f=r.length-1;f>=0;f--)void 0===r[f]&&(r.splice(f,1),d("Dropping an undefined request item.",0,this.connectionID));if(r.sort(v),0!=r.length){this.globalReadBlockList=[],this.globalReadBlockList[0]=r[0],this.globalReadBlockList[0].itemReference=[],this.globalReadBlockList[0].itemReference.push(r[0]);var a,i=0;for(r[0].block=i,f=1;f<r.length;f++)a=2*r[f].maxWordLength(!0),r[f].areaMCCode!==this.globalReadBlockList[i].areaMCCode||!this.isOptimizableArea(r[f].areaMCCode)||r[f].offset-this.globalReadBlockList[i].offset+r[f].byteLength>a||r[f].offset-(this.globalReadBlockList[i].offset+this.globalReadBlockList[i].byteLength)>this.maxGap&&!r[f].bitNative||r[f].offset-(this.globalReadBlockList[i].offset+this.globalReadBlockList[i].byteLength)>8*this.maxGap&&r[f].bitNative?(i+=1,this.globalReadBlockList[i]=r[f],this.globalReadBlockList[i].isOptimized=!1,this.globalReadBlockList[i].itemReference=[],this.globalReadBlockList[i].itemReference.push(r[f])):(d("Performing optimization of item "+r[f].addr+" with "+this.globalReadBlockList[i].addr,1),r[f].bitNative?(this.globalReadBlockList[i].byteLength=Math.max(this.globalReadBlockList[i].byteLength,Math.floor((r[f].requestOffset-this.globalReadBlockList[i].requestOffset)/8)+r[f].byteLength),this.globalReadBlockList[i].byteLength%2&&(this.globalReadBlockList[i].byteLength+=1)):this.globalReadBlockList[i].byteLength=Math.max(this.globalReadBlockList[i].byteLength,(2*(r[f].offset-this.globalReadBlockList[i].offset)+Math.ceil(r[f].byteLength/r[f].multidtypelen))*r[f].multidtypelen),d("Optimized byte length is now "+this.globalReadBlockList[i].byteLength,1),t=(e=r[f].bitNative?(r[f].requestOffset-this.globalReadBlockList[i].requestOffset)/8:2*(r[f].requestOffset-this.globalReadBlockList[i].requestOffset))+r[f].byteLength,r[f].byteBuffer=this.globalReadBlockList[i].byteBuffer.slice(e,t),r[f].qualityBuffer=this.globalReadBlockList[i].qualityBuffer.slice(e,t),this.globalReadBlockList[i].isOptimized=!0,this.globalReadBlockList[i].itemReference.push(r[f]));var s=0;for(f=0;f<this.globalReadBlockList.length;f++){o[s]=this.globalReadBlockList[f].clone(),a=2*this.globalReadBlockList[f].maxWordLength(!0),this.globalReadBlockList[f].parts=Math.ceil(this.globalReadBlockList[f].byteLength/a);var n=this.globalReadBlockList[f].requestOffset,l=this.globalReadBlockList[f].byteLength;this.globalReadBlockList[f].totalArrayLength;for(this.globalReadBlockList[f].requestReference=[],j=0;j<this.globalReadBlockList[f].parts;j++)o[s]=this.globalReadBlockList[f].clone(),this.globalReadBlockList[f].requestReference.push(o[s]),o[s].requestOffset=n,o[s].byteLength=Math.min(a,l),o[s].bitNative?o[s].totalArrayLength=Math.min(8*a,8*l,this.globalReadBlockList[f].totalArrayLength):o[s].totalArrayLength=Math.min(a/this.globalReadBlockList[f].dtypelen,l/this.globalReadBlockList[f].dtypelen,this.globalReadBlockList[f].totalArrayLength),o[s].byteLengthWithFill=o[s].byteLength,o[s].byteLengthWithFill%2&&(o[s].byteLengthWithFill+=1),this.globalReadBlockList[f].parts>1&&(o[s].datatype="BYTE",o[s].dtypelen=1,o[s].bitNative?o[s].arrayLength=o[s].totalArrayLength:o[s].arrayLength=o[s].byteLength/2),l-=a,this.globalReadBlockList[f].bitNative?n+=8*a:n+=a/2,s++}var u=0;for(this.clearReadPacketTimeouts(),this.readPacketArray=[];u<o.length;){this.masterSequenceNumber+=1,this.masterSequenceNumber>32767&&(this.masterSequenceNumber=1);var c=0;this.readPacketArray.push(new m);var p=this.readPacketArray.length-1;this.readPacketArray[p].seqNum=this.masterSequenceNumber,this.readPacketArray[p].itemList=[];for(var f=u;f<o.length&&!(c>=1);f++)u++,c++,this.readPacketArray[p].itemList.push(o[f])}this.readPacketValid=!0}},n.prototype.sendReadPacket=function(){var e,t,r,o,a=this,i=!1;for(d("SendReadPacket called",1,a.connectionID),e=0;e<a.readPacketArray.length;e++)if(!(a.readPacketArray[e].sent||a.parallelJobsNow>=a.maxParallel)){for(a.readPacketArray[e].reqTime=process.hrtime(),r=0,0,t=0;t<a.readPacketArray[e].itemList.length;t++)o=g(a.readPacketArray[e].itemList[t],!1,a.isAscii),d("The Returned MC Buffer is:",2),d(o,2),d("The returned buffer length is "+o.length,2),o.copy(a.readReq,r),r+=o.length;d("The final send buffer is:",2),a.isAscii?(d(P(a.readReq.slice(0,r)),2),d(L(P(a.readReq.slice(0,r))),2)):d(a.readReq.slice(0,r),2),4==a.isoConnectionState?(a.readPacketArray[e].timeout=setTimeout((function(){a.packetTimeout.apply(a,arguments)}),a.globalTimeout,"read",a.readPacketArray[e].seqNum),a.isAscii?a.isoclient.write(P(a.readReq.slice(0,r))):a.isoclient.write(a.readReq.slice(0,r)),a.readPacketArray[e].sent=!0,a.readPacketArray[e].rcvd=!1,a.readPacketArray[e].timeoutError=!1,a.parallelJobsNow+=1,d("Sending Read Packet SEQ "+a.readPacketArray[e].seqNum,1)):(a.readPacketArray[e].sent=!0,a.readPacketArray[e].rcvd=!1,a.readPacketArray[e].timeoutError=!0,i||d("Not Sending Read Packet because we are not connected - ISO CS is "+a.isoConnectionState,0,a.connectionID),0==a.isoConnectionState&&(i=!0),d("Requesting PacketTimeout Due to ISO CS NOT 4 - READ SN "+a.readPacketArray[e].seqNum,1,a.connectionID),a.readPacketArray[e].timeout=setTimeout((function(){a.packetTimeout.apply(a,arguments)}),0,"read",a.readPacketArray[e].seqNum))}i&&setTimeout((function(){d("The scheduled reconnect from sendReadPacket is happening now",1,a.connectionID),a.connectNow(a.connectionParams)}),0)},n.prototype.sendWritePacket=function(){var e,t,r=this,o=!1;for(new Buffer(8192),r.writeInQueue=!1,i=0;i<r.writePacketArray.length;i++)if(!(r.writePacketArray[i].sent||r.parallelJobsNow>=r.maxParallel)){r.writePacketArray[i].reqTime=process.hrtime(),e=0,0;for(var a=0;a<r.writePacketArray[i].itemList.length;a++)(t=g(r.writePacketArray[i].itemList[a],!0,r.isAscii)).copy(r.writeReq,e),e+=t.length;if(d("The returned buffer length is "+t.length,1),4===r.isoConnectionState)r.writePacketArray[i].timeout=setTimeout((function(){r.packetTimeout.apply(r,arguments)}),r.globalTimeout,"write",r.writePacketArray[i].seqNum),d("Actual Send Packet:",2),d(r.writeReq.slice(0,e),2),r.isAscii?r.isoclient.write(P(r.writeReq.slice(0,e))):r.isoclient.write(r.writeReq.slice(0,e)),r.writePacketArray[i].sent=!0,r.writePacketArray[i].rcvd=!1,r.writePacketArray[i].timeoutError=!1,r.parallelJobsNow+=1,d("Sending Write Packet With Sequence Number "+r.writePacketArray[i].seqNum,1,r.connectionID);else{r.writePacketArray[i].sent=!0,r.writePacketArray[i].rcvd=!1,r.writePacketArray[i].timeoutError=!0;var s=r.writePacketArray[i].seqNum;process.nextTick((function(){r.packetTimeout("write",s)})),0==r.isoConnectionState&&(o=!0)}}o&&setTimeout((function(){d("The scheduled reconnect from sendWritePacket is happening now",1,r.connectionID),r.connectNow(r.connectionParams)}),0)},n.prototype.isOptimizableArea=function(e){return!this.doNotOptimize},n.prototype.onResponse=function(e){var t,r,o;if(this.isAscii){if(void 0===(o=L(e)))return d("Failed ASCII conversion to binary on reply. Ignoring packet."),d(o,0),null}else o=e;return d("onResponse called with length "+o.length,1),o.length<2?(d("DATA LESS THAN 2 BYTES RECEIVED.  NO PROCESSING WILL OCCUR - CONNECTION RESET."),d(o,0),this.connectionReset(),null):(d("Valid MC Response Received (not yet checked for error)",1),d("Received "+o.length+" bytes of data from PLC.",1),d(o,2),this.isReading()&&(t=!0,d("Received Read Response",1),this.readResponse(o)),this.isWriting()&&(r=!0,d("Received Write Response",1),this.writeResponse(o)),t||r?void 0:(d("Sequence number that arrived wasn't a write or read reply - dropping"),d(o,0),null))},n.prototype.writeResponse=function(e){var t,r,o,a=2;for(packetCounter=0;packetCounter<this.writePacketArray.length;packetCounter++)if(this.writePacketArray[packetCounter].sent&&!this.writePacketArray[packetCounter].rcvd){o=packetCounter;break}if(void 0===o)return d("WARNING: Received a write packet when none marked as sent",0,this.connectionID),null;if(this.writePacketArray[o].rcvd)return d("WARNING: Received a write packet that was already marked as received",0,this.connectionID),null;for(itemCount=0;itemCount<this.writePacketArray[o].itemList.length;itemCount++)if(!(a=c(e,this.writePacketArray[o].itemList[itemCount],a))){d("Stopping Processing Write Response Packet due to unrecoverable packet error");break}if(this.writePacketArray[o].reqTime=process.hrtime(this.writePacketArray[o].reqTime),d("Time is "+this.writePacketArray[o].reqTime[0]+" seconds and "+Math.round(10*this.writePacketArray[o].reqTime[1]/1e6)/10+" ms.",1),this.writePacketArray[o].rcvd||(this.writePacketArray[o].rcvd=!0,this.parallelJobsNow--),clearTimeout(this.writePacketArray[o].timeout),this.writePacketArray.every(l)){for(t=0;t<this.writePacketArray.length;t++)this.writePacketArray[t].sent=!1,this.writePacketArray[t].rcvd=!1;for(r=!1,t=0;t<this.globalWriteBlockList.length;t++)p(this.globalWriteBlockList[t]),d(this.globalWriteBlockList[t].addr+" write completed with quality "+this.globalWriteBlockList[t].writeQuality,0),y(this.globalWriteBlockList[t].writeQuality)||(r=!0);this.writeDoneCallback,this.writeDoneCallback(r)}else this.sendWritePacket(),d("Sending again",1)},n.prototype.readResponse=function(e){var t,r,o=21,a={};for(d("ReadResponse called",1,this.connectionID),packetCounter=0;packetCounter<this.readPacketArray.length;packetCounter++)if(this.readPacketArray[packetCounter].sent&&!this.readPacketArray[packetCounter].rcvd){r=packetCounter;break}if(void 0===r)return d("WARNING: Received a read response packet that was not marked as sent",0,this.connectionID),null;if(this.readPacketArray[r].rcvd)return d("WARNING: Received a read response packet that was already marked as received",0,this.connectionID),null;for(itemCount=0;itemCount<this.readPacketArray[r].itemList.length;itemCount++)(o=u(e,this.readPacketArray[r].itemList[itemCount],o))||void 0===e||d("Received a ZERO RESPONSE Processing Read Packet due to unrecoverable packet error");if(this.readPacketArray[r].reqTime=process.hrtime(this.readPacketArray[r].reqTime),d("Read Time is "+this.readPacketArray[r].reqTime[0]+" seconds and "+Math.round(10*this.readPacketArray[r].reqTime[1]/1e6)/10+" ms.",1,this.connectionID),this.readPacketArray[r].rcvd||(this.readPacketArray[r].rcvd=!0,this.parallelJobsNow--,this.parallelJobsNow<0&&(this.parallelJobsNow=0)),clearTimeout(this.readPacketArray[r].timeout),this.readPacketArray.every(l)){for(d("Every packet done sending",1,this.connectionID),i=0;i<this.readPacketArray.length;i++)this.readPacketArray[i].sent=!1,this.readPacketArray[i].rcvd=!1;t=!1;for(var i=0;i<this.globalReadBlockList.length;i++){for(var s=0,n=0;n<this.globalReadBlockList[i].requestReference.length;n++)this.globalReadBlockList[i].requestReference[n].byteBuffer.copy(this.globalReadBlockList[i].byteBuffer,s,0,this.globalReadBlockList[i].requestReference[n].byteLength),this.globalReadBlockList[i].requestReference[n].qualityBuffer.copy(this.globalReadBlockList[i].qualityBuffer,s,0,this.globalReadBlockList[i].requestReference[n].byteLength),s+=this.globalReadBlockList[i].requestReference[n].byteLength;for(var c=0;c<this.globalReadBlockList[i].itemReference.length;c++)f(this.globalReadBlockList[i].itemReference[c],this.isAscii),d("Address "+this.globalReadBlockList[i].itemReference[c].addr+" has value "+this.globalReadBlockList[i].itemReference[c].value+" and quality "+this.globalReadBlockList[i].itemReference[c].quality,1,this.connectionID),y(this.globalReadBlockList[i].itemReference[c].quality)?a[this.globalReadBlockList[i].itemReference[c].useraddr]=this.globalReadBlockList[i].itemReference[c].value:(t=!0,a[this.globalReadBlockList[i].itemReference[c].useraddr]=this.globalReadBlockList[i].itemReference[c].quality)}d("We are calling back our readDoneCallback.",1,this.connectionID),this.readDoneCallback,this.readDoneCallback(t,a),this.resetPending&&this.resetNow(),!this.isReading()&&this.writeInQueue&&this.sendWritePacket()}else d("Calling SRP from RR",1,this.connectionID),this.sendReadPacket()},n.prototype.onClientDisconnect=function(){d("EIP/TCP DISCONNECTED."),this.connectionCleanup(),this.tryingToConnectNow=!1},n.prototype.connectionReset=function(){var e=this;e.isoConnectionState=0,e.resetPending=!0,d("ConnectionReset is happening"),e.isReading()||void 0!==e.resetTimeout||(e.resetTimeout=setTimeout((function(){e.resetNow.apply(e,arguments)}),1500))},n.prototype.resetNow=function(){this.isoConnectionState=0,this.isoclient.end(),d("ResetNOW is happening"),this.resetPending=!1,void 0!==this.resetTimeout&&(clearTimeout(this.resetTimeout),this.resetTimeout=void 0,d("Clearing an earlier scheduled reset"))},n.prototype.connectionCleanup=function(){this.isoConnectionState=0,d("Connection cleanup is happening"),void 0!==this.isoclient&&(this.isoclient.removeAllListeners("data"),this.isoclient.removeAllListeners("error"),this.isoclient.removeAllListeners("connect"),this.isoclient.removeAllListeners("end")),clearTimeout(this.connectTimeout),clearTimeout(this.PDUTimeout),this.clearReadPacketTimeouts(),this.clearWritePacketTimeouts()}},function(e,t,r){var o=r(1),a=r(4);e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateTextField",o.resultTextField),e.on("disconnect",(function(){console.log("ngat kekt noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateTextField",o.resultTextField)})),e.on("Client-send-data",(function(e){if(console.log(e),"ElementForce_Run"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[100,100,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"ElementForce_Stop"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[101,101,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"ElementForce_Auto"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[102,102,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"ElementForce_Interlock"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[103,103,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"BitAdjustForce"===e.NameCommand&&!isNaN(e.tag))if(a.PLC_Mitsubishi_WriteUnSafe){if(parseInt(e.tag)/16<=a.PLC_Mitsubishi_LengthOfWordBitAdjust){let r=1<<parseInt(e.tag)%16,i=(a.PLC_Mitsubishi_WordStartBitAdjust,Math.floor(e.tag/16),o.WordBitAdjust[Math.floor(e.tag/16)]);i^=r,t.writeItems("WriteUnSafeBitAdjust",[i]),console.log(i)}}else t.writeItems("ComPC",[110,110,e.mode,e.mode,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")});if("WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[111,111,e.tag,e.tag,e.value,e.value],()=>{console.log("can not write data Mitsubishi")}),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var r=parseInt(e.value/65536);r>32767&&(r=-65536+r);var i=parseInt(e.value%65536);i>32767&&(i=-65536+i),t.writeItems("ComPC",[112,112,e.tag,e.tag,r,r,i,i],()=>{console.log("can not write data Mitsubishi")})}}))}))}},function(e,t,r){var o=r(1),a=r(142),i=r(5),s=r(4);e.exports=function(e){var t=new(r(143)),n={DataRegister:"DB1,INT0."+s.PLC_Siemens_Size_D0,ComPC:s.PLC_Siemens_ComPC};function d(e,t){e&&(console.log("SOMETHING WENT WRONG READING VALUES!!!!"),o.TextField[1]="SOMETHING WENT WRONG READING VALUES!!!!"),t&&("BAD 255"===t.DataRegister[0]?o.TextField[1]="Disconnect PLC":o.TextField[1]="Connected PLC",o.Element=i.ReadWordOfPLC(s.PLC_Siemens_WordStartElement,s.PLC_Siemens_LengthOfWordElement,t.DataRegister),o.BitAdjust=i.ReadBitOfPLCSiemens(s.PLC_Siemens_WordStartBitAdjust,s.PLC_Siemens_LengthOfWordBitAdjust,t.DataRegister),o.WordBitAdjust=i.ReadWordOfPLC(s.PLC_Siemens_WordStartBitAdjust,s.PLC_Siemens_LengthOfWordBitAdjust,t.DataRegister),o.BitDisplay=i.ReadBitOfPLCSiemens(s.PLC_Siemens_WordStartBitDisplay,s.PLC_Siemens_LengthOfWordBitDisplay,t.DataRegister),o.WordDisplay=i.ReadWordOfPLC(s.PLC_Siemens_WordStartWordDisplay,s.PLC_Siemens_LengthOfWordWordDisplay,t.DataRegister),o.WordAdjust=i.ReadWordOfPLC(s.PLC_Siemens_WordStartWordAdjust,s.PLC_Siemens_LengthOfWordWordAdjust,t.DataRegister),o.DWordDisplay=i.ReadDWordOfPLCSiemens(s.PLC_Siemens_WordStartDWordDisplay,s.PLC_Siemens_LengthOfWordDWordDisplay,t.DataRegister),o.DWordAdjust=i.ReadDWordOfPLCSiemens(s.PLC_Siemens_WordStartDWordAdjust,s.PLC_Siemens_LengthOfWordDWordAdjust,t.DataRegister))}t.initiateConnection({port:102,host:s.PLC_Siemens_IP,rack:0,slot:1},(function(e){void 0!==e&&(o.TextField[1]=e,console.log(e));o.TextField[1]="Connected",console.log("Connected PLC Siemens success"),t.setTranslationCB((function(e){return n[e]})),t.addItems("DataRegister");setInterval((function(){t.readAllItems(d)}),s.PLC_Siemens_Interval_Communication)}));r(144)(e,t);var l,u,c=r(145);try{setInterval((function(){var t=c.readFile("Data.xlsx"),r=t.SheetNames;o.xlData=c.utils.sheet_to_json(t.Sheets[r[0]]),JSON.stringify(l)!==JSON.stringify(o.xlData)&&(l=o.xlData,e.sockets.emit("DataExcel",o.xlData)),o.xlData2=c.utils.sheet_to_json(t.Sheets[r[1]]),JSON.stringify(u)!==JSON.stringify(o.xlData2)&&(u=o.xlData2,e.sockets.emit("DataExcel2",o.xlData2))}),2e3)}catch(e){console.log(e)}s.PLC_Siemens&&setInterval(()=>{if(0===o.BitAdjust[0]&&(a.CheckFormularNumber=0),1===o.BitAdjust[0]&&o.WordDisplay[0]!==o.WordAdjust[0]){if(0===a.CheckFormularNumber&&(a.CheckFormularNumber=1,console.log("check_write_____________________________________________________________________"),console.log(o.resultFormularProject),Array.isArray(o.resultFormularProject))){let e=[];for(let t=0;t<o.resultFormularProject.length;t++)o.resultFormularProject[t].FormularNumber===o.WordAdjust[1]&&e.push(o.resultFormularProject[t]);a.ResultDataTransferPLC=e,console.log("============================================================================"),console.log(a.ResultDataTransferPLC)}if(!isNaN(o.WordAdjust[0]))if(o.WordAdjust[0]>=a.ResultDataTransferPLC.length)t.writeItems("ComPC",[110,110,0,0,0,0],()=>{console.log("can not write data Siemens")});else{let u=[0,0,0,0,0,0,0,0,0,0,0];u[0]=parseInt(a.ResultDataTransferPLC[o.WordAdjust[0]].FormularNumber),u[1]=parseInt(a.ResultDataTransferPLC[o.WordAdjust[0]].Step),u[2]=parseInt(a.ResultDataTransferPLC[o.WordAdjust[0]].TypeValue),u[3]=parseInt(a.ResultDataTransferPLC[o.WordAdjust[0]].TypeValueMachine);var e=parseInt(parseInt(a.ResultDataTransferPLC[o.WordAdjust[0]].AbsolutePosition)/65536),r=parseInt(e/32767),i=e%32767,s=parseInt(parseInt(a.ResultDataTransferPLC[o.WordAdjust[0]].AbsolutePosition)%65536),n=parseInt(s/32767),d=s%32767;u[4]=r,u[5]=i,u[6]=n,u[7]=d;var l=[200,o.WordAdjust[0]];t.writeItems("ComPC",l.concat(u),()=>{console.log("can not write data Siemens")}),console.log("Write Formular")}}},s.PLC_Siemens_Interval_WriteDataPC)}},function(e,t){e.exports={CheckFormularNumber:!1,ResultDataTransferPLC:[]}},function(e,t,r){var o=r(7),a=r(8),i=0,s=!1;function n(e){s=(e=e||{}).silent||!1,i=e.debug?99:0;this.connectReq=Buffer.from([3,0,0,22,17,224,0,0,0,2,0,192,1,10,193,2,1,0,194,2,1,2]),this.negotiatePDU=Buffer.from([3,0,0,25,2,240,128,50,1,0,0,0,0,0,8,0,0,240,0,0,8,0,8,3,192]),this.readReqHeader=Buffer.from([3,0,0,31,2,240,128,50,1,0,0,8,0,0,14,0,0,4,1]),this.readReq=Buffer.alloc(1500),this.writeReqHeader=Buffer.from([3,0,0,31,2,240,128,50,1,0,0,8,0,0,14,0,0,5,1]),this.writeReq=Buffer.alloc(1500),this.resetPending=!1,this.resetTimeout=void 0,this.isoclient=void 0,this.isoConnectionState=0,this.requestMaxPDU=960,this.maxPDU=960,this.requestMaxParallel=8,this.maxParallel=8,this.parallelJobsNow=0,this.maxGap=5,this.doNotOptimize=!1,this.connectCallback=void 0,this.readDoneCallback=void 0,this.writeDoneCallback=void 0,this.connectTimeout=void 0,this.PDUTimeout=void 0,this.globalTimeout=1500,this.rack=0,this.slot=2,this.localTSAP=null,this.remoteTSAP=null,this.readPacketArray=[],this.writePacketArray=[],this.polledReadBlockList=[],this.instantWriteBlockList=[],this.globalReadBlockList=[],this.globalWriteBlockList=[],this.masterSequenceNumber=1,this.translationCB=k,this.connectionParams=void 0,this.connectionID="UNDEF",this.addRemoveArray=[],this.readPacketValid=!1,this.writeInQueue=!1,this.connectCBIssued=!1,this.dropConnectionCallback=null,this.dropConnectionTimer=null,this.reconnectTimer=void 0,this.rereadTimer=void 0}function d(e){return!(!e.sent||!e.rcvd)}function l(e){var t=e[0],r=e.readInt16BE(2),o=e[5],a=e[6];return 3!==t&&240!==o?"error":a>>7==0&&r==e.length&&7===e.length?"fastACK":a>>7==1&&r<=e.length?e:a>>7==0&&r!==e.length?e.slice(7,e.length):"error"}function u(e,t){var r=0,o=Buffer.from([18,10,16,0,0,0,0,0,0,0,0,0]);return o[3]=2,"X"===e.datatype?(o.writeUInt16BE(e.byteLength,4),t&&1===e.arrayLength&&(o[3]=1,r=e.bitOffset)):"TIMER"===e.datatype||"COUNTER"===e.datatype?(o.writeUInt16BE(1,4),o.writeUInt8(e.areaS7Code,3)):o.writeUInt16BE(e.byteLength,4),o.writeUInt16BE(e.dbNumber,6),o.writeUInt32BE(8*e.offset+r,8),o[8]|=e.areaS7Code,o}function c(e,t,r,o){var a;void 0===e?(a=0,P("Processing an undefined packet, likely due to timeout error",0,o)):a=e.length-r;var i,s=r;if(t.qualityBuffer=Buffer.alloc(t.byteLength),t.qualityBuffer.fill(255),a<4)return t.valid=!1,t.errCode=void 0!==e?"Malformed Packet - Less Than 4 Bytes.  TDL"+e.length+"TP"+r+"RL"+a:"Timeout error - zero length packet",P(t.errCode,0,o),0;i=4==t.readTransportCode?e.readUInt16BE(r+2)/8:e.readUInt16BE(r+2);var n=e[r],d=e[r+1];if(a==i+2&&P("Not last part.",0,o),a<i+2)return t.valid=!1,t.errCode="Malformed Packet - Item Data Length and Packet Length Disagree.  RDL+2 "+(i+2)+" remainingLength "+a,P(t.errCode,0,o),0;if(255!==n)return t.valid=!1,t.errCode="Invalid Response Code - "+n,P(t.errCode,0,o),r+i+4;if(d!==t.readTransportCode)return t.valid=!1,t.errCode="Invalid Transport Code - "+d,P(t.errCode,0,o),r+i+4;var l=t.byteLength;return i!==l?(t.valid=!1,t.errCode="Invalid Response Length - Expected "+l+" but got "+i+" bytes.",P(t.errCode,0,o),i+2):(r+=4,t.valid=!0,t.byteBuffer=e.slice(r,r+i),t.qualityBuffer.fill(192),((r+=t.byteLength)-s)%2&&(r+=1),r)}function p(e,t,r){var o;if(!e)return t.writeQualityBuffer.fill(255),t.valid=!1,t.errCode="We must have timed Out - we have no response to process",P(t.errCode),0;if((o=e.length-r)<1)return t.writeQualityBuffer.fill(255),t.valid=!1,t.errCode="Malformed Packet - Less Than 1 Byte.  TDL "+e.length+" TP"+r+" RL"+o,P(t.errCode),0;var a=e.readUInt8(r);return t.writeResponse=a,255!==a?(P("Received write error of "+t.writeResponse+" on "+t.addr),t.writeQualityBuffer.fill(255)):t.writeQualityBuffer.fill(192),r+1}function f(e){var t=0;if(1===e.arrayLength)255===e.writeQualityBuffer[0]?e.writeQuality="BAD":e.writeQuality="OK";else{e.writeQuality=[];for(var r=0;r<e.arrayLength;r++)255===e.writeQualityBuffer[t]?e.writeQuality[r]="BAD":e.writeQuality[r]="OK","X"==e.datatype&&(r+e.bitOffset+1)%8!=0&&r!=e.arrayLength-1||(t+=e.dtypelen)}}function h(e){return 10*(e>>4)+(15&e)}function y(e){return e/10<<4|e%10}function g(e,t,r){let o,a=h(e.readUInt8(t)),i=h(e.readUInt8(t+1)),s=h(e.readUInt8(t+2)),n=h(e.readUInt8(t+3)),d=h(e.readUInt8(t+4)),l=h(e.readUInt8(t+5)),u=h(e.readUInt8(t+6)),c=h(240&e.readUInt8(t+7));return o=r?new Date(Date.UTC((a>89?1900:2e3)+a,i-1,s,n,d,l,10*u+c/10)):new Date((a>89?1900:2e3)+a,i-1,s,n,d,l,10*u+c/10),o}function b(e,t,r,o){if(!(e instanceof Date)){if(!(e>631152e6&&e<3786911999999))return void P("Unsupported value of ["+e+"] for writing data of type DATE_AND_TIME. Skipping item");e=new Date(e)}o?(t.writeUInt8(y(e.getUTCFullYear()%100),r),t.writeUInt8(y(e.getUTCMonth()+1),r+1),t.writeUInt8(y(e.getUTCDate()),r+2),t.writeUInt8(y(e.getUTCHours()),r+3),t.writeUInt8(y(e.getUTCMinutes()),r+4),t.writeUInt8(y(e.getUTCSeconds()),r+5),t.writeUInt8(y(e.getUTCMilliseconds()/10>>0),r+6),t.writeUInt8(y(e.getUTCMilliseconds()%10*10+(e.getUTCDay()+1)),r+7)):(t.writeUInt8(y(e.getFullYear()%100),r),t.writeUInt8(y(e.getMonth()+1),r+1),t.writeUInt8(y(e.getDate()),r+2),t.writeUInt8(y(e.getHours()),r+3),t.writeUInt8(y(e.getMinutes()),r+4),t.writeUInt8(y(e.getSeconds()),r+5),t.writeUInt8(y(e.getMilliseconds()/10>>0),r+6),t.writeUInt8(y(e.getMilliseconds()%10*10+(e.getDay()+1)),r+7))}function m(e,t,r){let o,a=e.readUInt16BE(t),i=e.readUInt8(t+2),s=e.readUInt8(t+3),n=e.readUInt8(t+5),d=e.readUInt8(t+6),l=e.readUInt8(t+7),u=e.readUInt32BE(t+8);return o=r?new Date(Date.UTC(a,i-1,s,n,d,l,u/1e6)):new Date(a,i-1,s,n,d,l,u/1e6),o}function I(e,t,r,o){if(!(e instanceof Date)){if(!(e>=0&&e<9223382836854))return void P("Unsupported value of ["+e+"] for writing data of type DATE_AND_TIME. Skipping item");e=new Date(e)}o?(t.writeUInt16BE(e.getUTCFullYear(),r),t.writeUInt8(e.getUTCMonth()+1,r+2),t.writeUInt8(e.getUTCDate(),r+3),t.writeUInt8(e.getUTCDay()+1,r+4),t.writeUInt8(e.getUTCHours(),r+5),t.writeUInt8(e.getUTCMinutes(),r+6),t.writeUInt8(e.getUTCSeconds(),r+7),t.writeUInt32BE(1e6*e.getUTCMilliseconds(),r+8)):(t.writeUInt16BE(e.getFullYear(),r),t.writeUInt8(e.getMonth()+1,r+2),t.writeUInt8(e.getDate(),r+3),t.writeUInt8(e.getDay()+1,r+4),t.writeUInt8(e.getHours(),r+5),t.writeUInt8(e.getMinutes(),r+6),t.writeUInt8(e.getSeconds(),r+7),t.writeUInt32BE(1e6*e.getMilliseconds(),r+8))}function v(e){var t=0,r=0,o="";if(e.arrayLength>1){"C"!=e.datatype&&"CHAR"!=e.datatype?(e.value=[],e.quality=[]):(e.value="",e.quality="");for(var a=e.bitOffset,i=0;i<e.arrayLength;i++){if(192!==e.qualityBuffer[t])e.quality instanceof Array?(e.value.push(e.badValue()),e.quality.push("BAD "+e.qualityBuffer[t])):(e.value=e.badValue(),e.quality="BAD "+e.qualityBuffer[t]);else switch(e.quality instanceof Array?e.quality.push("OK"):e.quality="OK",e.datatype){case"DT":e.value.push(g(e.byteBuffer,t,!1));break;case"DTZ":e.value.push(g(e.byteBuffer,t,!0));break;case"DTL":e.value.push(m(e.byteBuffer,t,!1));break;case"DTLZ":e.value.push(m(e.byteBuffer,t,!0));break;case"REAL":e.value.push(e.byteBuffer.readFloatBE(t));break;case"LREAL":e.value.push(e.byteBuffer.readDoubleBE(t));break;case"LINT":break;case"DWORD":e.value.push(e.byteBuffer.readUInt32BE(t));break;case"DINT":e.value.push(e.byteBuffer.readInt32BE(t));break;case"INT":e.value.push(e.byteBuffer.readInt16BE(t));break;case"WORD":e.value.push(e.byteBuffer.readUInt16BE(t));break;case"X":e.value.push(!!(e.byteBuffer.readUInt8(t)>>a&1));break;case"B":case"BYTE":e.value.push(e.byteBuffer.readUInt8(t));break;case"S":case"STRING":r=e.byteBuffer.readUInt8(t+1),o="";for(var s=2;s<e.dtypelen&&s-2<r;s++)o+=String.fromCharCode(e.byteBuffer.readUInt8(t+s));e.value.push(o);break;case"C":case"CHAR":e.value+=String.fromCharCode(e.byteBuffer.readUInt8(t));break;case"TIMER":case"COUNTER":e.value.push(e.byteBuffer.readInt16BE(t));break;default:return P("Unknown data type in response - should never happen.  Should have been caught earlier.  "+e.datatype),0}"X"==e.datatype?(a++,(i+e.bitOffset+1)%8!=0&&i!=e.arrayLength-1||(t+=e.dtypelen,a=0)):t+=e.dtypelen}}else{if(192!==e.qualityBuffer[t])e.value=e.badValue(),e.quality="BAD "+e.qualityBuffer[t];else switch(e.quality="OK",e.datatype){case"DT":e.value=g(e.byteBuffer,t,!1);break;case"DTZ":e.value=g(e.byteBuffer,t,!0);break;case"DTL":e.value=m(e.byteBuffer,t,!1);break;case"DTLZ":e.value=m(e.byteBuffer,t,!0);break;case"REAL":e.value=e.byteBuffer.readFloatBE(t);break;case"LREAL":e.value=e.byteBuffer.readDoubleBE(t);break;case"LINT":break;case"DWORD":e.value=e.byteBuffer.readUInt32BE(t);break;case"DINT":e.value=e.byteBuffer.readInt32BE(t);break;case"INT":e.value=e.byteBuffer.readInt16BE(t);break;case"WORD":e.value=e.byteBuffer.readUInt16BE(t);break;case"X":e.value=!!(e.byteBuffer.readUInt8(t)>>e.bitOffset&1);break;case"B":case"BYTE":e.value=e.byteBuffer.readUInt8(t);break;case"S":case"STRING":r=e.byteBuffer.readUInt8(t+1),e.value="";for(s=2;s<e.dtypelen&&s-2<r;s++)e.value+=String.fromCharCode(e.byteBuffer.readUInt8(t+s));break;case"C":case"CHAR":e.value=String.fromCharCode(e.byteBuffer.readUInt8(t));break;case"TIMER":case"COUNTER":e.value=e.byteBuffer.readInt16BE(t);break;default:return P("Unknown data type in response - should never happen.  Should have been caught earlier.  "+e.datatype),0}t+=e.dtypelen}return t%2&&(t+=1),t}function C(e){var t;return"X"===e.datatype&&1===e.arrayLength?((t=Buffer.alloc(5)).fill(0),t.writeUInt16BE(1,2)):((t=Buffer.alloc(e.byteLength+4)).fill(0),t.writeUInt16BE(8*e.byteLength,2)),e.writeBuffer.length<e.byteLengthWithFill&&P("Attempted to access part of the write buffer that wasn't there when writing an item."),t[0]=0,t[1]=e.writeTransportCode,e.writeBuffer.copy(t,4,0,e.byteLength),t}function D(e){var t,r;if(r=0,t=0,e.arrayLength>1)for(var o=e.bitOffset,a=0;a<e.arrayLength;a++){switch(e.datatype){case"DT":b(e.writeValue[a],e.writeBuffer,t,!1);break;case"DTZ":b(e.writeValue[a],e.writeBuffer,t,!0);break;case"DTL":I(e.writeValue[a],e.writeBuffer,t,!1);break;case"DTLZ":I(e.writeValue[a],e.writeBuffer,t,!0);break;case"REAL":e.writeBuffer.writeFloatBE(e.writeValue[a],t);break;case"LREAL":e.writeBuffer.writeDoubleBE(e.writeValue[a],t);break;case"LINT":break;case"DWORD":case"DINT":e.writeBuffer.writeInt32BE(e.writeValue[a],t);break;case"INT":e.writeBuffer.writeInt16BE(e.writeValue[a],t);break;case"WORD":e.writeBuffer.writeUInt16BE(e.writeValue[a],t);break;case"X":r|=(!0===e.writeValue[a]?1:0)<<o,e.writeBuffer.writeUInt8(r,t),o++;break;case"B":case"BYTE":e.writeBuffer.writeUInt8(e.writeValue[a],t);break;case"C":case"CHAR":e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(a),t);break;case"S":case"STRING":e.writeBuffer.writeUInt8(e.dtypelen-2,t),e.writeBuffer.writeUInt8(Math.min(e.dtypelen-2,e.writeValue[a].length),t+1);for(var i=2;i<e.dtypelen;i++)i<e.writeValue[a].length+2?e.writeBuffer.writeUInt8(e.writeValue[a].charCodeAt(i-2),t+i):e.writeBuffer.writeUInt8(32,t+i);break;case"TIMER":case"COUNTER":e.writeBuffer.writeInt16BE(e.writeValue[a],t);break;default:return P("Unknown data type when preparing array write packet - should never happen.  Should have been caught earlier.  "+e.datatype),0}"X"==e.datatype?(a+e.bitOffset+1)%8!=0&&a!=e.arrayLength-1||(t+=e.dtypelen,o=0,r=0):t+=e.dtypelen}else{switch(e.datatype){case"DT":b(e.writeValue,e.writeBuffer,t,!1);break;case"DTZ":b(e.writeValue,e.writeBuffer,t,!0);break;case"DTL":I(e.writeValue,e.writeBuffer,t,!1);break;case"DTLZ":I(e.writeValue,e.writeBuffer,t,!0);break;case"REAL":e.writeBuffer.writeFloatBE(e.writeValue,t);break;case"LREAL":e.writeBuffer.writeDoubleBE(e.writeValue,t);break;case"LINT":break;case"DWORD":e.writeBuffer.writeUInt32BE(e.writeValue,t);break;case"DINT":e.writeBuffer.writeInt32BE(e.writeValue,t);break;case"INT":e.writeBuffer.writeInt16BE(e.writeValue,t);break;case"WORD":e.writeBuffer.writeUInt16BE(e.writeValue,t);break;case"X":e.writeBuffer.writeUInt8(!0===e.writeValue?1:0,t);break;case"B":case"BYTE":e.writeBuffer.writeUInt8(e.writeValue,t);break;case"C":case"CHAR":e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(0),t);break;case"S":case"STRING":e.writeBuffer.writeUInt8(e.dtypelen-2,t),e.writeBuffer.writeUInt8(Math.min(e.dtypelen-2,e.writeValue.length),t+1);for(i=2;i<e.dtypelen;i++)i<e.writeValue.length+2?e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(i-2),t+i):e.writeBuffer.writeUInt8(32,t+i);break;case"TIMER":case"COUNTER":e.writeBuffer.writeInt16BE(e.writeValue,t);break;default:return P("Unknown data type in write prepare - should never happen.  Should have been caught earlier.  "+e.datatype),0}t+=e.dtypelen}}function w(e,t){"use strict";var r,o,a;if("_COMMERR"!==t){if(r=new S,!(0===(o=e.split(",")).length||o.length>2)){if(o.length>1){if(r.addrtype="DB",a=o[1].split("."),r.datatype=a[0].replace(/[0-9]/gi,"").toUpperCase(),"X"===r.datatype&&3===a.length?r.arrayLength=parseInt(a[2],10):"S"!==r.datatype&&"STRING"!==r.datatype||3!==a.length?"S"!==r.datatype&&"STRING"!==r.datatype||2!==a.length?"X"!==r.datatype&&2===a.length?r.arrayLength=parseInt(a[1],10):r.arrayLength=1:(r.dtypelen=parseInt(a[1],10)+2,r.arrayLength=1):(r.dtypelen=parseInt(a[1],10)+2,r.arrayLength=parseInt(a[2],10)),r.arrayLength<=0)return void P("Zero length arrays not allowed, returning undefined");if(r.dbNumber=parseInt(o[0].replace(/[A-z]/gi,""),10),r.offset=parseInt(a[0].replace(/[A-z]/gi,""),10),a.length>1&&"X"===r.datatype&&(r.bitOffset=parseInt(a[1],10),r.bitOffset>7))return void P("Invalid bit offset specified for address "+e)}else{switch((a=e.split("."))[0].replace(/[0-9]/gi,"")){case"PIB":case"PEB":case"PQB":case"PAB":r.addrtype="P",r.datatype="BYTE";break;case"PIC":case"PEC":case"PQC":case"PAC":r.addrtype="P",r.datatype="CHAR";break;case"PIW":case"PEW":case"PQW":case"PAW":r.addrtype="P",r.datatype="WORD";break;case"PII":case"PEI":case"PQI":case"PAI":r.addrtype="P",r.datatype="INT";break;case"PID":case"PED":case"PQD":case"PAD":r.addrtype="P",r.datatype="DWORD";break;case"PIDI":case"PEDI":case"PQDI":case"PADI":r.addrtype="P",r.datatype="DINT";break;case"PIR":case"PER":case"PQR":case"PAR":r.addrtype="P",r.datatype="REAL";break;case"I":case"E":r.addrtype="I",r.datatype="X";break;case"IB":case"EB":r.addrtype="I",r.datatype="BYTE";break;case"IC":case"EC":r.addrtype="I",r.datatype="CHAR";break;case"IW":case"EW":r.addrtype="I",r.datatype="WORD";break;case"II":case"EI":r.addrtype="I",r.datatype="INT";break;case"ID":case"ED":r.addrtype="I",r.datatype="DWORD";break;case"IDI":case"EDI":r.addrtype="I",r.datatype="DINT";break;case"IR":case"ER":r.addrtype="I",r.datatype="REAL";break;case"ILR":case"ELR":r.addrtype="I",r.datatype="LREAL";break;case"ILI":case"ELI":r.addrtype="I",r.datatype="LINT";break;case"Q":case"A":r.addrtype="Q",r.datatype="X";break;case"QB":case"AB":r.addrtype="Q",r.datatype="BYTE";break;case"QC":case"AC":r.addrtype="Q",r.datatype="CHAR";break;case"QW":case"AW":r.addrtype="Q",r.datatype="WORD";break;case"QI":case"AI":r.addrtype="Q",r.datatype="INT";break;case"QD":case"AD":r.addrtype="Q",r.datatype="DWORD";break;case"QDI":case"ADI":r.addrtype="Q",r.datatype="DINT";break;case"QR":case"AR":r.addrtype="Q",r.datatype="REAL";break;case"QLR":case"ALR":r.addrtype="Q",r.datatype="LREAL";break;case"QLI":case"ALI":r.addrtype="Q",r.datatype="LINT";break;case"M":r.addrtype="M",r.datatype="X";break;case"MB":r.addrtype="M",r.datatype="BYTE";break;case"MC":r.addrtype="M",r.datatype="CHAR";break;case"MW":r.addrtype="M",r.datatype="WORD";break;case"MI":r.addrtype="M",r.datatype="INT";break;case"MD":r.addrtype="M",r.datatype="DWORD";break;case"MDI":r.addrtype="M",r.datatype="DINT";break;case"MR":r.addrtype="M",r.datatype="REAL";break;case"MLR":r.addrtype="M",r.datatype="LREAL";break;case"MLI":r.addrtype="M",r.datatype="LINT";break;case"T":r.addrtype="T",r.datatype="TIMER";break;case"C":r.addrtype="C",r.datatype="COUNTER";break;default:return void P("Failed to find a match for "+a[0])}r.bitOffset=0,a.length>1&&"X"===r.datatype?(r.bitOffset=parseInt(a[1].replace(/[A-z]/gi,""),10),a.length>2?r.arrayLength=parseInt(a[2].replace(/[A-z]/gi,""),10):r.arrayLength=1):a.length>1&&"X"!==r.datatype?r.arrayLength=parseInt(a[1].replace(/[A-z]/gi,""),10):r.arrayLength=1,r.dbNumber=0,r.offset=parseInt(a[0].replace(/[A-z]/gi,""),10)}switch("DI"===r.datatype&&(r.datatype="DINT"),"I"===r.datatype&&(r.datatype="INT"),"DW"===r.datatype&&(r.datatype="DWORD"),"W"===r.datatype&&(r.datatype="WORD"),"R"===r.datatype&&(r.datatype="REAL"),"LR"===r.datatype&&(r.datatype="LREAL"),"LI"===r.datatype&&(r.datatype="LINT"),r.datatype){case"DTL":case"DTLZ":r.dtypelen=12;break;case"LREAL":case"LINT":case"DT":case"DTZ":r.dtypelen=8;break;case"REAL":case"DWORD":case"DINT":r.dtypelen=4;break;case"INT":case"WORD":case"TIMER":case"COUNTER":r.dtypelen=2;break;case"X":case"B":case"C":case"BYTE":case"CHAR":r.dtypelen=1;break;case"S":case"STRING":break;default:return void P("Unknown data type "+r.datatype)}switch(r.readTransportCode=4,r.addrtype){case"DB":case"DI":r.areaS7Code=132;break;case"I":case"E":r.areaS7Code=129;break;case"Q":case"A":r.areaS7Code=130;break;case"M":r.areaS7Code=131;break;case"P":r.areaS7Code=128;break;case"C":r.areaS7Code=28,r.readTransportCode=9;break;case"T":r.areaS7Code=29,r.readTransportCode=9;break;default:return void P("Unknown memory area entered - "+r.addrtype)}return"X"===r.datatype&&1===r.arrayLength?r.writeTransportCode=3:r.writeTransportCode=r.readTransportCode,r.addr=e,r.useraddr=void 0===t?e:t,"X"===r.datatype?r.byteLength=Math.ceil((r.bitOffset+r.arrayLength)/8):r.byteLength=r.arrayLength*r.dtypelen,r.byteLengthWithFill=r.byteLength,r.byteLengthWithFill%2&&(r.byteLengthWithFill+=1),r}P("Error - String Couldn't Split Properly.")}}function B(){this.seqNum=void 0,this.itemList=void 0,this.reqTime=void 0,this.sent=!1,this.rcvd=!1,this.timeoutError=void 0,this.timeout=void 0}function S(){this.addr=void 0,this.useraddr=void 0,this.addrtype=void 0,this.datatype=void 0,this.dbNumber=void 0,this.bitOffset=void 0,this.offset=void 0,this.arrayLength=void 0,this.dtypelen=void 0,this.areaS7Code=void 0,this.byteLength=void 0,this.byteLengthWithFill=void 0,this.readTransportCode=void 0,this.writeTransportCode=void 0,this.byteBuffer=Buffer.alloc(8192),this.writeBuffer=Buffer.alloc(8192),this.qualityBuffer=Buffer.alloc(8192),this.writeQualityBuffer=Buffer.alloc(8192),this.value=void 0,this.writeValue=void 0,this.valid=!1,this.errCode=void 0,this.part=void 0,this.maxPart=void 0,this.isOptimized=!1,this.resultReference=void 0,this.itemReference=void 0,this.clone=function(){var e=new S;for(var t in this)"clone"!=t&&(e[t]=this[t]);return e},this.badValue=function(){switch(this.datatype){case"DT":case"DTZ":case"DTL":case"DTLZ":return new Date(NaN);case"REAL":case"LREAL":return 0;case"DWORD":case"DINT":case"INT":case"LINT":case"WORD":case"B":case"BYTE":case"TIMER":case"COUNTER":return 0;case"X":return!1;case"C":case"CHAR":case"S":case"STRING":return"";default:return P("Unknown data type when figuring out bad value - should never happen.  Should have been caught earlier.  "+this.datatype),0}}}function A(e,t){if(e.areaS7Code<t.areaS7Code)return-1;if(e.areaS7Code>t.areaS7Code)return 1;if("DB"===e.addrtype){if(e.dbNumber<t.dbNumber)return-1;if(e.dbNumber>t.dbNumber)return 1}return e.offset<t.offset?-1:e.offset>t.offset?1:e.bitOffset<t.bitOffset?-1:e.bitOffset>t.bitOffset?1:e.byteLength>t.byteLength?-1:e.byteLength<t.byteLength?1:void 0}function k(e){return e}function L(e){if("string"==typeof e){if("OK"!==e)return!1}else if(Array.isArray(e))for(var t=0;t<e.length;t++)if("string"!=typeof e[t]||"OK"!==e[t])return!1;return!0}function P(e,t,r){var o;s||(o=void 0===r?"":" "+r,(void 0===t||i>=t)&&console.log("["+process.hrtime()+o+"] "+a.format(e)))}e.exports=n,n.prototype.getNextSeqNum=function(){return this.masterSequenceNumber+=1,this.masterSequenceNumber>32767&&(this.masterSequenceNumber=1),P("seqNum is "+this.masterSequenceNumber,1,this.connectionID),this.masterSequenceNumber},n.prototype.setTranslationCB=function(e){"function"==typeof e&&(P("Translation OK"),this.translationCB=e)},n.prototype.initiateConnection=function(e,t){void 0===e&&(e={port:102,host:"192.168.8.106"}),P("Initiate Called - Connecting to PLC with address and parameters:"),P(e),void 0!==e.rack&&(this.rack=e.rack),void 0!==e.slot&&(this.slot=e.slot),void 0!==e.localTSAP&&(this.localTSAP=e.localTSAP),void 0!==e.remoteTSAP&&(this.remoteTSAP=e.remoteTSAP),void 0===e.connection_name?this.connectionID=e.host+" S"+this.slot:this.connectionID=e.connection_name,this.connectionParams=e,this.connectCallback=t,this.connectCBIssued=!1,this.connectNow(this.connectionParams,!1)},n.prototype.dropConnection=function(e){var t=this;clearTimeout(t.reconnectTimer),clearTimeout(t.rereadTimer),clearTimeout(t.connectTimeout),clearTimeout(t.PDUTimeout),t.reconnectTimer=void 0,t.rereadTimer=void 0,t.connectTimeout=void 0,t.PDUTimeout=void 0,void 0!==t.isoclient?(t.dropConnectionCallback=e,t.isoclient.end(),t.dropConnectionTimer=setTimeout((function(){t.dropConnectionCallback&&(t.connectionCleanup(),t.dropConnectionCallback(),t.dropConnectionCallback=null)}),2500)):e()},n.prototype.connectNow=function(e){var t=this;clearTimeout(t.reconnectTimer),t.reconnectTimer=void 0,t.isoConnectionState>=1||(t.connectionCleanup(),t.isoclient=o.connect(e),t.isoclient.setTimeout(e.timeout||5e3,()=>{t.isoclient.destroy(),t.connectError.apply(t,arguments)}),t.isoclient.once("connect",()=>{t.isoclient.setTimeout(0),t.onTCPConnect.apply(t,arguments)}),t.isoConnectionState=1,t.isoclient.on("error",(function(){t.connectError.apply(t,arguments)})),P("<initiating a new connection "+Date()+">",1,t.connectionID),P("Attempting to connect to host...",0,t.connectionID))},n.prototype.connectError=function(e){P("We Caught a connect error "+e.code,0,this.connectionID),this.connectCBIssued||"function"!=typeof this.connectCallback||(this.connectCBIssued=!0,this.connectCallback(e)),this.isoConnectionState=0},n.prototype.readWriteError=function(e){P("We Caught a read/write error "+e.code+" - will DISCONNECT and attempt to reconnect."),this.isoConnectionState=0,this.connectionReset()},n.prototype.packetTimeout=function(e,t){var r=this;return P("PacketTimeout called with type "+e+" and seq "+t,1,r.connectionID),"connect"===e?(P("TIMED OUT connecting to the PLC - Disconnecting",0,r.connectionID),P("Wait for 2 seconds then try again.",0,r.connectionID),r.connectionReset(),P("Scheduling a reconnect from packetTimeout, connect type",0,r.connectionID),clearTimeout(r.reconnectTimer),void(r.reconnectTimer=setTimeout((function(){P("The scheduled reconnect from packetTimeout, connect type, is happening now",0,r.connectionID),0===r.isoConnectionState&&r.connectNow.apply(r,arguments)}),2e3,r.connectionParams))):"PDU"===e?(P("TIMED OUT waiting for PDU reply packet from PLC - Disconnecting"),P("Wait for 2 seconds then try again.",0,r.connectionID),r.connectionReset(),P("Scheduling a reconnect from packetTimeout, connect type",0,r.connectionID),clearTimeout(r.reconnectTimer),void(r.reconnectTimer=setTimeout((function(){P("The scheduled reconnect from packetTimeout, PDU type, is happening now",0,r.connectionID),r.connectNow.apply(r,arguments)}),2e3,r.connectionParams))):"read"===e?(P("READ TIMEOUT on sequence number "+t,0,r.connectionID),4===r.isoConnectionState&&(P("ConnectionReset from read packet timeout.",0,r.connectionID),r.connectionReset()),void r.readResponse(void 0,r.findReadIndexOfSeqNum(t))):"write"===e?(P("WRITE TIMEOUT on sequence number "+t,0,r.connectionID),4===r.isoConnectionState&&(P("ConnectionReset from write packet timeout.",0,r.connectionID),r.connectionReset()),void r.writeResponse(void 0,r.findWriteIndexOfSeqNum(t))):void P("Unknown timeout error.  Nothing was done - this shouldn't happen.")},n.prototype.onTCPConnect=function(){var e,t=this;P("TCP Connection Established to "+t.isoclient.remoteAddress+" on port "+t.isoclient.remotePort,0,t.connectionID),P("Will attempt ISO-on-TCP connection",0,t.connectionID),t.isoConnectionState=2,t.connectTimeout=setTimeout((function(){t.packetTimeout.apply(t,arguments)}),t.globalTimeout,"connect"),e=t.connectReq.slice(),null!==t.localTSAP&&null!==t.remoteTSAP?(P("Using localTSAP [0x"+t.localTSAP.toString(16)+"] and remoteTSAP [0x"+t.remoteTSAP.toString(16)+"]",0,t.connectionID),e.writeUInt16BE(t.localTSAP,16),e.writeUInt16BE(t.remoteTSAP,20)):(P("Using rack ["+t.rack+"] and slot ["+t.slot+"]",0,t.connectionID),e[21]=32*t.rack+t.slot),t.isoclient.write(e),t.isoclient.on("data",(function(){t.onISOConnectReply.apply(t,arguments)})),t.isoclient.on("end",(function(){t.onClientDisconnect.apply(t,arguments)})),t.isoclient.on("close",(function(){t.onClientClose.apply(t,arguments)}))},n.prototype.onISOConnectReply=function(e){var t=this;if(t.isoclient.removeAllListeners("data"),t.isoclient.removeAllListeners("error"),clearTimeout(t.connectTimeout),2==t.isoConnectionState){if(t.isoConnectionState=3,e.readInt16BE(2)!==e.length||e.length<22||208!==e[5]||e[4]!==e.length-5)return P("INVALID PACKET or CONNECTION REFUSED - DISCONNECTING"),P(e),P("TPKT Length From Header is "+e.readInt16BE(2)+" and RCV buffer length is "+e.length+" and COTP length is "+e.readUInt8(4)+" and data[5] is "+e[5]),t.connectionReset(),null;P("ISO-on-TCP Connection Confirm Packet Received",0,t.connectionID),t.negotiatePDU.writeInt16BE(t.requestMaxParallel,19),t.negotiatePDU.writeInt16BE(t.requestMaxParallel,21),t.negotiatePDU.writeInt16BE(t.requestMaxPDU,23),t.PDUTimeout=setTimeout((function(){t.packetTimeout.apply(t,arguments)}),t.globalTimeout,"PDU"),t.isoclient.write(t.negotiatePDU.slice(0,25)),t.isoclient.on("data",(function(){t.onPDUReply.apply(t,arguments)})),t.isoclient.on("error",(function(){t.readWriteError.apply(t,arguments)}))}else P("Ignoring ISO connect reply, expecting isoConnectionState of 2, is currently "+t.isoConnectionState,0,t.connectionID)},n.prototype.onPDUReply=function(e){var t=this;t.isoclient.removeAllListeners("data"),t.isoclient.removeAllListeners("error"),clearTimeout(t.PDUTimeout);var r=l(e);if("fastACK"===r)P("Fast Acknowledge received.",0,t.connectionID),t.isoclient.removeAllListeners("error"),t.isoclient.removeAllListeners("data"),t.isoclient.on("data",(function(){t.onPDUReply.apply(t,arguments)})),t.isoclient.on("error",(function(){t.readWriteError.apply(t,arguments)}));else{if(r[4]+1+12+r.readInt16BE(13)!==r.readInt16BE(2)-4)return P("INVALID Telegram ",0,t.connectionID),P("Byte 0 From Header is "+e[0]+" it has to be 0x03, Byte 5 From Header is  "+e[5]+" and it has to be 0x0F ",0,t.connectionID),P("INVALID PDU RESPONSE or CONNECTION REFUSED - DISCONNECTING",0,t.connectionID),P("TPKT Length From Header is "+e.readInt16BE(2)+" and RCV buffer length is "+e.length+" and COTP length is "+e.readUInt8(4)+" and data[6] is "+e[6],0,t.connectionID),P(e),t.isoclient.end(),clearTimeout(t.reconnectTimer),t.reconnectTimer=setTimeout((function(){t.connectNow.apply(t,arguments)}),2e3,t.connectionParams),null;t.isoConnectionState=4,t.parallelJobsNow=0;var o=r.readInt16BE(21),a=r.readInt16BE(23),i=r.readInt16BE(25);t.maxParallel=t.requestMaxParallel,o<t.requestMaxParallel&&(t.maxParallel=o),a<t.requestMaxParallel&&(t.maxParallel=a),i<t.requestMaxPDU?t.maxPDU=i:t.maxPDU=t.requestMaxPDU,P("Received PDU Response - Proceeding with PDU "+t.maxPDU+" and "+t.maxParallel+" max parallel connections.",0,t.connectionID),t.isoclient.on("data",(function(){t.onResponse.apply(t,arguments)})),t.isoclient.on("error",(function(){t.readWriteError.apply(t,arguments)})),t.connectCBIssued||"function"!=typeof t.connectCallback||(t.connectCBIssued=!0,t.connectCallback())}},n.prototype.writeItems=function(e,t,r){var o;if(P("Preparing to WRITE "+e+" to value "+t,0,this.connectionID),this.isWriting()||this.writeInQueue)return P("You must wait until all previous writes have finished before scheduling another. ",0,this.connectionID),1;if(this.writeDoneCallback="function"==typeof r?r:k,this.instantWriteBlockList=[],"string"==typeof e)this.instantWriteBlockList.push(w(this.translationCB(e),e)),void 0!==this.instantWriteBlockList[this.instantWriteBlockList.length-1]&&(this.instantWriteBlockList[this.instantWriteBlockList.length-1].writeValue=t);else if(Array.isArray(e)&&Array.isArray(t)&&e.length==t.length)for(o=0;o<e.length;o++)"string"==typeof e[o]&&(this.instantWriteBlockList.push(w(this.translationCB(e[o]),e[o])),void 0!==this.instantWriteBlockList[this.instantWriteBlockList.length-1]&&(this.instantWriteBlockList[this.instantWriteBlockList.length-1].writeValue=t[o]));for(o=this.instantWriteBlockList.length-1;o>=0;o--)void 0===this.instantWriteBlockList[o]&&(this.instantWriteBlockList.splice(o,1),P("Dropping an undefined write item."));return this.prepareWritePacket(),this.isReading()?(this.writeInQueue&&P("Write was already in queue - should be prevented above",1,this.connectionID),this.writeInQueue=!0,P("Adding write to queue")):this.sendWritePacket(),0},n.prototype.findItem=function(e){var t,r={value:4!==this.isoConnectionState,quality:"OK"};if("_COMMERR"===e)return r;for(t=0;t<this.polledReadBlockList.length;t++)if(this.polledReadBlockList[t].useraddr===e)return this.polledReadBlockList[t]},n.prototype.addItems=function(e){this.addRemoveArray.push({arg:e,action:"add"})},n.prototype.addItemsNow=function(e){var t;if(P("Adding "+e,0,this.connectionID),"string"==typeof e&&"_COMMERR"!==e)this.polledReadBlockList.push(w(this.translationCB(e),e));else if(Array.isArray(e))for(t=0;t<e.length;t++)"string"==typeof e[t]&&"_COMMERR"!==e[t]&&this.polledReadBlockList.push(w(this.translationCB(e[t]),e[t]));for(t=this.polledReadBlockList.length-1;t>=0;t--)void 0===this.polledReadBlockList[t]&&(this.polledReadBlockList.splice(t,1),P("Dropping an undefined request item.",0,this.connectionID));this.readPacketValid=!1},n.prototype.removeItems=function(e){this.addRemoveArray.push({arg:e,action:"remove"})},n.prototype.removeItemsNow=function(e){var t;if(void 0===e)this.polledReadBlockList=[];else if("string"==typeof e)for(t=0;t<this.polledReadBlockList.length;t++)P("TCBA "+this.translationCB(e)),this.polledReadBlockList[t].addr===this.translationCB(e)&&(P("Splicing"),this.polledReadBlockList.splice(t,1));else if(Array.isArray(e))for(t=0;t<this.polledReadBlockList.length;t++)for(var r=0;r<e.length;r++)this.polledReadBlockList[t].addr===this.translationCB(e[r])&&this.polledReadBlockList.splice(t,1);this.readPacketValid=!1},n.prototype.readAllItems=function(e){var t=this;if(P("Reading All Items (readAllItems was called)",1,t.connectionID),t.readDoneCallback="function"==typeof e?e:k,4!==t.isoConnectionState&&P("Unable to read when not connected. Return bad values.",0,t.connectionID),t.isWaiting())return P("Waiting to read for all R/W operations to complete.  Will re-trigger readAllItems in 100ms.",0,t.connectionID),clearTimeout(t.rereadTimer),void(t.rereadTimer=setTimeout((function(){t.rereadTimer=void 0,t.readAllItems.apply(t,arguments)}),100,e));t.addRemoveArray.forEach((function(e){P("Adding or Removing "+a.format(e),1,t.connectionID),"remove"===e.action&&t.removeItemsNow(e.arg),"add"===e.action&&t.addItemsNow(e.arg)})),t.addRemoveArray=[],t.readPacketValid||t.prepareReadPacket(),P("Calling SRP from RAI",1,t.connectionID),t.sendReadPacket()},n.prototype.isWaiting=function(){return this.isReading()||this.isWriting()},n.prototype.isReading=function(){var e;for(e=0;e<this.readPacketArray.length;e++)if(!0===this.readPacketArray[e].sent)return!0;return!1},n.prototype.isWriting=function(){var e;for(e=0;e<this.writePacketArray.length;e++)if(!0===this.writePacketArray[e].sent)return!0;return!1},n.prototype.clearReadPacketTimeouts=function(){var e;for(P("Clearing read PacketTimeouts",1,this.connectionID),e=0;e<this.readPacketArray.length;e++)clearTimeout(this.readPacketArray[e].timeout),this.readPacketArray[e].sent=!1,this.readPacketArray[e].rcvd=!1},n.prototype.clearWritePacketTimeouts=function(){var e;for(P("Clearing write PacketTimeouts",1,this.connectionID),e=0;e<this.writePacketArray.length;e++)clearTimeout(this.writePacketArray[e].timeout),this.writePacketArray[e].sent=!1,this.writePacketArray[e].rcvd=!1},n.prototype.prepareWritePacket=function(){var e,t=this.instantWriteBlockList,r=[],o=0;if(t.sort(A),0!==t.length){this.globalWriteBlockList=[],this.globalWriteBlockList[0]=t[0],this.globalWriteBlockList[0].itemReference=[],this.globalWriteBlockList[0].itemReference.push(t[0]);t[0].block=0;var a=Math.floor((this.maxPDU-18-12)/4);for(a=8*Math.floor((this.maxPDU-18-12)/8),e=0;e<t.length;e++)this.globalWriteBlockList[e]=t[e],this.globalWriteBlockList[e].isOptimized=!1,this.globalWriteBlockList[e].itemReference=[],this.globalWriteBlockList[e].itemReference.push(t[e]),D(t[e]);var i=0;for(e=0;e<this.globalWriteBlockList.length;e++){var s=this.globalWriteBlockList[e].offset,n=this.globalWriteBlockList[e].byteLength,d=0;r[i]=this.globalWriteBlockList[e].clone(),this.globalWriteBlockList[e].parts=Math.ceil(this.globalWriteBlockList[e].byteLength/a),this.globalWriteBlockList[e].requestReference=[];for(var l=0;l<this.globalWriteBlockList[e].parts;l++)r[i]=this.globalWriteBlockList[e].clone(),this.globalWriteBlockList[e].requestReference.push(r[i]),r[i].offset=s,r[i].byteLength=Math.min(a,n),r[i].byteLengthWithFill=r[i].byteLength,r[i].byteLengthWithFill%2&&(r[i].byteLengthWithFill+=1),r[i].writeBuffer=this.globalWriteBlockList[e].writeBuffer.slice(d,d+r[i].byteLengthWithFill),r[i].writeQualityBuffer=this.globalWriteBlockList[e].writeQualityBuffer.slice(d,d+r[i].byteLengthWithFill),d+=this.globalWriteBlockList[e].requestReference[l].byteLength,this.globalWriteBlockList[e].parts>1&&(r[i].datatype="BYTE",r[i].dtypelen=1,r[i].arrayLength=r[i].byteLength),n-=a,i++,s+=a}for(this.clearWritePacketTimeouts(),this.writePacketArray=[];o<r.length;){var u=0;this.writeReqHeader.copy(this.writeReq,0);var c=14;this.writePacketArray.push(new B);var p=this.writePacketArray.length-1;for(this.writePacketArray[p].seqNum=this.getNextSeqNum(),this.writePacketArray[p].itemList=[],e=o;e<r.length;e++){if(r[e].byteLengthWithFill+12+4+c>this.maxPDU){if(0===u)throw P("breaking when we shouldn't, byte length with fill is  "+r[e].byteLengthWithFill+" max byte request "+a,0,this.connectionID),new Error("Somehow write request didn't split properly - exiting.  Report this as a bug.");break}o++,u++,c+=r[e].byteLengthWithFill+12+4,this.writePacketArray[p].itemList.push(r[e])}}}},n.prototype.prepareReadPacket=function(){var e,t=this.polledReadBlockList,r=[];for(e=t.length-1;e>=0;e--)void 0===t[e]&&(t.splice(e,1),P("Dropping an undefined request item.",0,this.connectionID));if(t.sort(A),0!==t.length){this.globalReadBlockList=[],this.globalReadBlockList[0]=t[0],this.globalReadBlockList[0].itemReference=[],this.globalReadBlockList[0].itemReference.push(t[0]);var o=0;t[0].block=o;var a=4*Math.floor((this.maxPDU-18)/4);for(e=1;e<t.length;e++)t[e].areaS7Code!==this.globalReadBlockList[o].areaS7Code||t[e].dbNumber!==this.globalReadBlockList[o].dbNumber||!this.isOptimizableArea(t[e].areaS7Code)||t[e].offset-this.globalReadBlockList[o].offset+t[e].byteLength>a||t[e].offset-(this.globalReadBlockList[o].offset+this.globalReadBlockList[o].byteLength)>this.maxGap?(P("Skipping optimization of item "+t[e].addr,0,this.connectionID),o+=1,this.globalReadBlockList[o]=t[e],this.globalReadBlockList[o].isOptimized=!1,this.globalReadBlockList[o].itemReference=[],this.globalReadBlockList[o].itemReference.push(t[e])):(P("Attempting optimization of item "+t[e].addr+" with "+this.globalReadBlockList[o].addr,0,this.connectionID),this.globalReadBlockList[o].byteLength=Math.max(this.globalReadBlockList[o].byteLength,t[e].offset-this.globalReadBlockList[o].offset+t[e].byteLength),t[e].byteBuffer=this.globalReadBlockList[o].byteBuffer.slice(t[e].offset-this.globalReadBlockList[o].offset,t[e].offset-this.globalReadBlockList[o].offset+t[e].byteLength),t[e].qualityBuffer=this.globalReadBlockList[o].qualityBuffer.slice(t[e].offset-this.globalReadBlockList[o].offset,t[e].offset-this.globalReadBlockList[o].offset+t[e].byteLength),this.globalReadBlockList[o].isOptimized=!0,this.globalReadBlockList[o].itemReference.push(t[e]));var i=0;for(e=0;e<this.globalReadBlockList.length;e++){r[i]=this.globalReadBlockList[e].clone(),this.globalReadBlockList[e].parts=Math.ceil(this.globalReadBlockList[e].byteLength/a),P("self.globalReadBlockList "+e+" parts is "+this.globalReadBlockList[e].parts+" offset is "+this.globalReadBlockList[e].offset+" MBR is "+a,1,this.connectionID);var s=this.globalReadBlockList[e].offset,n=this.globalReadBlockList[e].byteLength;this.globalReadBlockList[e].requestReference=[];for(var d=0;d<this.globalReadBlockList[e].parts;d++)r[i]=this.globalReadBlockList[e].clone(),this.globalReadBlockList[e].requestReference.push(r[i]),r[i].offset=s,r[i].byteLength=Math.min(a,n),r[i].byteLengthWithFill=r[i].byteLength,r[i].byteLengthWithFill%2&&(r[i].byteLengthWithFill+=1),this.globalReadBlockList[e].parts>1&&(r[i].datatype="BYTE",r[i].dtypelen=1,r[i].arrayLength=r[i].byteLength),n-=a,i++,s+=a}var l=0;for(this.clearReadPacketTimeouts(),this.readPacketArray=[];l<r.length;){var u=0;this.readReqHeader.copy(this.readReq,0);var c=14,p=12;this.readPacketArray.push(new B);var f=this.readPacketArray.length-1;for(this.readPacketArray[f].seqNum=0,this.readPacketArray[f].itemList=[],e=l;e<r.length;e++){if(r[e].byteLengthWithFill+4+c>this.maxPDU||p+12>this.maxPDU){if(P("Splitting request: "+u+" items, requestLength would be "+(p+12)+", replyLength would be "+(r[e].byteLengthWithFill+4+c)+", PDU is "+this.maxPDU,1,this.connectionID),0===u)throw P("breaking when we shouldn't, rlibl "+r[e].byteLengthWithFill+" MBR "+a,0,this.connectionID),new Error("Somehow write request didn't split properly - exiting.  Report this as a bug.");break}l++,u++,c+=r[e].byteLengthWithFill+4,p+=12,this.readPacketArray[f].itemList.push(r[e])}}this.readPacketValid=!0}},n.prototype.sendReadPacket=function(){var e,t,r=this,o=!1;for(P("SendReadPacket called",1,r.connectionID),e=0;e<r.readPacketArray.length;e++)if(!(r.readPacketArray[e].sent||r.parallelJobsNow>=r.maxParallel)){for(r.readPacketArray[e].seqNum=r.getNextSeqNum(),r.readPacketArray[e].reqTime=process.hrtime(),r.readReq.writeUInt8(r.readPacketArray[e].itemList.length,18),r.readReq.writeUInt16BE(19+12*r.readPacketArray[e].itemList.length,2),r.readReq.writeUInt16BE(r.readPacketArray[e].seqNum,11),r.readReq.writeUInt16BE(12*r.readPacketArray[e].itemList.length+2,13),t=0;t<r.readPacketArray[e].itemList.length;t++)u(r.readPacketArray[e].itemList[t],!1).copy(r.readReq,19+12*t);4==r.isoConnectionState?(P("Sending Read Packet With Sequence Number "+r.readPacketArray[e].seqNum,1,r.connectionID),r.readPacketArray[e].timeout=setTimeout((function(){r.packetTimeout.apply(r,arguments)}),r.globalTimeout,"read",r.readPacketArray[e].seqNum),r.isoclient.write(r.readReq.slice(0,19+12*r.readPacketArray[e].itemList.length)),r.readPacketArray[e].sent=!0,r.readPacketArray[e].rcvd=!1,r.readPacketArray[e].timeoutError=!1,r.parallelJobsNow+=1):(r.readPacketArray[e].sent=!0,r.readPacketArray[e].rcvd=!1,r.readPacketArray[e].timeoutError=!0,o||P("Not Sending Read Packet because we are not connected - ISO CS is "+r.isoConnectionState,0,r.connectionID),0===r.isoConnectionState&&(o=!0),P("Requesting PacketTimeout Due to ISO CS NOT 4 - READ SN "+r.readPacketArray[e].seqNum,1,r.connectionID),r.readPacketArray[e].timeout=setTimeout((function(){r.packetTimeout.apply(r,arguments)}),0,"read",r.readPacketArray[e].seqNum))}},n.prototype.sendWritePacket=function(){var e,t,r,o,a=this;for(t=Buffer.alloc(8192),a.writeInQueue=!1,e=0;e<a.writePacketArray.length;e++)if(!(a.writePacketArray[e].sent||a.parallelJobsNow>=a.maxParallel)){a.writePacketArray[e].reqTime=process.hrtime(),a.writeReq.writeUInt8(a.writePacketArray[e].itemList.length,18),a.writeReq.writeUInt16BE(a.writePacketArray[e].seqNum,11),o=0;for(var i=0;i<a.writePacketArray[e].itemList.length;i++)u(a.writePacketArray[e].itemList[i],!0).copy(a.writeReq,19+12*i),(r=C(a.writePacketArray[e].itemList[i])).copy(t,o),o+=r.length,i<a.writePacketArray[e].itemList.length-1&&r.length%2&&(o+=1);a.writeReq.writeUInt16BE(19+12*a.writePacketArray[e].itemList.length+o,2),a.writeReq.writeUInt16BE(12*a.writePacketArray[e].itemList.length+2,13),a.writeReq.writeUInt16BE(o,15),t.copy(a.writeReq,19+12*a.writePacketArray[e].itemList.length,0,o),4===a.isoConnectionState?(a.writePacketArray[e].timeout=setTimeout((function(){a.packetTimeout.apply(a,arguments)}),a.globalTimeout,"write",a.writePacketArray[e].seqNum),a.isoclient.write(a.writeReq.slice(0,19+o+12*a.writePacketArray[e].itemList.length)),a.writePacketArray[e].sent=!0,a.writePacketArray[e].rcvd=!1,a.writePacketArray[e].timeoutError=!1,a.parallelJobsNow+=1,P("Sending Write Packet With Sequence Number "+a.writePacketArray[e].seqNum,1,a.connectionID)):(a.writePacketArray[e].sent=!0,a.writePacketArray[e].rcvd=!1,a.writePacketArray[e].timeoutError=!0,a.writePacketArray[e].timeout=setTimeout((function(){a.packetTimeout.apply(a,arguments)}),0,"write",a.writePacketArray[e].seqNum),0===a.isoConnectionState&&!0)}},n.prototype.isOptimizableArea=function(e){if(this.doNotOptimize)return!1;switch(e){case 132:case 129:case 130:case 131:return!0;default:return!1}},n.prototype.onResponse=function(e){var t=this;if(!(e&&e.length>6))return P("INVALID READ RESPONSE - DISCONNECTING"),P("The incoming packet doesn't have the required minimum length of 7 bytes"),P(e),void t.connectionReset();var r=l(e);if("fastACK"===r)P("Fast Acknowledge received.",0,t.connectionID),t.isoclient.removeAllListeners("error"),t.isoclient.removeAllListeners("data"),t.isoclient.on("data",(function(){t.onResponse.apply(t,arguments)})),t.isoclient.on("error",(function(){t.readWriteError.apply(t,arguments)}));else{if(50!==r[7])return P("INVALID READ RESPONSE - DISCONNECTING"),P("TPKT Length From Header is "+e.readInt16BE(2)+" and RCV buffer length is "+e.length+" and COTP length is "+e.readUInt8(4)+" and data[6] is "+e[6]),P(e),t.connectionReset(),null;if(r.length>8&&3!=r[8])return P("PDU type (byte 8) was returned as "+r[8]+" where the response PDU of 3 was expected."),P("Maybe you are requesting more than 240 bytes of data in a packet?"),P(r),t.connectionReset(),null;if(r.length>r.readInt16BE(2)&&(P("An oversize packet was detected.  Excess length is "+(r.length-r.readInt16BE(2))+".  "),P("We assume this is because two packets were sent at nearly the same time by the PLC."),P("We are slicing the buffer and scheduling the second half for further processing next loop."),setTimeout((function(){t.onResponse.apply(t,arguments)}),0,r.slice(r.readInt16BE(2)))),r.length<r.readInt16BE(2)||r.readInt16BE(2)<22||240!==r[5]||r[4]+1+12+4+r.readInt16BE(13)+r.readInt16BE(15)!==r.readInt16BE(2)||!(r[6]>>7)||50!==r[7]||3!==r[8])return P("INVALID READ RESPONSE - DISCONNECTING"),P("TPKT Length From Header is "+r.readInt16BE(2)+" and RCV buffer length is "+r.length+" and COTP length is "+r.readUInt8(4)+" and data[6] is "+r[6]),P(r),t.connectionReset(),null;var o,a,i;if(P("Received "+r.readUInt16BE(15)+" bytes of S7-data from PLC.  Sequence number is "+r.readUInt16BE(11),1,t.connectionID),void 0===(o=t.findReadIndexOfSeqNum(r.readUInt16BE(11)))?void 0!==(o=t.findWriteIndexOfSeqNum(r.readUInt16BE(11)))&&(t.writeResponse(r,o),i=!0):(a=!0,t.readResponse(r,o)),!a&&!i)return P("Sequence number that arrived wasn't a write reply either - dropping"),P(r),null}},n.prototype.findReadIndexOfSeqNum=function(e){var t;for(t=0;t<this.readPacketArray.length;t++)if(this.readPacketArray[t].seqNum==e)return t},n.prototype.findWriteIndexOfSeqNum=function(e){var t;for(t=0;t<this.writePacketArray.length;t++)if(this.writePacketArray[t].seqNum==e)return t},n.prototype.writeResponse=function(e,t){for(var r,o,a=21,i=0;i<this.writePacketArray[t].itemList.length;i++)if(!(a=p(e,this.writePacketArray[t].itemList[i],a))){P("Stopping Processing Write Response Packet due to unrecoverable packet error");break}if(this.writePacketArray[t].reqTime=process.hrtime(this.writePacketArray[t].reqTime),P("Time is "+this.writePacketArray[t].reqTime[0]+" seconds and "+Math.round(10*this.writePacketArray[t].reqTime[1]/1e6)/10+" ms.",1,this.connectionID),this.writePacketArray[t].rcvd||(this.writePacketArray[t].rcvd=!0,this.parallelJobsNow--),clearTimeout(this.writePacketArray[t].timeout),this.writePacketArray.every(d)){for(P("Received all packets in writeResponse",1,this.connectionID),r=0;r<this.writePacketArray.length;r++)this.writePacketArray[r].sent=!1,this.writePacketArray[r].rcvd=!1;for(o=!1,r=0;r<this.globalWriteBlockList.length;r++){f(this.globalWriteBlockList[r]);for(var s=0;s<this.globalWriteBlockList[r].itemReference.length;s++)P(this.globalWriteBlockList[r].itemReference[s].addr+" write completed with quality "+this.globalWriteBlockList[r].itemReference[s].writeQuality,0,this.connectionID),L(this.globalWriteBlockList[r].itemReference[s].writeQuality)||(o=!0);L(this.globalWriteBlockList[r].writeQuality)||(o=!0)}this.resetPending&&(P("Calling reset from writeResponse as there is one pending",0,this.connectionID),this.resetNow()),0===this.isoConnectionState&&this.connectNow(this.connectionParams,!1),P("We are calling back our writeDoneCallback.",1,this.connectionID),"function"==typeof this.writeDoneCallback&&this.writeDoneCallback(o)}else P("Not done sending - sending more packets from writeResponse",1,this.connectionID),this.sendWritePacket()},n.prototype.readResponse=function(e,t){var r,o,a=21,i={};if(P("ReadResponse called",1,this.connectionID),!this.readPacketArray[t].sent)return P("WARNING: Received a read response packet that was not marked as sent",0,this.connectionID),null;if(this.readPacketArray[t].rcvd)return P("WARNING: Received a read response packet that was already marked as received",0,this.connectionID),null;for(var s=0;s<this.readPacketArray[t].itemList.length;s++)(a=c(e,this.readPacketArray[t].itemList[s],a,this.connectionID))||P("Received a ZERO RESPONSE Processing Read Packet due to unrecoverable packet error",0,this.connectionID);if(this.readPacketArray[t].reqTime=process.hrtime(this.readPacketArray[t].reqTime),P("Time is "+this.readPacketArray[t].reqTime[0]+" seconds and "+Math.round(10*this.readPacketArray[t].reqTime[1]/1e6)/10+" ms.",1,this.connectionID),this.readPacketArray[t].rcvd||(this.readPacketArray[t].rcvd=!0,this.parallelJobsNow--),clearTimeout(this.readPacketArray[t].timeout),this.readPacketArray.every(d)){for(r=0;r<this.readPacketArray.length;r++)this.readPacketArray[r].sent=!1,this.readPacketArray[r].rcvd=!1;for(o=!1,r=0;r<this.globalReadBlockList.length;r++){for(var n=0,l=0;l<this.globalReadBlockList[r].requestReference.length;l++)this.globalReadBlockList[r].requestReference[l].byteBuffer.copy(this.globalReadBlockList[r].byteBuffer,n,0,this.globalReadBlockList[r].requestReference[l].byteLength),this.globalReadBlockList[r].requestReference[l].qualityBuffer.copy(this.globalReadBlockList[r].qualityBuffer,n,0,this.globalReadBlockList[r].requestReference[l].byteLength),n+=this.globalReadBlockList[r].requestReference[l].byteLength;for(var u=0;u<this.globalReadBlockList[r].itemReference.length;u++)v(this.globalReadBlockList[r].itemReference[u]),P("Address "+this.globalReadBlockList[r].itemReference[u].addr+" has value "+this.globalReadBlockList[r].itemReference[u].value+" and quality "+this.globalReadBlockList[r].itemReference[u].quality,1,this.connectionID),L(this.globalReadBlockList[r].itemReference[u].quality)?i[this.globalReadBlockList[r].itemReference[u].useraddr]=this.globalReadBlockList[r].itemReference[u].value:(o=!0,i[this.globalReadBlockList[r].itemReference[u].useraddr]=this.globalReadBlockList[r].itemReference[u].quality)}this.writeInQueue?P("Write In Queue.  ICS "+this.isoConnectionState+" resetPending "+this.resetPending,1,this.connectionID):(this.resetPending&&(P("Calling reset from readResponse as there is one pending",0,this.connectionID),this.resetNow()),0===this.isoConnectionState&&this.connectNow(this.connectionParams,!1)),P("We are calling back our readDoneCallback.",1,this.connectionID),"function"==typeof this.readDoneCallback&&this.readDoneCallback(o,i),!this.isReading()&&this.writeInQueue&&(P("SendWritePacket called because write was queued.",0,this.connectionID),this.sendWritePacket())}else this.sendReadPacket()},n.prototype.onClientDisconnect=function(){P("ISO-on-TCP connection DISCONNECTED.",0,this.connectionID),this.connectCBIssued||"function"!=typeof this.connectCallback||(this.connectCBIssued=!0,this.connectCallback("Error - TCP connected, ISO didn't")),this.connectionReset()},n.prototype.onClientClose=function(){this.connectionReset(),this.dropConnectionCallback&&(this.dropConnectionCallback(),this.dropConnectionCallback=null,clearTimeout(this.dropConnectionTimer))},n.prototype.connectionReset=function(){var e=this;e.isoConnectionState=0,e.resetPending=!0,P("ConnectionReset has been called to set the reset as pending",0,e.connectionID),e.isReading()||e.isWriting()||e.writeInQueue||void 0!==e.resetTimeout||(e.resetTimeout=setTimeout((function(){P("Timed reset has happened. Ideally this would never be called as reset should be completed when done r/w.",0,e.connectionID),e.resetNow.apply(e,arguments)}),3500))},n.prototype.resetNow=function(){this.isoConnectionState=0,this.isoclient.end(),P("ResetNOW is happening",0,this.connectionID),this.resetPending=!1,void 0!==this.resetTimeout&&(clearTimeout(this.resetTimeout),this.resetTimeout=void 0,P("Clearing an earlier scheduled reset",0,this.connectionID))},n.prototype.connectionCleanup=function(){this.isoConnectionState=0,P("Connection cleanup is happening",0,this.connectionID),void 0!==this.isoclient&&(this.isoclient.destroy(),this.isoclient.removeAllListeners("data"),this.isoclient.removeAllListeners("error"),this.isoclient.removeAllListeners("connect"),this.isoclient.removeAllListeners("end"),this.isoclient.removeAllListeners("close"),this.isoclient.on("error",(function(){P("TCP socket error following connection cleanup")}))),clearTimeout(this.connectTimeout),clearTimeout(this.PDUTimeout),this.clearReadPacketTimeouts(),this.clearWritePacketTimeouts()}},function(e,t,r){var o=r(1),a=r(4);e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("DataExcel",o.xlData),e.emit("ExcelWordAdjust",o.WordAdjust),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateTextField",o.resultTextField),e.on("disconnect",(function(){console.log("ngat kekt noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("DataExcel",o.xlData),e.emit("ExcelWordAdjust",o.WordAdjust),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateTextField",o.resultTextField)})),e.on("Client-send-data",(function(e){if(console.log(e),"SendDataSiemens"===e.NameCommand&&(e=e.data.slice(1),console.log(e)),"ElementForce_Run"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[100,100,e.tag,e.tag],()=>{console.log("can not write data Siemens")}),"ElementForce_Stop"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[101,101,e.tag,e.tag],()=>{console.log("can not write data Siemens")}),"ElementForce_Auto"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[102,102,e.tag,e.tag],()=>{console.log("can not write data Siemens")}),"ElementForce_Interlock"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[103,103,e.tag,e.tag],()=>{console.log("can not write data Siemens")}),"BitAdjustForce"===e.NameCommand&&!isNaN(e.tag))if(a.PLC_Siemens_WriteUnSafe){if(parseInt(e.tag)/16<=a.PLC_Siemens_LengthOfWordBitAdjust){let r=1<<parseInt(e.tag)%16,i=(a.PLC_Siemens_WordStartBitAdjust,Math.floor(e.tag/16),o.WordBitAdjust[Math.floor(e.tag/16)]);i^=r,t.writeItems("WriteUnSafeBitAdjust",[i]),console.log(i)}}else t.writeItems("ComPC",[110,110,e.mode,e.mode,e.tag,e.tag],()=>{console.log("can not write data Siemens")});if("WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||parseInt(e.value)>=-32767&&parseInt(e.value)<=32768&&t.writeItems("ComPC",[111,111,e.tag,e.tag,e.value,e.value],()=>{console.log("can not write data Siemens")}),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)&&parseInt(e.value)>=-2147483648&&parseInt(e.value)<=2147483648){var r=parseInt(e.value/65536),i=parseInt(r/32767),s=r%32767,n=parseInt(e.value%65536),d=parseInt(n/32767),l=n%32767;console.log("dwordadjust"),console.log(i),console.log(s),console.log(d),console.log(l),t.writeItems("ComPC",[112,112,e.tag,e.tag,i,s,d,l],()=>{console.log("can not write data Siemens")})}}))}))}},function(e,t){e.exports=require("xlsx")},function(e,t,r){var o=r(4),a=r(1),i=r(45),s=r(11),n=r(10),d=r(0),l=r(147);e.exports=function(e,t){a.Percent=new Array(20).fill(0),a.BitAdjust=new Array(20).fill(0),a.BitDisplay=new Array(20).fill(0),a.WordAdjust=new Array(20).fill(0),a.WordDisplay=new Array(20).fill(0),a.DWordAdjust=new Array(20).fill(0),a.DWordDisplay=new Array(20).fill(0),a.ListString=new Array(20).fill("---"),a.TextField=new Array(20).fill("---");var u=o.PLC_ScaleMeasure_COM_PORT;console.log(u);var c=new l(u,{baudRate:9600,autoOpen:!1});const p=r(148);c.pipe(new p({delimiter:"\r\n"})).on("data",(function(e){i.RealWeight1=1e3*e.toString().replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"").trim().substring(0,6)})),c.on("open",(function(){a.TextField[4]="Com Port is opened "+u})),c.on("error",(function(){a.TextField[4]="Com Port is ERROR"})),c.on("close",(function(){a.TextField[4]="Com Port is closed"}));var f=setInterval((function(){a.resultTextFieldInput.length>0&&(a.resultTextFieldInput[1].value=u,clearInterval(f))}),1e3);function h(){void 0!==c&&(c.isOpen||c.open(e=>{console.log("Openning com port"),e&&(a.TextField[4]=e),e&&(console.log("Port is not open: "+e.message),setTimeout(h,1e4))}))}setInterval(()=>{a.ListString[3]=u,1==a.BitAdjust[2]&&(a.BitAdjust[2]=0,l.list().then((function(e){a.TextField[3]="",e.forEach((function(e){console.log("Port: ",e),a.TextField[3]=a.TextField[3]+e.path+"---"+e.manufacturer+"\n"}))}))),1==a.BitAdjust[3]&&h(),0==a.BitAdjust[3]&&(i.InitialConnectCOM=!1,void 0!==c&&c.isOpen&&c.close())},1e3),e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",a.resultElement),e.emit("UpdateBitAdjust",a.resultBitAdjust),e.emit("UpdateBitDisplay",a.resultBitDisplay),e.emit("UpdateWordAdjust",a.resultWordAdjust),e.emit("UpdateWordDisplay",a.resultWordDisplay),e.emit("UpdateDWordAdjust",a.resultDWordAdjust),e.emit("UpdateDWordDisplay",a.resultDWordDisplay),e.emit("UpdateTextField",a.resultTextField),e.on("disconnect",(function(){console.log("ngat kekt noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("UpdateElement",a.resultElement),e.emit("UpdateBitAdjust",a.resultBitAdjust),e.emit("UpdateBitDisplay",a.resultBitDisplay),e.emit("UpdateWordAdjust",a.resultWordAdjust),e.emit("UpdateWordDisplay",a.resultWordDisplay),e.emit("UpdateDWordAdjust",a.resultDWordAdjust),e.emit("UpdateDWordDisplay",a.resultDWordDisplay),e.emit("UpdateTextField",a.resultTextField)})),e.on("Client-send-data",(function(e){"BitAdjustForce"!==e.NameCommand||isNaN(e.tag)||(a.BitAdjust[e.tag]=!a.BitAdjust[e.tag]),"WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(a.WordAdjust[e.tag]=e.value),"DWordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(a.DWordAdjust[e.tag]=e.value),"SendDataSearchBox"===e.NameCommand&&"Product1"===e.tag&&1===e.data.ScaleNumber&&(a.ListString[0]=e.data.ProductName,a.ListString[1]=e.data._id,a.WordDisplay[1]=e.data.ProductTonKho,a.WordDisplay[2]=e.data.ProductHeSo,a.WordDisplay[4]=e.data.ProductCapacity),"TextFieldInput"===e.NameCommand&&("0"===e.tag&&(a.ListString[2]=e.value),"1"===e.tag&&(u=e.value))})),e.on("UpdateScaleProject_Scale",(function(e){1===e.ScaleNumber&&(a.ListString[0]=e.ProductName,a.ListString[1]=e.id,a.WordDisplay[1]=e.ProductTonKho,a.WordDisplay[2]=e.ProductHeSo,a.WordDisplay[4]=e.ProductCapacity)})),setInterval(()=>{let{returnTextField:e,step:t,oldEnableCalib:r,confirm:o,oldConfirm:l,heso:u}=s.calibrationScale(a.BitAdjust[0],i.oldEnableCalib1,a.BitAdjust[1],i.oldConfirm1,a.WordDisplay[3],a.DWordDisplay[0],a.WordAdjust[0],i.heso1);if(a.TextField[2]=e,a.WordDisplay[3]=t,i.oldEnableCalib1=r,a.BitAdjust[1]=o,i.oldConfirm1=l,i.heso1=u,5==t){let e={};if(1==d.Types.ObjectId.isValid(a.ListString[1])){e._id=d.Types.ObjectId(a.ListString[1]);let t={};void 0!==a.ListString[1]&&(t.ProductHeSo=i.heso1),console.log(t);const r={new:!0};n.findOneAndUpdate(e,{$set:t},r,(e,t)=>{e?(a.TextField[2]="Update Error"+e,a.refreshDataScaleProject=!0,a.WordDisplay[3]=7):(a.TextField[2]="Update Hệ Số Thành Công",a.WordDisplay[2]=i.heso1,a.refreshDataScaleProject=!0,a.WordDisplay[3]=6)})}else a.WordDisplay[3]=8}},100),setInterval(()=>{a.DWordDisplay[0]=a.WordAdjust[1],a.DWordDisplay[0]=i.RealWeight1;let{returnTextField:e,soluong:t,finish:r,oldfinish:o,NameProduct:n,NameCustomer:d,NameOperator:l,AmoutProduct:u,saveFinish:c,valuePercent:p,tenKH:f,tenSP:h,tenSL:y,statusOK:g}=s.measureScale(1,a.BitAdjust[0],a.BitAdjust[2],i.oldFinish1,a.ListString[1],a.DWordDisplay[0],a.WordDisplay[2],a.DWordAdjust[0],a.ListString[0],a.ListString[2],"---",a.DWordAdjust[0],a.WordDisplay[0],i.saveFinish1,a.WordDisplay[4],a.WordDisplay[1]);a.TextField[1]=e,a.WordDisplay[0]=t,a.BitAdjust[2]=r,i.oldFinish1=o,a.ListString[0]=n,a.ListString[2]=d,a.DWordAdjust[0]=u,i.saveFinish1=c,a.Percent[0]=p,a.BitDisplay[0]=h,a.BitDisplay[1]=y,a.BitDisplay[2]=f,a.BitDisplay[3]=g},100)}))}},function(e,t){e.exports=require("serialport")},function(e,t){e.exports=require("@serialport/parser-readline")},function(e,t,r){var o=r(1),a=(r(70),r(150));r(0);e.exports=function(e,t){o.BitAdjust=new Array(20).fill(0),o.BitDisplay=new Array(20).fill(0),o.WordAdjust=new Array(20).fill(0),o.WordDisplay=new Array(20).fill(0),o.DWordAdjust=new Array(20).fill(0),o.DWordDisplay=new Array(20).fill(0),o.ListString=new Array(20).fill("---"),o.TextField=new Array(20).fill("---");var i=r(151),s=(r(152),{port:1883,clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),username:"chuxuanhy",password:"0936160721",keepalive:10}),n=i.connect("mqtt://tracking.proship.vn:1883",s);n.on("connect",(function(){n.subscribe("IAQ_Measures")})),n.on("message",(e,t)=>{switch(e){case"IAQ_Measures":return function(e){a.saveMongodbNanoenvi(e)}(t)}console.log("No handle for topic:",e)}),n.on("reconnect",(function(){console.log("reconnect MQTT")})),e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateTextField",o.resultTextField),e.on("disconnect",(function(){console.log("ngat kekt noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("UpdateElement",o.resultElement),e.emit("UpdateBitAdjust",o.resultBitAdjust),e.emit("UpdateBitDisplay",o.resultBitDisplay),e.emit("UpdateWordAdjust",o.resultWordAdjust),e.emit("UpdateWordDisplay",o.resultWordDisplay),e.emit("UpdateDWordAdjust",o.resultDWordAdjust),e.emit("UpdateDWordDisplay",o.resultDWordDisplay),e.emit("UpdateTextField",o.resultTextField)})),e.on("Client-send-data",(function(e){"BitAdjustForce"!==e.NameCommand||isNaN(e.tag)||(o.BitAdjust[e.tag]=!o.BitAdjust[e.tag]),"WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(o.WordAdjust[e.tag]=e.value),"DWordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(o.DWordAdjust[e.tag]=e.value),"SendDataSearchBox"!==e.NameCommand||isNaN(e.tag)||(1===parseInt(e.tag)&&(o.ListString[2]=e.data),2===parseInt(e.tag)&&(o.ListString[12]=e.data))}))}))}},function(e,t,r){r(0);var o=r(1),a=(r(70),r(71));e.exports={saveMongodbNanoenvi:function(e){if(e+="",objectTemp=JSON.parse(e),null!=objectTemp){new a({uuid:objectTemp.device_info.uuid,measure:objectTemp.measures}).save(e=>{e?(console.log("Error is: "+e),console.log("insert db error",e)):(console.log("insert success"),o.refreshDataProjectNanoenvi=!0)})}}}},function(e,t){e.exports=require("mqtt")},function(e,t){e.exports=require("url")},function(e,t,r){var o=r(1),a=r(31),i=r(9),s=r(19),n=r(20),d=r(22),l=r(39),u=r(23),c=r(21),p=r(29),f=r(28),h=r(30),y=r(24),g=r(25),b=r(26),m=r(27),I=r(32),v=r(33),C=r(69),D=r(34),w=r(36),B=r(37),S=r(38),A=r(41),k=r(42),L=r(10),P=r(43),R=r(44),W=r(12),N=r(71),j=r(46),_=r(5),x=r(4),T=r(11);const{configuration:O}=r(3);var E=o.IO;e.exports=function(){o.refreshDataBitAdjust=!0,o.refreshDataMap=!0,o.refreshDataBitDisplay=!0,o.refreshDataDWordAdjust=!0,o.refreshDataDWordDisplay=!0,o.refreshDataElement=!0,o.refreshDataImage=!0,o.refreshDataLabel=!0,o.refreshDataString=!0,o.refreshDataPanel=!0,o.refreshDataWordAdjust=!0,o.refreshDataWordDisplay=!0,o.refreshDataTextField=!0,o.refreshDataTextFieldInput=!0,o.refreshDataPosCobot=!0,o.refreshDataBitDisplayImageLibrary=!0,o.refreshDataMapImageLibrary=!0,o.refreshDataElementImageLibrary=!0,o.refreshDataGroupControl=!0,o.refreshDataProduct=!0,o.refreshDataGoal=!0,o.refreshDataUser=!0,o.refreshDataSampleRoute=!0,o.refreshDataFormularProject=!0,o.refreshDataScaleProject=!0,o.refreshDataSearchBox=!0,o.refreshDataSearchBoxList=!0,o.refreshDataReportScaleProject=!0,o.refreshDataProjectNanoenvi=!0,o.refreshDataPercent=!0,setInterval((function(){try{o.refreshDataUser&&(o.refreshDataUser=!1,i.find().limit(500).sort().exec((e,t)=>{e?console.log("get data from db error"):(o.resultUser=t,E.sockets.emit("UpdateUser",o.resultUser),console.log("Get modelUser data successfull",t.length))}))}catch(e){}try{o.refreshDataProduct&&x.ProjectOnsemi&&(o.refreshDataProduct=!1,s.find().limit().sort().exec((e,t)=>{e?console.log("get data from db error"):(o.resultProduct=t,_.saveJsonFile("./Store/Database/Product.json",t),E.sockets.emit("UpdateProduct",o.resultProduct),console.log("Get modelProduct data successfull",t.length))}))}catch(e){}try{o.refreshDataGoal&&x.ProjectOnsemi&&(o.refreshDataGoal=!1,n.find().limit().sort().exec((e,t)=>{e?console.log("get data from db error"):(o.resultGoal=t,E.sockets.emit("UpdateGoal",o.resultGoal),console.log("Get modelGoal data successfull",t.length))}))}catch(e){}try{o.refreshDataSampleRoute&&x.ProjectOnsemi&&(o.refreshDataSampleRoute=!1,A.find().limit(1e3).sort("Order").exec((e,t)=>{e?console.log("get data from db error"):(o.resultSampleRoute=t,E.sockets.emit("UpdateSampleRoute",o.resultSampleRoute),console.log("Get modelSampleRoute data successfull",t.length))}))}catch(e){}try{o.refreshDataFormularProject&&x.PLC_Siemens&&(o.refreshDataFormularProject=!1,k.find().limit().sort("Step").exec((e,t)=>{e?console.log("get data from db error"):(o.resultFormularProject=t,E.sockets.emit("UpdateFormularProject",o.resultFormularProject),console.log("Get modelFormularProject data successfull",t.length))}))}catch(e){}try{o.refreshDataScaleProject&&x.PLC_ScaleMeasure&&(o.refreshDataScaleProject=!1,L.find().limit().sort("ProductName").exec((e,t)=>{e?console.log("get data from db error"):(o.resultScaleProject=t,_.saveJsonFile("./Store/Database/ScaleProject.json",t),E.sockets.emit("UpdateScaleProject",o.resultScaleProject),console.log("Get modelScaleProject data successfull",t.length))}))}catch(e){}try{o.refreshDataSearchBox&&x.PLC_ScaleMeasure&&(o.refreshDataSearchBox=!1,P.find().limit().sort().exec((e,t)=>{e?console.log("get data from db error"):(o.resultSearchBox=t,_.saveJsonFile("./Store/Database/SearchBox.json",t),E.sockets.emit("UpdateSearchBox",o.resultSearchBox),console.log("Get modelSearchBox data successfull",t.length))}))}catch(e){}try{o.refreshDataSearchBoxList&&x.PLC_ScaleMeasure&&(o.refreshDataSearchBoxList=!1,R.find().limit().sort("SearchBoxListName").exec((e,t)=>{e?console.log("get data from db error"):(o.resultSearchBoxList=t,_.saveJsonFile("./Store/Database/SearchBoxList.json",t),E.sockets.emit("UpdateSearchBoxList",T.GetSearchDataList()),console.log("Get modelSearchBoxList data successfull",t.length))}))}catch(e){}try{o.refreshDataReportScaleProject&&x.PLC_ScaleMeasure&&(o.refreshDataReportScaleProject=!1,o.refreshDataSearchBoxList=!0,W.find().limit().sort().exec((e,t)=>{e?console.log("get data from db error"):o.resultReportScaleProject=t}))}catch(e){}try{o.refreshDataProjectNanoenvi&&x.Nanoenvi&&(o.refreshDataProjectNanoenvi=!1,N.find().sort({date:-1}).limit(1e3).exec((e,t)=>{e?console.log("get data from db error"):(o.resultProjectNanoenvi=t.reverse(),E.sockets.emit("UpdateNanoenvi",o.resultProjectNanoenvi))}))}catch(e){}try{if(o.refreshDataPercent&&(o.refreshDataPercent=!1,j.find().limit().sort().exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)!isNaN(t[e].tag)&&parseInt(t[e].tag)<=o.Percent.length&&(t[e].value=o.Percent[t[e].tag]);o.resultPercent=t,_.saveJsonFile("./Store/Database/Percent.json",t),E.sockets.emit("UpdatePercent",o.resultPercent),console.log("Get modelPanel data successfull",t.length)}})),o.haveChangePercent&&o.resultPercent.length>0){o.haveChangePercent=!1;for(let e=0;e<o.resultPercent.length;e++)o.resultPercent[e].value=o.Percent[o.resultPercent[e].tag];E.sockets.emit("UpdatePercent",o.resultPercent)}}catch(e){}try{o.refreshDataPanel&&(o.refreshDataPanel=!1,a.find().limit(1e3).sort().exec((e,t)=>{e?console.log("get data from db error"):(o.resultPanel=t,_.saveJsonFile("./Store/Database/Panel.json",t),E.sockets.emit("UpdatePanel",o.resultPanel),console.log("Get modelPanel data successfull",t.length))}))}catch(e){}try{if(o.refreshDataElement&&(o.refreshDataElement=!1,c.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)isNaN(parseInt(t[e].tag))?(t[e].state_m=0,t[e].state_cm=0,t[e].state_f0=0,t[e].state_F1=0,t[e].state_Fault=0,t[e].state_Interlock=0):parseInt(t[e].tag)<=o.Element.length&&(2&o.Element[t[e].tag]?t[e].state_m=1:t[e].state_m=0,4&o.Element[t[e].tag]?t[e].state_cm=1:t[e].state_cm=0,8&o.Element[t[e].tag]?t[e].state_F0=1:t[e].state_F0=0,16&o.Element[t[e].tag]?t[e].state_F1=1:t[e].state_F1=0,32&o.Element[t[e].tag]?t[e].state_Fault=1:t[e].state_Fault=0,128&o.Element[t[e].tag]?t[e].state_Interlock=1:t[e].state_Interlock=0);o.resultElement=t,_.saveJsonFile("./Store/Database/Element.json",t),E.sockets.emit("UpdateElement",o.resultElement),console.log("Get modelElement data successfull",t.length)}})),o.haveChangeElement&&o.resultElement.length>0){o.haveChangeElement=!1;for(let e=0;e<o.resultElement.length;e++)isNaN(parseInt(o.resultElement[e].tag))?(o.resultElement[e].state_m=0,o.resultElement[e].state_cm=0,o.resultElement[e].state_f0=0,o.resultElement[e].state_F1=0,o.resultElement[e].state_Fault=0,o.resultElement[e].state_Interlock=0):parseInt(o.resultElement[e].tag)<=o.Element.length&&(2&o.Element[o.resultElement[e].tag]?o.resultElement[e].state_m=1:o.resultElement[e].state_m=0,4&o.Element[o.resultElement[e].tag]?o.resultElement[e].state_cm=1:o.resultElement[e].state_cm=0,8&o.Element[o.resultElement[e].tag]?o.resultElement[e].state_F0=1:o.resultElement[e].state_F0=0,16&o.Element[o.resultElement[e].tag]?o.resultElement[e].state_F1=1:o.resultElement[e].state_F1=0,32&o.Element[o.resultElement[e].tag]?o.resultElement[e].state_Fault=1:o.resultElement[e].state_Fault=0,128&o.Element[o.resultElement[e].tag]?o.resultElement[e].state_Interlock=1:o.resultElement[e].state_Interlock=0);E.sockets.emit("UpdateElement",o.resultElement),console.log("Get modelElement data successfull",Element.length)}}catch(e){}try{o.refreshDataLine&&(o.refreshDataLine=!1,u.find({}).limit().sort({x:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultline=t,_.saveJsonFile("./Store/Database/Lines.json",t),E.sockets.emit("UpdateLine",o.resultline),console.log("Get modelLines data successfull"))}))}catch(e){}try{o.refreshDataLabel&&(o.refreshDataLabel=!1,d.find({}).limit().sort({left:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultlabel=t,_.saveJsonFile("./Store/Database/Labels.json",t),E.sockets.emit("UpdateLabel",o.resultlabel),console.log("Get modelLabel data successfull",t.length))}))}catch(e){}try{if(o.refreshDataString&&(o.refreshDataString=!1,l.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].tag<=o.ListString.length&&(t[e].text=o.ListString[t[e].tag]);o.resultString=t,_.saveJsonFile("./Store/Database/String.json",t),E.sockets.emit("UpdateString",o.resultString),console.log("Get modelString data successfull",t.length)}})),o.haveChangeString&&o.resultString.length>0){o.haveChangeString=!1;for(let e=0;e<o.resultString.length;e++)o.resultString[e].tag<=o.ListString.length&&(o.resultString[e].text=o.ListString[o.resultString[e].tag]);E.sockets.emit("UpdateString",o.resultString)}}catch(e){}try{if(o.refreshDataBitAdjust&&(o.refreshDataBitAdjust=!1,h.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].status=!1,!isNaN(t[e].tag)&&parseInt(t[e].tag)<=o.BitAdjust.length&&(t[e].status=o.BitAdjust[t[e].tag]);o.resultBitAdjust=t,_.saveJsonFile("./Store/Database/BitAdjust.json",t),E.sockets.emit("UpdateBitAdjust",o.resultBitAdjust),console.log("Get modelBitAdjust data successfull",t.length)}})),o.haveChangeBitAdjust&&o.resultBitAdjust.length>0){o.haveChangeBitAdjust=!1;for(let e=0;e<o.resultBitAdjust.length;e++)o.resultBitAdjust[e].tag<=o.BitAdjust.length&&(o.resultBitAdjust[e].status=o.BitAdjust[o.resultBitAdjust[e].tag]);E.sockets.emit("UpdateBitAdjust",o.resultBitAdjust)}}catch(e){}try{if(o.refreshDataBitDisplay&&(o.refreshDataBitDisplay=!1,f.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].tag<=o.BitDisplay.length&&(t[e].status=o.BitDisplay[t[e].tag]);o.resultBitDisplay=t,_.saveJsonFile("./Store/Database/BitDisplay.json",t),E.sockets.emit("UpdateBitDisplay",o.resultBitDisplay),console.log("Get modelBitDisplay data successfull",t.length)}})),o.haveChangeBitDisplay&&o.resultBitDisplay.length>0){o.haveChangeBitDisplay=!1;for(let e=0;e<o.resultBitDisplay.length;e++)o.resultBitDisplay[e].tag<=o.BitDisplay.length&&(o.resultBitDisplay[e].status=o.BitDisplay[o.resultBitDisplay[e].tag]);E.sockets.emit("UpdateBitDisplay",o.resultBitDisplay)}}catch(e){}try{o.refreshDataMap&&(o.refreshDataMap=!1,p.find({}).limit(1e3).sort({left:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultMap=t,_.saveJsonFile("./Store/Database/Map.json",t),E.sockets.emit("UpdateMap",o.resultMap),console.log("Get modelMap data successfull",t.length))})),o.haveChangeMap&&o.resultMap.length>0&&(o.haveChangeMap=!1,E.sockets.emit("UpdateMap",o.resultMap))}catch(e){}try{if(o.refreshDataWordDisplay&&(o.refreshDataWordDisplay=!1,y.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].text=o.WordDisplay[t[e].tag];o.resultWordDisplay=t,_.saveJsonFile("./Store/Database/WordDisplay.json",t),E.sockets.emit("UpdateWordDisplay",o.resultWordDisplay),console.log("Get modelWordDisplay data successfull",t.length)}})),o.haveChangeWordDisplay&&o.resultWordDisplay.length>0){o.haveChangeWordDisplay=!1;for(let e=0;e<o.resultWordDisplay.length;e++)o.resultWordDisplay[e].text=o.WordDisplay[o.resultWordDisplay[e].tag];E.sockets.emit("UpdateWordDisplay",o.resultWordDisplay)}}catch(e){}try{if(o.refreshDataWordAdjust&&(o.refreshDataWordAdjust=!1,g.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].text=o.WordAdjust[t[e].tag];o.resultWordAdjust=t,_.saveJsonFile("./Store/Database/WordAdjust.json",t),E.sockets.emit("UpdateWordAdjust",o.resultWordAdjust),console.log("Get modelWordAdjust data successfull",t.length)}})),o.haveChangeWordAdjust&&o.resultWordAdjust.length>0){o.haveChangeWordAdjust=!1;for(let e=0;e<o.resultWordAdjust.length;e++)o.resultWordAdjust[e].text=o.WordAdjust[o.resultWordAdjust[e].tag];E.sockets.emit("UpdateWordAdjust",o.resultWordAdjust)}}catch(e){}try{if(o.refreshDataDWordDisplay&&(o.refreshDataDWordDisplay=!1,b.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].text=o.DWordDisplay[t[e].tag];o.resultDWordDisplay=t,_.saveJsonFile("./Store/Database/DWordDisplay.json",t),E.sockets.emit("UpdateDWordDisplay",o.resultDWordDisplay),console.log("Get modelDWordDisplay data successfull",t.length)}})),o.haveChangeDWordDisplay&&o.resultDWordDisplay.length>0){o.haveChangeDWordDisplay=!1;for(let e=0;e<o.resultDWordDisplay.length;e++)o.resultDWordDisplay[e].text=o.DWordDisplay[o.resultDWordDisplay[e].tag];E.sockets.emit("UpdateDWordDisplay",o.resultDWordDisplay)}}catch(e){}try{if(o.refreshDataDWordAdjust&&(o.refreshDataDWordAdjust=!1,m.find({}).limit().sort({left:1}).exec((e,t)=>{if(e)console.log("get data from db error");else{for(let e=0;e<t.length;e++)t[e].text=o.DWordAdjust[t[e].tag];o.resultDWordAdjust=t,_.saveJsonFile("./Store/Database/DWordAdjust.json",t),E.sockets.emit("UpdateDWordAdjust",o.resultDWordAdjust),console.log("Get modelDWordAdjust data successfull",t.length)}})),o.haveChangeDWordAdjust&&o.resultDWordAdjust.length>0){o.haveChangeDWordAdjust=!1;for(let e=0;e<o.resultDWordAdjust.length;e++)o.resultDWordAdjust[e].text=o.DWordAdjust[o.resultDWordAdjust[e].tag];E.sockets.emit("UpdateDWordAdjust",o.resultDWordAdjust)}}catch(e){}try{if(o.refreshDataTextField&&(o.refreshDataTextField=!1,I.find({}).limit().sort({left:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultTextField=t,_.saveJsonFile("./Store/Database/TextField.json",t),E.sockets.emit("UpdateTextField",o.resultTextField),console.log("Get modelTextField data successfull",t.length))})),o.haveChangeTextField&&o.resultTextField.length>0){o.haveChangeTextField=!1;for(let e=0;e<o.resultTextField.length;e++)o.resultTextField[e].value=o.TextField[o.resultTextField[e].tag];E.sockets.emit("UpdateTextField",o.resultTextField)}}catch(e){}try{o.refreshDataTextFieldInput&&(o.refreshDataTextFieldInput=!1,v.find({}).limit().sort({left:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultTextFieldInput=t,_.saveJsonFile("./Store/Database/TextFieldInput.json",t),E.sockets.emit("UpdateTextFieldInput",o.resultTextFieldInput),console.log("Get modelTextField data successfull",t.length))})),o.haveChangeTextFieldInput&&o.resultTextFieldInput.length>0&&(o.haveChangeTextFieldInput=!1,E.sockets.emit("UpdateTextFieldInput",o.resultTextFieldInput))}catch(e){}try{o.refreshDataBitDisplayImageLibrary&&(o.refreshDataBitDisplayImageLibrary=!1,D.find({}).limit().sort({date:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultBitDisplayImageLibrary=t,E.sockets.emit("UpdateBitDisplayImageLibrary",o.resultBitDisplayImageLibrary),console.log("Get Image Library data successfull"),console.log(o.resultBitDisplayImageLibrary.length))}))}catch(e){}try{o.refreshDataMapImageLibrary&&(o.refreshDataMapImageLibrary=!1,w.find({}).limit(1e3).sort({date:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultMapImageLibrary=t,E.sockets.emit("UpdateMapImageLibrary",o.resultMapImageLibrary),console.log("Get Map Image Library data successfull"),console.log(o.resultMapImageLibrary.length))}))}catch(e){}try{o.refreshDataElementImageLibrary&&(o.refreshDataElementImageLibrary=!1,B.find({}).sort("-date").limit().exec((e,t)=>{e?console.log("get data from db error"):(o.resultElementImageLibrary=t,E.sockets.emit("UpdateElementImageLibrary",o.resultElementImageLibrary),console.log("Get Element Library data successfull"),console.log(o.resultElementImageLibrary.length))}))}catch(e){}try{o.refreshDataGroupControl&&(o.refreshDataGroupControl=!1,S.find({}).limit().sort({time:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultGroupControl=t,E.sockets.emit("UpdateGroupControl",o.resultGroupControl),console.log("Get Group_____Control data successfull"))}))}catch(e){}try{o.refreshDataPosCobot&&(o.refreshDataPosCobot=!1,C.find({}).limit().sort({time:1}).exec((e,t)=>{e?console.log("get data from db error"):(o.resultPosCobot=t,console.log("Get Pos Cobot data successfull"))}))}catch(e){}}),200)}}]);
//# sourceMappingURL=index.js.map